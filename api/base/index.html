
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../tutorials/">
      
      
        <link rel="next" href="../configs/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Base - Autoencodix</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e53b48f4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#base-module" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Autoencodix" class="md-header__button md-logo" aria-label="Autoencodix" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Autoencodix
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Base
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Autoencodix" class="md-nav__button md-logo" aria-label="Autoencodix" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Autoencodix
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Base
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Base
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#autoencodix.base" class="md-nav__link">
    <span class="md-ellipsis">
      base
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoencodix.base.BaseAutoencoder" class="md-nav__link">
    <span class="md-ellipsis">
      BaseAutoencoder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseAutoencoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseAutoencoder.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseAutoencoder.decode" class="md-nav__link">
    <span class="md-ellipsis">
      decode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseAutoencoder.encode" class="md-nav__link">
    <span class="md-ellipsis">
      encode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseAutoencoder.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseAutoencoder.get_latent_space" class="md-nav__link">
    <span class="md-ellipsis">
      get_latent_space
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoencodix.base.BaseDataset" class="md-nav__link">
    <span class="md-ellipsis">
      BaseDataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseDataset.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      __getitem__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseDataset.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseDataset.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseDataset.get_input_dim" class="md-nav__link">
    <span class="md-ellipsis">
      get_input_dim
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoencodix.base.BaseEvaluator" class="md-nav__link">
    <span class="md-ellipsis">
      BaseEvaluator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseEvaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseEvaluator.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      evaluate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoencodix.base.BaseLoss" class="md-nav__link">
    <span class="md-ellipsis">
      BaseLoss
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseLoss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseLoss.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseLoss.compute_kl_loss" class="md-nav__link">
    <span class="md-ellipsis">
      compute_kl_loss
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseLoss.compute_mmd_loss" class="md-nav__link">
    <span class="md-ellipsis">
      compute_mmd_loss
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseLoss.compute_paired_loss" class="md-nav__link">
    <span class="md-ellipsis">
      compute_paired_loss
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseLoss.compute_variational_loss" class="md-nav__link">
    <span class="md-ellipsis">
      compute_variational_loss
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseLoss.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline" class="md-nav__link">
    <span class="md-ellipsis">
      BasePipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BasePipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.decode" class="md-nav__link">
    <span class="md-ellipsis">
      decode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      evaluate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.load" class="md-nav__link">
    <span class="md-ellipsis">
      load
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.preprocess" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.save" class="md-nav__link">
    <span class="md-ellipsis">
      save
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.show_result" class="md-nav__link">
    <span class="md-ellipsis">
      show_result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.visualize" class="md-nav__link">
    <span class="md-ellipsis">
      visualize
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoencodix.base.BasePreprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      BasePreprocessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BasePreprocessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePreprocessor.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePreprocessor.preprocess" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoencodix.base.BaseTrainer" class="md-nav__link">
    <span class="md-ellipsis">
      BaseTrainer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoencodix.base.BaseVisualizer" class="md-nav__link">
    <span class="md-ellipsis">
      BaseVisualizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseVisualizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseVisualizer.save_plots" class="md-nav__link">
    <span class="md-ellipsis">
      save_plots
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseVisualizer.show_evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      show_evaluation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseVisualizer.show_loss" class="md-nav__link">
    <span class="md-ellipsis">
      show_loss
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../disentanglix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Disentanglix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../evaluate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Evaluate
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../imagix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Imagix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modeling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modeling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Notebooks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ontix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ontix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stackix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stackix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../trainers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trainers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vanillix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vanillix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../varix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Varix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualize/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visualize
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#autoencodix.base" class="md-nav__link">
    <span class="md-ellipsis">
      base
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoencodix.base.BaseAutoencoder" class="md-nav__link">
    <span class="md-ellipsis">
      BaseAutoencoder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseAutoencoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseAutoencoder.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseAutoencoder.decode" class="md-nav__link">
    <span class="md-ellipsis">
      decode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseAutoencoder.encode" class="md-nav__link">
    <span class="md-ellipsis">
      encode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseAutoencoder.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseAutoencoder.get_latent_space" class="md-nav__link">
    <span class="md-ellipsis">
      get_latent_space
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoencodix.base.BaseDataset" class="md-nav__link">
    <span class="md-ellipsis">
      BaseDataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseDataset.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      __getitem__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseDataset.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseDataset.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseDataset.get_input_dim" class="md-nav__link">
    <span class="md-ellipsis">
      get_input_dim
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoencodix.base.BaseEvaluator" class="md-nav__link">
    <span class="md-ellipsis">
      BaseEvaluator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseEvaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseEvaluator.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      evaluate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoencodix.base.BaseLoss" class="md-nav__link">
    <span class="md-ellipsis">
      BaseLoss
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseLoss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseLoss.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseLoss.compute_kl_loss" class="md-nav__link">
    <span class="md-ellipsis">
      compute_kl_loss
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseLoss.compute_mmd_loss" class="md-nav__link">
    <span class="md-ellipsis">
      compute_mmd_loss
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseLoss.compute_paired_loss" class="md-nav__link">
    <span class="md-ellipsis">
      compute_paired_loss
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseLoss.compute_variational_loss" class="md-nav__link">
    <span class="md-ellipsis">
      compute_variational_loss
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseLoss.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline" class="md-nav__link">
    <span class="md-ellipsis">
      BasePipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BasePipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.decode" class="md-nav__link">
    <span class="md-ellipsis">
      decode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      evaluate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.load" class="md-nav__link">
    <span class="md-ellipsis">
      load
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.preprocess" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.save" class="md-nav__link">
    <span class="md-ellipsis">
      save
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.show_result" class="md-nav__link">
    <span class="md-ellipsis">
      show_result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePipeline.visualize" class="md-nav__link">
    <span class="md-ellipsis">
      visualize
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoencodix.base.BasePreprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      BasePreprocessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BasePreprocessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePreprocessor.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BasePreprocessor.preprocess" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoencodix.base.BaseTrainer" class="md-nav__link">
    <span class="md-ellipsis">
      BaseTrainer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoencodix.base.BaseVisualizer" class="md-nav__link">
    <span class="md-ellipsis">
      BaseVisualizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseVisualizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseVisualizer.save_plots" class="md-nav__link">
    <span class="md-ellipsis">
      save_plots
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseVisualizer.show_evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      show_evaluation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoencodix.base.BaseVisualizer.show_loss" class="md-nav__link">
    <span class="md-ellipsis">
      show_loss
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="base-module">Base Module</h1>


<div class="doc doc-object doc-module">



<a id="autoencodix.base"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="autoencodix.base.BaseAutoencoder" class="doc doc-heading">
            <code>BaseAutoencoder</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code>, <code><span title="torch.nn.Module">Module</span></code></p>


        <p>Interface for building autoencoder models.</p>
<p>Defines standard methods for encoding data to a latent space and decoding
back to the original space. Includes a weight initialization method for
stable training. Intended to be extended by specific autoencoder variants
like VAE.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseAutoencoder.input_dim">input_dim</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of input features.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseAutoencoder.config">config</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration object containing model architecture parameters.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseAutoencoder._encoder">_encoder</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.nn.Module">Module</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Encoder network.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseAutoencoder._decoder">_decoder</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.nn.Module">Module</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Decoder network.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseAutoencoder.ontologies">ontologies</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ontology information, if provided for Ontix</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseAutoencoder.feature_order">feature_order</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For Ontix</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/autoencodix/base/_base_autoencoder.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BaseAutoencoder</span><span class="p">(</span><span class="n">ABC</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface for building autoencoder models.</span>

<span class="sd">    Defines standard methods for encoding data to a latent space and decoding</span>
<span class="sd">    back to the original space. Includes a weight initialization method for</span>
<span class="sd">    stable training. Intended to be extended by specific autoencoder variants</span>
<span class="sd">    like VAE.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        input_dim: Number of input features.</span>
<span class="sd">        config: Configuration object containing model architecture parameters.</span>
<span class="sd">        _encoder: Encoder network.</span>
<span class="sd">        _decoder: Decoder network.</span>
<span class="sd">        ontologies: Ontology information, if provided for Ontix</span>
<span class="sd">        feature_order: For Ontix</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DefaultConfig</span><span class="p">],</span>
        <span class="n">input_dim</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span>
        <span class="n">ontologies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the BaseAutoencoder.</span>

<span class="sd">        Args:</span>
<span class="sd">            config: Configuration object containing model parameters.</span>
<span class="sd">                If None, a default configuration will be used.</span>
<span class="sd">            input_dim: Number of input features.</span>
<span class="sd">            ontologies: Ontology information, if provided for Ontix</span>
<span class="sd">            feature_order: For Ontix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">DefaultConfig</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span> <span class="o">=</span> <span class="n">input_dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_encoder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_decoder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ontologies</span> <span class="o">=</span> <span class="n">ontologies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_order</span> <span class="o">=</span> <span class="n">feature_order</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_build_network</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Builds the encoder and decoder networks for the autoencoder model.</span>

<span class="sd">        Populates the self._encoder and self._decoder attributes.</span>
<span class="sd">        This method should be implemented by subclasses to define</span>
<span class="sd">        the architecture of the encoder and decoder networks.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">encode</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Encodes the input into the latent space.</span>

<span class="sd">        Args:</span>
<span class="sd">            x: The input tensor to be encoded.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The encoded latent space representation, or mu and logvar for VAEs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_latent_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the latent space representation of the input.</span>

<span class="sd">        Method for unification of getting a latent space between Variational</span>
<span class="sd">        and Vanilla Autoencoders. This method is a wrapper around the encode</span>
<span class="sd">        method, or the reparameterization method for VAE.</span>

<span class="sd">        Args:</span>
<span class="sd">            x: The input tensor to be encoded.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The latent space representation of the input tensor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Decodes the latent representation back to the input space.</span>

<span class="sd">        Args:</span>
<span class="sd">            x: The latent tensor to be decoded.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The decoded tensor, reconstructed from the latent space.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelOutput</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Combines encoding and decoding steps for the autoencoder.</span>

<span class="sd">        Args:</span>
<span class="sd">            x: The input tensor to be processed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The reconstructed input tensor and any additional information,</span>
<span class="sd">            depending on the model type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_init_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes weights using Xavier uniform initialization.</span>

<span class="sd">        This weight initialization method helps maintain the variance of</span>
<span class="sd">        activations across layers, preventing gradients from vanishing or</span>
<span class="sd">        exploding during training. This approach ensures stable and efficient</span>
<span class="sd">        training of the autoencoder model.</span>

<span class="sd">        Args:</span>
<span class="sd">            m: The module to initialize.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">):</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">xavier_uniform_</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">fill_</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BaseAutoencoder.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">ontologies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_order</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes the BaseAutoencoder.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="DefaultConfig (autoencodix.configs.default_config.DefaultConfig)" href="../configs/#autoencodix.configs.DefaultConfig">DefaultConfig</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration object containing model parameters.
If None, a default configuration will be used.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>input_dim</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="typing.Tuple">Tuple</span>[<span title="int">int</span>, ...]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of input features.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ontologies</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.Tuple">Tuple</span>, <span title="typing.Dict">Dict</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ontology information, if provided for Ontix</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>feature_order</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.Tuple">Tuple</span>, <span title="typing.Dict">Dict</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For Ontix</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_autoencoder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DefaultConfig</span><span class="p">],</span>
    <span class="n">input_dim</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span>
    <span class="n">ontologies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the BaseAutoencoder.</span>

<span class="sd">    Args:</span>
<span class="sd">        config: Configuration object containing model parameters.</span>
<span class="sd">            If None, a default configuration will be used.</span>
<span class="sd">        input_dim: Number of input features.</span>
<span class="sd">        ontologies: Ontology information, if provided for Ontix</span>
<span class="sd">        feature_order: For Ontix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">DefaultConfig</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span> <span class="o">=</span> <span class="n">input_dim</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_encoder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_decoder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ontologies</span> <span class="o">=</span> <span class="n">ontologies</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature_order</span> <span class="o">=</span> <span class="n">feature_order</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BaseAutoencoder.decode" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">decode</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Decodes the latent representation back to the input space.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latent tensor to be decoded.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The decoded tensor, reconstructed from the latent space.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_autoencoder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decodes the latent representation back to the input space.</span>

<span class="sd">    Args:</span>
<span class="sd">        x: The latent tensor to be decoded.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The decoded tensor, reconstructed from the latent space.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BaseAutoencoder.encode" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">encode</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Encodes the input into the latent space.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input tensor to be encoded.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="torch.Tensor">Tensor</span>, <span title="typing.Tuple">Tuple</span>[<span title="torch.Tensor">Tensor</span>, <span title="torch.Tensor">Tensor</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The encoded latent space representation, or mu and logvar for VAEs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_autoencoder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">encode</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Encodes the input into the latent space.</span>

<span class="sd">    Args:</span>
<span class="sd">        x: The input tensor to be encoded.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The encoded latent space representation, or mu and logvar for VAEs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BaseAutoencoder.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Combines encoding and decoding steps for the autoencoder.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input tensor to be processed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ModelOutput


  
      dataclass
   (autoencodix.utils._model_output.ModelOutput)" href="../utils/#autoencodix.utils.ModelOutput">ModelOutput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The reconstructed input tensor and any additional information,</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ModelOutput


  
      dataclass
   (autoencodix.utils._model_output.ModelOutput)" href="../utils/#autoencodix.utils.ModelOutput">ModelOutput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>depending on the model type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_autoencoder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combines encoding and decoding steps for the autoencoder.</span>

<span class="sd">    Args:</span>
<span class="sd">        x: The input tensor to be processed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The reconstructed input tensor and any additional information,</span>
<span class="sd">        depending on the model type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BaseAutoencoder.get_latent_space" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_latent_space</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the latent space representation of the input.</p>
<p>Method for unification of getting a latent space between Variational
and Vanilla Autoencoders. This method is a wrapper around the encode
method, or the reparameterization method for VAE.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input tensor to be encoded.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latent space representation of the input tensor.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_autoencoder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_latent_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the latent space representation of the input.</span>

<span class="sd">    Method for unification of getting a latent space between Variational</span>
<span class="sd">    and Vanilla Autoencoders. This method is a wrapper around the encode</span>
<span class="sd">    method, or the reparameterization method for VAE.</span>

<span class="sd">    Args:</span>
<span class="sd">        x: The input tensor to be encoded.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The latent space representation of the input tensor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="autoencodix.base.BaseDataset" class="doc doc-heading">
            <code>BaseDataset</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code>, <code><span title="torch.utils.data.Dataset">Dataset</span></code></p>


        <p>Interface to guide implementation for custom PyTorch datasets.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseDataset.data">data</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataset content (can be a torch.Tensor or other data structure).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseDataset.config">config</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional configuration object.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseDataset.sample_ids">sample_ids</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional list of identifiers for each sample.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseDataset.feature_ids">feature_ids</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional list of identifiers for each feature.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseDataset.mytype">mytype</span></code></td>
            <td>
                  <code><span title="enum.Enum">Enum</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Enum indicating the dataset type (should be set in subclasses).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/autoencodix/base/_base_dataset.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BaseDataset</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface to guide implementation for custom PyTorch datasets.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        data: The dataset content (can be a torch.Tensor or other data structure).</span>
<span class="sd">        config: Optional configuration object.</span>
<span class="sd">        sample_ids: Optional list of identifiers for each sample.</span>
<span class="sd">        feature_ids: Optional list of identifiers for each feature.</span>
<span class="sd">        mytype: Enum indicating the dataset type (should be set in subclasses).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">ImgData</span><span class="p">]],</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sample_ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the dataset.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: The data to be used by the dataset.</span>
<span class="sd">            config: Optional configuration parameters.</span>
<span class="sd">            sample_ids: Optional identifiers for each sample.</span>
<span class="sd">            feature_ids: Optional identifiers for each feature.</span>
<span class="sd">            mytype: Enum indicating the dataset type (should be set in subclasses).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">data</span>  <span class="c1"># for child class ImageDataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample_ids</span> <span class="o">=</span> <span class="n">sample_ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_ids</span> <span class="o">=</span> <span class="n">feature_ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">:</span> <span class="n">Enum</span>  <span class="c1"># Should be set in subclasses to indicate the dataset type (e.g., DataSetTypes.NUM or DataSetTypes.IMG)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseDataset</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># for xmodalix child</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the number of samples in the dataset.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The number of samples in the dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">ImgData</span><span class="p">],</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves a single sample and its corresponding label.</span>

<span class="sd">        Args:</span>
<span class="sd">            index: Index of the sample to retrieve.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple containing the index, the data sample and its label, or a dictionary</span>
<span class="sd">            mapping keys to such tuples in case we have multiple uncombined data at this step.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_ids</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">index</span>
        <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">label</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_input_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the input dimension of the dataset (n_features)</span>

<span class="sd">        Returns:</span>
<span class="sd">            The input dimension of the dataset&#39;s feature space.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Dataset is ImgData, and the list of ImgData is empty, cannot determine input dimension.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ImgData</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;List data is not of type ImgData, cannot determine input dimension.&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported data type for input dimension retrieval.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modality</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the dataset to a pandas DataFrame.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame representation of the dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_ids</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_ids</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Data is not a torch.Tensor and cannot be converted to DataFrame.&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BaseDataset.__getitem__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getitem__</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Retrieves a single sample and its corresponding label.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>index</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the sample to retrieve.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Tuple">Tuple</span>[<span title="typing.Union">Union</span>[<span title="torch.Tensor">Tensor</span>, <span title="int">int</span>], <span title="typing.Union">Union</span>[<span title="torch.Tensor">Tensor</span>, <a class="autorefs autorefs-internal" title="ImgData


  
      dataclass
   (autoencodix.data._imgdataclass.ImgData)" href="../data/#autoencodix.data.ImgData">ImgData</a>], <span title="typing.Any">Any</span>], <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Tuple">Tuple</span>[<span title="typing.Any">Any</span>, <span title="torch.Tensor">Tensor</span>, <span title="typing.Any">Any</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the index, the data sample and its label, or a dictionary</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Tuple">Tuple</span>[<span title="typing.Union">Union</span>[<span title="torch.Tensor">Tensor</span>, <span title="int">int</span>], <span title="typing.Union">Union</span>[<span title="torch.Tensor">Tensor</span>, <a class="autorefs autorefs-internal" title="ImgData


  
      dataclass
   (autoencodix.data._imgdataclass.ImgData)" href="../data/#autoencodix.data.ImgData">ImgData</a>], <span title="typing.Any">Any</span>], <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Tuple">Tuple</span>[<span title="typing.Any">Any</span>, <span title="torch.Tensor">Tensor</span>, <span title="typing.Any">Any</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>mapping keys to such tuples in case we have multiple uncombined data at this step.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">ImgData</span><span class="p">],</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
<span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieves a single sample and its corresponding label.</span>

<span class="sd">    Args:</span>
<span class="sd">        index: Index of the sample to retrieve.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A tuple containing the index, the data sample and its label, or a dictionary</span>
<span class="sd">        mapping keys to such tuples in case we have multiple uncombined data at this step.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_ids</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">index</span>
    <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">label</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BaseDataset.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sample_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes the dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="torch.Tensor">Tensor</span>, <span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="ImgData


  
      dataclass
   (autoencodix.data._imgdataclass.ImgData)" href="../data/#autoencodix.data.ImgData">ImgData</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The data to be used by the dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional configuration parameters.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sample_ids</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional identifiers for each sample.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>feature_ids</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional identifiers for each feature.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mytype</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Enum indicating the dataset type (should be set in subclasses).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">ImgData</span><span class="p">]],</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sample_ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: The data to be used by the dataset.</span>
<span class="sd">        config: Optional configuration parameters.</span>
<span class="sd">        sample_ids: Optional identifiers for each sample.</span>
<span class="sd">        feature_ids: Optional identifiers for each feature.</span>
<span class="sd">        mytype: Enum indicating the dataset type (should be set in subclasses).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">data</span>  <span class="c1"># for child class ImageDataset</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sample_ids</span> <span class="o">=</span> <span class="n">sample_ids</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature_ids</span> <span class="o">=</span> <span class="n">feature_ids</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">:</span> <span class="n">Enum</span>  <span class="c1"># Should be set in subclasses to indicate the dataset type (e.g., DataSetTypes.NUM or DataSetTypes.IMG)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseDataset</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># for xmodalix child</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BaseDataset.__len__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__len__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the number of samples in the dataset.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of samples in the dataset.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the number of samples in the dataset.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The number of samples in the dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BaseDataset.get_input_dim" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_input_dim</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets the input dimension of the dataset (n_features)</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="typing.Tuple">Tuple</span>[<span title="int">int</span>, ...]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input dimension of the dataset's feature space.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_input_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the input dimension of the dataset (n_features)</span>

<span class="sd">    Returns:</span>
<span class="sd">        The input dimension of the dataset&#39;s feature space.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Dataset is ImgData, and the list of ImgData is empty, cannot determine input dimension.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ImgData</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List data is not of type ImgData, cannot determine input dimension.&quot;</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported data type for input dimension retrieval.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="autoencodix.base.BaseEvaluator" class="doc doc-heading">
            <code>BaseEvaluator</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>









              <details class="quote">
                <summary>Source code in <code>src/autoencodix/base/_base_evaluator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BaseEvaluator</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the Autoencodix pipeline on defined machine learning tasks.</span>

<span class="sd">        Subclasses must implement this method to perform evaluation using the provided arguments.</span>

<span class="sd">        Args:</span>
<span class="sd">            *args: Variable length argument list for evaluation parameters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Result: The evaluation result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_expand_reference_methods</span><span class="p">(</span><span class="n">reference_methods</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">Result</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Expands the list of reference methods if needed for evaluation.</span>

<span class="sd">        Args:</span>
<span class="sd">            reference_methods (list): The list of reference methods to potentially expand.</span>
<span class="sd">            result (Result): The evaluation result object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: The (possibly expanded) list of reference methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">reference_methods</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BaseEvaluator.evaluate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">evaluate</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Evaluate the Autoencodix pipeline on defined machine learning tasks.</p>
<p>Subclasses must implement this method to perform evaluation using the provided arguments.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>*args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variable length argument list for evaluation parameters.</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Result</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The evaluation result.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_evaluator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the Autoencodix pipeline on defined machine learning tasks.</span>

<span class="sd">    Subclasses must implement this method to perform evaluation using the provided arguments.</span>

<span class="sd">    Args:</span>
<span class="sd">        *args: Variable length argument list for evaluation parameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Result: The evaluation result.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="autoencodix.base.BaseLoss" class="doc doc-heading">
            <code>BaseLoss</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code>, <code><span title="abc.ABC">ABC</span></code></p>


        <p>Provides common loss computation functionality for autoencoders.</p>
<p>Implements standard loss calculations including reconstruction loss,
KL divergence, and Maximum Mean Discrepancy (MMD), while requiring
subclasses to implement the specific forward method.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseLoss.config">config</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration parameters for the loss function.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseLoss.recon_loss">recon_loss</span></code></td>
            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Module for computing reconstruction loss (MSE or BCE).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseLoss.reduction_fn">reduction_fn</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function to apply reduction (mean or sum).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseLoss.compute_kernel">compute_kernel</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function to compute kernel for MMD loss.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseLoss.annealing_scheduler">annealing_scheduler</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Helper for loss calculation with annealing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/autoencodix/base/_base_loss.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BaseLoss</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides common loss computation functionality for autoencoders.</span>

<span class="sd">    Implements standard loss calculations including reconstruction loss,</span>
<span class="sd">    KL divergence, and Maximum Mean Discrepancy (MMD), while requiring</span>
<span class="sd">    subclasses to implement the specific forward method.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        config: Configuration parameters for the loss function.</span>
<span class="sd">        recon_loss: Module for computing reconstruction loss (MSE or BCE).</span>
<span class="sd">        reduction_fn: Function to apply reduction (mean or sum).</span>
<span class="sd">        compute_kernel: Function to compute kernel for MMD loss.</span>
<span class="sd">        annealing_scheduler: Helper for loss calculation with annealing.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">DefaultConfig</span><span class="p">,</span> <span class="n">annealing_scheduler</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the loss module with the specified configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            config: Configuration parameters for the loss function.</span>
<span class="sd">            annealing_scheduler: Helper class for loss calculation with annealing.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: If unsupported loss reduction or reconstruction</span>
<span class="sd">                loss type is specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annealing_scheduler</span> <span class="o">=</span> <span class="n">annealing_scheduler</span> <span class="ow">or</span> <span class="n">AnnealingScheduler</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recon_loss</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">loss_reduction</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reduction_fn</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">loss_reduction</span> <span class="o">==</span> <span class="s2">&quot;sum&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reduction_fn</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid loss reduction type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">loss_reduction</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Only &#39;mean&#39; and &#39;sum&#39; are supported.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reconstruction_loss</span> <span class="o">==</span> <span class="s2">&quot;mse&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recon_loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="n">reduction</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">loss_reduction</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reconstruction_loss</span> <span class="o">==</span> <span class="s2">&quot;bce&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recon_loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BCEWithLogitsLoss</span><span class="p">(</span><span class="n">reduction</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">loss_reduction</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid reconstruction loss type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reconstruction_loss</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Only &#39;mse&#39; and &#39;bce&#39; are supported. Please check the value of &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;config.reconstruction_loss&#39; for typos or unsupported types.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">compute_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mmd_kernel</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_mmd_kernel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes Gaussian kernel for Maximum Mean Discrepancy calculation.</span>

<span class="sd">        Calculates the kernel matrix between two sets of samples, using a</span>
<span class="sd">        Gaussian kernel with normalization by feature dimension.</span>

<span class="sd">        Args:</span>
<span class="sd">            x: First set of input samples.</span>
<span class="sd">            y: Second set of input samples.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Kernel matrix of shape (x.shape[0], y.shape[0]).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_size</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">y_size</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">tiled_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">x_size</span><span class="p">,</span> <span class="n">y_size</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
        <span class="n">tiled_y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">x_size</span><span class="p">,</span> <span class="n">y_size</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>

        <span class="n">kernel_input</span> <span class="o">=</span> <span class="p">(</span><span class="n">tiled_x</span> <span class="o">-</span> <span class="n">tiled_y</span><span class="p">)</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">kernel_input</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_mmd_loss</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">true_samples</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes Maximum Mean Discrepancy loss.</span>

<span class="sd">        Args:</span>
<span class="sd">            z: Samples from the encoded distribution.</span>
<span class="sd">            true_samples: Samples from the prior distribution.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The MMD loss value.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: If unsupported loss reduction type is specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">true_samples_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_kernel</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">true_samples</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">true_samples</span><span class="p">)</span>
        <span class="n">z_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_kernel</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="n">ztr_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_kernel</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">true_samples</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">loss_reduction</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">true_samples_kernel</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="n">z_kernel</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ztr_kernel</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">loss_reduction</span> <span class="o">==</span> <span class="s2">&quot;sum&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">true_samples_kernel</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">z_kernel</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ztr_kernel</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid loss reduction type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">loss_reduction</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Only &#39;mean&#39; and &#39;sum&#39; are supported.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_kl_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">logvar</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes KL divergence loss between N(mu, logvar) and N(0, 1).</span>

<span class="sd">        Args:</span>
<span class="sd">            mu: Mean tensor.</span>
<span class="sd">            logvar: Log variance tensor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The KL divergence loss value.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If mu and logvar do not have the same shape.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mu</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">logvar</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Shape mismatch: mu has shape </span><span class="si">{</span><span class="n">mu</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, but logvar has shape </span><span class="si">{</span><span class="n">logvar</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduction_fn</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">logvar</span> <span class="o">-</span> <span class="n">mu</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">logvar</span><span class="o">.</span><span class="n">exp</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_variational_loss</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
        <span class="n">logvar</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
        <span class="n">z</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">true_samples</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes either KL or MMD loss based on configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            mu: Mean tensor for variational loss.</span>
<span class="sd">            logvar: Log variance tensor for variational loss.</span>
<span class="sd">            z: Encoded samples for MMD loss.</span>
<span class="sd">            true_samples: Prior samples for MMD loss.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The computed variational loss.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If required parameters are missing or if mu and logvar have shape mismatch.</span>
<span class="sd">            NotImplementedError: If unsupported VAE loss type is specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">default_vae_loss</span> <span class="o">==</span> <span class="s2">&quot;kl&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mu</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;mu must be provided for VAE loss&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">logvar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;logvar must be provided for VAE loss&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mu</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">logvar</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Shape mismatch: mu has shape </span><span class="si">{</span><span class="n">mu</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, but logvar has shape </span><span class="si">{</span><span class="n">logvar</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_kl_loss</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="n">logvar</span><span class="o">=</span><span class="n">logvar</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">default_vae_loss</span> <span class="o">==</span> <span class="s2">&quot;mmd&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;z must be provided for MMD loss&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">true_samples</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;true_samples must be provided for MMD loss&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_mmd_loss</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">true_samples</span><span class="o">=</span><span class="n">true_samples</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;VAE loss type </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">default_vae_loss</span><span class="si">}</span><span class="s2"> is not implemented. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Only &#39;kl&#39; and &#39;mmd&#39; are supported.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_paired_loss</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">latentspaces</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
        <span class="n">sample_ids</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the paired distance loss across all pairs of modalities in a batch.</span>

<span class="sd">        Args:</span>
<span class="sd">            latentspaces: A dictionary mapping modality names to their latent space tensors.</span>
<span class="sd">                        e.g., {&#39;RNA&#39;: tensor_rna, &#39;ATAC&#39;: tensor_atac}</span>
<span class="sd">            sample_ids: A dictionary mapping modality names to their list of sample IDs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A single scalar tensor representing the total paired loss.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">loss_helper</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">modality_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">latentspaces</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># 1. Iterate through all unique pairs of modalities</span>
        <span class="k">for</span> <span class="n">mod_a</span><span class="p">,</span> <span class="n">mod_b</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">modality_names</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">ids_a</span> <span class="o">=</span> <span class="n">sample_ids</span><span class="p">[</span><span class="n">mod_a</span><span class="p">]</span>
            <span class="n">ids_b</span> <span class="o">=</span> <span class="n">sample_ids</span><span class="p">[</span><span class="n">mod_b</span><span class="p">]</span>

            <span class="c1"># 2. Find the intersection of sample IDs</span>
            <span class="n">common_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ids_a</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">ids_b</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">common_ids</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no common ids&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># 3. Create a mapping from sample ID to index for efficient lookup</span>
            <span class="n">id_to_idx_a</span> <span class="o">=</span> <span class="p">{</span><span class="n">sample_id</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sample_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ids_a</span><span class="p">)}</span>
            <span class="n">id_to_idx_b</span> <span class="o">=</span> <span class="p">{</span><span class="n">sample_id</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sample_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ids_b</span><span class="p">)}</span>

            <span class="c1"># Get the corresponding indices for the common samples</span>
            <span class="n">indices_a</span> <span class="o">=</span> <span class="p">[</span><span class="n">id_to_idx_a</span><span class="p">[</span><span class="n">common_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">common_id</span> <span class="ow">in</span> <span class="n">common_ids</span><span class="p">]</span>
            <span class="n">indices_b</span> <span class="o">=</span> <span class="p">[</span><span class="n">id_to_idx_b</span><span class="p">[</span><span class="n">common_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">common_id</span> <span class="ow">in</span> <span class="n">common_ids</span><span class="p">]</span>

            <span class="c1"># 4. Select the latent vectors for the paired samples</span>
            <span class="n">paired_latents_a</span> <span class="o">=</span> <span class="n">latentspaces</span><span class="p">[</span><span class="n">mod_a</span><span class="p">][</span><span class="n">indices_a</span><span class="p">]</span>
            <span class="n">paired_latents_b</span> <span class="o">=</span> <span class="n">latentspaces</span><span class="p">[</span><span class="n">mod_b</span><span class="p">][</span><span class="n">indices_b</span><span class="p">]</span>

            <span class="c1"># 5. Calculate the distance between the aligned latent vectors</span>
            <span class="c1"># L1 distance, averaged over latent dimensions and then over samples</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">paired_latents_a</span> <span class="o">-</span> <span class="n">paired_latents_b</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">pair_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduction_fn</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
            <span class="n">loss_helper</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pair_loss</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">loss_helper</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">loss_helper</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_log_gauss_dense</span><span class="p">(</span>
        <span class="n">z</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">mu</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">logvar</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes the log probability of a Gaussian distribution.</span>

<span class="sd">        Args:</span>
<span class="sd">            z: Latent variable tensor.</span>
<span class="sd">            mu: Mean tensor.</span>
<span class="sd">            logvar: Log variance tensor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Log probability of the Gaussian distribution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>
            <span class="o">+</span> <span class="n">logvar</span>
            <span class="o">+</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">logvar</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_log_import_weight_mat</span><span class="p">(</span><span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes the log import weight matrix for disentangled loss.</span>
<span class="sd">           Similar to: https://github.com/rtqichen/beta-tcvae</span>
<span class="sd">        Args:</span>
<span class="sd">            batch_size: Number of samples in the batch.</span>
<span class="sd">            n_samples: Total number of samples in the dataset.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Log import weight matrix of shape (batch_size, n_samples).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">N</span> <span class="o">=</span> <span class="n">n_samples</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">batch_size</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">strat_weight</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">M</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">M</span><span class="p">)</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span><span class="o">.</span><span class="n">fill_</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">M</span><span class="p">)</span>
        <span class="n">W</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[::</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">N</span>
        <span class="n">W</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span> <span class="p">::</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">strat_weight</span>
        <span class="n">W</span><span class="p">[</span><span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">strat_weight</span>
        <span class="k">return</span> <span class="n">W</span><span class="o">.</span><span class="n">log</span><span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the loss for the autoencoder.</span>

<span class="sd">        This method must be implemented by subclasses to define the specific</span>
<span class="sd">        loss computation logic for the autoencoder. The implementation should</span>
<span class="sd">        compute the total loss as well as any individual loss components</span>
<span class="sd">        (e.g., reconstruction loss, KL divergence, etc.) based on the model&#39;s</span>
<span class="sd">        output and the provided targets.</span>

<span class="sd">        Args:</span>
<span class="sd">            *kwargs depending on the loss type and pipeline</span>


<span class="sd">        Returns:</span>
<span class="sd">            - The total loss value as a scalar tensor.</span>
<span class="sd">            - A dictionary of individual loss components, where the keys are</span>
<span class="sd">                descriptive strings (e.g., &quot;reconstruction_loss&quot;, &quot;kl_loss&quot;) and</span>
<span class="sd">                the values are the corresponding loss tensors.</span>
<span class="sd">            - Implementation in subclasses is flexible, so for new loss classes this can differ.</span>

<span class="sd">        Note:</span>
<span class="sd">            Subclasses must implement this method to define the specific loss</span>
<span class="sd">            computation logic for their use case.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO maybe standardize the return types more i.e. request a scalar and a dict</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BaseLoss.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">annealing_scheduler</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes the loss module with the specified configuration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="DefaultConfig (autoencodix.configs.default_config.DefaultConfig)" href="../configs/#autoencodix.configs.DefaultConfig">DefaultConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration parameters for the loss function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>annealing_scheduler</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Helper class for loss calculation with annealing.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="NotImplementedError">NotImplementedError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If unsupported loss reduction or reconstruction
loss type is specified.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_loss.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">DefaultConfig</span><span class="p">,</span> <span class="n">annealing_scheduler</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the loss module with the specified configuration.</span>

<span class="sd">    Args:</span>
<span class="sd">        config: Configuration parameters for the loss function.</span>
<span class="sd">        annealing_scheduler: Helper class for loss calculation with annealing.</span>

<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: If unsupported loss reduction or reconstruction</span>
<span class="sd">            loss type is specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">annealing_scheduler</span> <span class="o">=</span> <span class="n">annealing_scheduler</span> <span class="ow">or</span> <span class="n">AnnealingScheduler</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recon_loss</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">loss_reduction</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reduction_fn</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">loss_reduction</span> <span class="o">==</span> <span class="s2">&quot;sum&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reduction_fn</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid loss reduction type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">loss_reduction</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Only &#39;mean&#39; and &#39;sum&#39; are supported.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reconstruction_loss</span> <span class="o">==</span> <span class="s2">&quot;mse&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recon_loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="n">reduction</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">loss_reduction</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reconstruction_loss</span> <span class="o">==</span> <span class="s2">&quot;bce&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recon_loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BCEWithLogitsLoss</span><span class="p">(</span><span class="n">reduction</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">loss_reduction</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid reconstruction loss type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reconstruction_loss</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Only &#39;mse&#39; and &#39;bce&#39; are supported. Please check the value of &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;&#39;config.reconstruction_loss&#39; for typos or unsupported types.&quot;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">compute_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mmd_kernel</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BaseLoss.compute_kl_loss" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_kl_loss</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">logvar</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Computes KL divergence loss between N(mu, logvar) and N(0, 1).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean tensor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logvar</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Log variance tensor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The KL divergence loss value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If mu and logvar do not have the same shape.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_loss.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_kl_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">logvar</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes KL divergence loss between N(mu, logvar) and N(0, 1).</span>

<span class="sd">    Args:</span>
<span class="sd">        mu: Mean tensor.</span>
<span class="sd">        logvar: Log variance tensor.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The KL divergence loss value.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If mu and logvar do not have the same shape.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mu</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">logvar</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Shape mismatch: mu has shape </span><span class="si">{</span><span class="n">mu</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, but logvar has shape </span><span class="si">{</span><span class="n">logvar</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduction_fn</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">logvar</span> <span class="o">-</span> <span class="n">mu</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">logvar</span><span class="o">.</span><span class="n">exp</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BaseLoss.compute_mmd_loss" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_mmd_loss</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">true_samples</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Computes Maximum Mean Discrepancy loss.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>z</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Samples from the encoded distribution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>true_samples</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Samples from the prior distribution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The MMD loss value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="NotImplementedError">NotImplementedError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If unsupported loss reduction type is specified.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_loss.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_mmd_loss</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">true_samples</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes Maximum Mean Discrepancy loss.</span>

<span class="sd">    Args:</span>
<span class="sd">        z: Samples from the encoded distribution.</span>
<span class="sd">        true_samples: Samples from the prior distribution.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The MMD loss value.</span>

<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: If unsupported loss reduction type is specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">true_samples_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_kernel</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">true_samples</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">true_samples</span><span class="p">)</span>
    <span class="n">z_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_kernel</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="n">ztr_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_kernel</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">true_samples</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">loss_reduction</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">true_samples_kernel</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="n">z_kernel</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ztr_kernel</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">loss_reduction</span> <span class="o">==</span> <span class="s2">&quot;sum&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">true_samples_kernel</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">z_kernel</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ztr_kernel</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid loss reduction type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">loss_reduction</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Only &#39;mean&#39; and &#39;sum&#39; are supported.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BaseLoss.compute_paired_loss" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_paired_loss</span><span class="p">(</span><span class="n">latentspaces</span><span class="p">,</span> <span class="n">sample_ids</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculates the paired distance loss across all pairs of modalities in a batch.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>latentspaces</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary mapping modality names to their latent space tensors.
        e.g., {'RNA': tensor_rna, 'ATAC': tensor_atac}</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sample_ids</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="list">list</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary mapping modality names to their list of sample IDs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A single scalar tensor representing the total paired loss.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_loss.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_paired_loss</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">latentspaces</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
    <span class="n">sample_ids</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the paired distance loss across all pairs of modalities in a batch.</span>

<span class="sd">    Args:</span>
<span class="sd">        latentspaces: A dictionary mapping modality names to their latent space tensors.</span>
<span class="sd">                    e.g., {&#39;RNA&#39;: tensor_rna, &#39;ATAC&#39;: tensor_atac}</span>
<span class="sd">        sample_ids: A dictionary mapping modality names to their list of sample IDs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A single scalar tensor representing the total paired loss.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">loss_helper</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">modality_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">latentspaces</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="c1"># 1. Iterate through all unique pairs of modalities</span>
    <span class="k">for</span> <span class="n">mod_a</span><span class="p">,</span> <span class="n">mod_b</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">modality_names</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">ids_a</span> <span class="o">=</span> <span class="n">sample_ids</span><span class="p">[</span><span class="n">mod_a</span><span class="p">]</span>
        <span class="n">ids_b</span> <span class="o">=</span> <span class="n">sample_ids</span><span class="p">[</span><span class="n">mod_b</span><span class="p">]</span>

        <span class="c1"># 2. Find the intersection of sample IDs</span>
        <span class="n">common_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ids_a</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">ids_b</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">common_ids</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no common ids&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># 3. Create a mapping from sample ID to index for efficient lookup</span>
        <span class="n">id_to_idx_a</span> <span class="o">=</span> <span class="p">{</span><span class="n">sample_id</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sample_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ids_a</span><span class="p">)}</span>
        <span class="n">id_to_idx_b</span> <span class="o">=</span> <span class="p">{</span><span class="n">sample_id</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sample_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ids_b</span><span class="p">)}</span>

        <span class="c1"># Get the corresponding indices for the common samples</span>
        <span class="n">indices_a</span> <span class="o">=</span> <span class="p">[</span><span class="n">id_to_idx_a</span><span class="p">[</span><span class="n">common_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">common_id</span> <span class="ow">in</span> <span class="n">common_ids</span><span class="p">]</span>
        <span class="n">indices_b</span> <span class="o">=</span> <span class="p">[</span><span class="n">id_to_idx_b</span><span class="p">[</span><span class="n">common_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">common_id</span> <span class="ow">in</span> <span class="n">common_ids</span><span class="p">]</span>

        <span class="c1"># 4. Select the latent vectors for the paired samples</span>
        <span class="n">paired_latents_a</span> <span class="o">=</span> <span class="n">latentspaces</span><span class="p">[</span><span class="n">mod_a</span><span class="p">][</span><span class="n">indices_a</span><span class="p">]</span>
        <span class="n">paired_latents_b</span> <span class="o">=</span> <span class="n">latentspaces</span><span class="p">[</span><span class="n">mod_b</span><span class="p">][</span><span class="n">indices_b</span><span class="p">]</span>

        <span class="c1"># 5. Calculate the distance between the aligned latent vectors</span>
        <span class="c1"># L1 distance, averaged over latent dimensions and then over samples</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">paired_latents_a</span> <span class="o">-</span> <span class="n">paired_latents_b</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pair_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduction_fn</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
        <span class="n">loss_helper</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pair_loss</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">loss_helper</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">loss_helper</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BaseLoss.compute_variational_loss" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_variational_loss</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">logvar</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">true_samples</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Computes either KL or MMD loss based on configuration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean tensor for variational loss.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logvar</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Log variance tensor for variational loss.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>z</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Encoded samples for MMD loss.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>true_samples</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prior samples for MMD loss.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The computed variational loss.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If required parameters are missing or if mu and logvar have shape mismatch.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="NotImplementedError">NotImplementedError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If unsupported VAE loss type is specified.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_loss.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_variational_loss</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">mu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
    <span class="n">logvar</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
    <span class="n">z</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">true_samples</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes either KL or MMD loss based on configuration.</span>

<span class="sd">    Args:</span>
<span class="sd">        mu: Mean tensor for variational loss.</span>
<span class="sd">        logvar: Log variance tensor for variational loss.</span>
<span class="sd">        z: Encoded samples for MMD loss.</span>
<span class="sd">        true_samples: Prior samples for MMD loss.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The computed variational loss.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If required parameters are missing or if mu and logvar have shape mismatch.</span>
<span class="sd">        NotImplementedError: If unsupported VAE loss type is specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">default_vae_loss</span> <span class="o">==</span> <span class="s2">&quot;kl&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mu</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;mu must be provided for VAE loss&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">logvar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;logvar must be provided for VAE loss&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mu</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">logvar</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Shape mismatch: mu has shape </span><span class="si">{</span><span class="n">mu</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, but logvar has shape </span><span class="si">{</span><span class="n">logvar</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_kl_loss</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="n">logvar</span><span class="o">=</span><span class="n">logvar</span><span class="p">)</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">default_vae_loss</span> <span class="o">==</span> <span class="s2">&quot;mmd&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;z must be provided for MMD loss&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">true_samples</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;true_samples must be provided for MMD loss&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_mmd_loss</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">true_samples</span><span class="o">=</span><span class="n">true_samples</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;VAE loss type </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">default_vae_loss</span><span class="si">}</span><span class="s2"> is not implemented. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Only &#39;kl&#39; and &#39;mmd&#39; are supported.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BaseLoss.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Calculates the loss for the autoencoder.</p>
<p>This method must be implemented by subclasses to define the specific
loss computation logic for the autoencoder. The implementation should
compute the total loss as well as any individual loss components
(e.g., reconstruction loss, KL divergence, etc.) based on the model's
output and the provided targets.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>The total loss value as a scalar tensor.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>A dictionary of individual loss components, where the keys are
descriptive strings (e.g., "reconstruction_loss", "kl_loss") and
the values are the corresponding loss tensors.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>Implementation in subclasses is flexible, so for new loss classes this can differ.</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Subclasses must implement this method to define the specific loss
computation logic for their use case.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_loss.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the loss for the autoencoder.</span>

<span class="sd">    This method must be implemented by subclasses to define the specific</span>
<span class="sd">    loss computation logic for the autoencoder. The implementation should</span>
<span class="sd">    compute the total loss as well as any individual loss components</span>
<span class="sd">    (e.g., reconstruction loss, KL divergence, etc.) based on the model&#39;s</span>
<span class="sd">    output and the provided targets.</span>

<span class="sd">    Args:</span>
<span class="sd">        *kwargs depending on the loss type and pipeline</span>


<span class="sd">    Returns:</span>
<span class="sd">        - The total loss value as a scalar tensor.</span>
<span class="sd">        - A dictionary of individual loss components, where the keys are</span>
<span class="sd">            descriptive strings (e.g., &quot;reconstruction_loss&quot;, &quot;kl_loss&quot;) and</span>
<span class="sd">            the values are the corresponding loss tensors.</span>
<span class="sd">        - Implementation in subclasses is flexible, so for new loss classes this can differ.</span>

<span class="sd">    Note:</span>
<span class="sd">        Subclasses must implement this method to define the specific loss</span>
<span class="sd">        computation logic for their use case.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO maybe standardize the return types more i.e. request a scalar and a dict</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="autoencodix.base.BasePipeline" class="doc doc-heading">
            <code>BasePipeline</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Provides a standardized interface for building model pipelines.</p>
<p>Implements methods for preprocessing data, training models, making predictions,
evaluating performance, and visualizing results. Subclasses customize behavior
by providing specific implementations for processing, training, evaluation,
and visualization. For example when using the Stackix Model, we would use
the StackixPreprocessor Type for preprocessing.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePipeline.config">config</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration for the pipeline's components and behavior.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePipeline.preprocessed_data">preprocessed_data</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="DatasetContainer


  
      dataclass
   (autoencodix.data._datasetcontainer.DatasetContainer)" href="../data/#autoencodix.data.DatasetContainer">DatasetContainer</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-split and processed data that can be provided by user.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePipeline.raw_user_data">raw_user_data</span></code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="DataPackage


  
      dataclass
   (autoencodix.data.datapackage.DataPackage)" href="../data/#autoencodix.data.DataPackage">DataPackage</a>, <span title="anndata.AnnData">AnnData</span>, <span title="mudata.MuData">MuData</span>, <span title="pandas.DataFrame">DataFrame</span>, <span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raw input data for processing (DataFrames, MuData, etc.).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePipeline.result">result</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage container for all pipeline outputs.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePipeline._preprocessor">_preprocessor</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Component that filters, scales, and cleans data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePipeline._visualizer">_visualizer</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Component that generates visual representations of results.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePipeline._dataset_type">_dataset_type</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base class for dataset implementations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePipeline._trainer_type">_trainer_type</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base class for trainer implementations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePipeline._model_type">_model_type</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base class for model architecture implementations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePipeline._loss_type">_loss_type</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base class for loss function implementations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePipeline._datasets">_datasets</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="DatasetContainer


  
      dataclass
   (autoencodix.data._datasetcontainer.DatasetContainer)" href="../data/#autoencodix.data.DatasetContainer">DatasetContainer</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Split datasets after preprocessing.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePipeline._evaluator">_evaluator</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Component that assesses model performance. Not implemented yet</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePipeline._data_splitter">_data_splitter</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Component that divides data into train/validation/test sets.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePipeline._ontologies">_ontologies</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of dictionaries containing the ontologies to be used to construct sparse decoder layers.
If a list is provided, it is assumed to be a list of file paths to ontology files.
First item in list or tuple will be treated as first layer (after latent space) and so on.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/autoencodix/base/_base_pipeline.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BasePipeline</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides a standardized interface for building model pipelines.</span>

<span class="sd">    Implements methods for preprocessing data, training models, making predictions,</span>
<span class="sd">    evaluating performance, and visualizing results. Subclasses customize behavior</span>
<span class="sd">    by providing specific implementations for processing, training, evaluation,</span>
<span class="sd">    and visualization. For example when using the Stackix Model, we would use</span>
<span class="sd">    the StackixPreprocessor Type for preprocessing.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        config: Configuration for the pipeline&#39;s components and behavior.</span>
<span class="sd">        preprocessed_data: Pre-split and processed data that can be provided by user.</span>
<span class="sd">        raw_user_data: Raw input data for processing (DataFrames, MuData, etc.).</span>
<span class="sd">        result: Storage container for all pipeline outputs.</span>
<span class="sd">        _preprocessor: Component that filters, scales, and cleans data.</span>
<span class="sd">        _visualizer: Component that generates visual representations of results.</span>
<span class="sd">        _dataset_type: Base class for dataset implementations.</span>
<span class="sd">        _trainer_type: Base class for trainer implementations.</span>
<span class="sd">        _model_type: Base class for model architecture implementations.</span>
<span class="sd">        _loss_type: Base class for loss function implementations.</span>
<span class="sd">        _datasets: Split datasets after preprocessing.</span>
<span class="sd">        _evaluator: Component that assesses model performance. Not implemented yet</span>
<span class="sd">        _data_splitter: Component that divides data into train/validation/test sets.</span>
<span class="sd">        _ontologies: Tuple of dictionaries containing the ontologies to be used to construct sparse decoder layers.</span>
<span class="sd">            If a list is provided, it is assumed to be a list of file paths to ontology files.</span>
<span class="sd">            First item in list or tuple will be treated as first layer (after latent space) and so on.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataset_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseDataset</span><span class="p">],</span>
        <span class="n">trainer_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseTrainer</span><span class="p">],</span>
        <span class="n">model_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseAutoencoder</span><span class="p">],</span>
        <span class="n">loss_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseLoss</span><span class="p">],</span>
        <span class="n">datasplitter_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">DataSplitter</span><span class="p">],</span>
        <span class="n">preprocessor_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BasePreprocessor</span><span class="p">],</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="n">DataPackage</span><span class="p">,</span> <span class="n">DatasetContainer</span><span class="p">,</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">,</span> <span class="n">MuData</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>  <span class="c1"># type: ignore[invalid-type-form]</span>
        <span class="p">],</span>
        <span class="n">visualizer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseVisualizer</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">evaluator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseEvaluator</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Result</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DefaultConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">custom_split</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ontologies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># ty: ignore[call-non-callable]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the pipeline with components and configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            dataset_type: Class for dataset implementations.</span>
<span class="sd">            trainer_type: Class for model training implementations.</span>
<span class="sd">            model_type: Class for model architecture implementations.</span>
<span class="sd">            loss_type: Class for loss function implementations.</span>
<span class="sd">            datasplitter_type: Class for data splitting implementation.</span>
<span class="sd">            preprocessor_type: Class for data preprocessing implementation.</span>
<span class="sd">            visualizer: Component for generating visualizations.</span>
<span class="sd">            data: Input data to be processed or already processed data.</span>
<span class="sd">            evaluator: Component for assessing model performance.</span>
<span class="sd">            result: Storage container for pipeline outputs.</span>
<span class="sd">            config: Configuration parameters for all pipeline components.</span>
<span class="sd">            custom_split: User-provided data splits (train/validation/test).</span>
<span class="sd">            **kwargs: Additional keyword arguments.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If inputs have incorrect types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_default_config&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                            The _default_config attribute has not been specified in your pipeline class.</span>

<span class="sd">                            Example:</span>
<span class="sd">                            self._default_config = XModalixConfig()</span>

<span class="sd">                            This error typically occurs when a new architecture is added without setting the</span>
<span class="sd">                            _default_config in its corresponding pipeline class.</span>

<span class="sd">                            For more details, please refer to the &#39;how to add a new architecture&#39; section in our documentation.</span>
<span class="sd">                            &quot;&quot;&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_config</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_user_input</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">processed_data</span> <span class="o">=</span> <span class="n">data</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">DatasetContainer</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">raw_user_data</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">data</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">DataPackage</span><span class="p">,</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">,</span> <span class="n">MuData</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">dict</span><span class="p">))</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">processed_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">processed_data</span><span class="p">,</span> <span class="n">DatasetContainer</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expected data type to be DatasetContainer, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">processed_data</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">preprocessed_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DatasetContainer</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_user_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="n">DataPackage</span><span class="p">,</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">,</span> <span class="n">MuData</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">dict</span>  <span class="c1"># type: ignore[invalid-type-form]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">raw_user_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trainer_type</span> <span class="o">=</span> <span class="n">trainer_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span> <span class="o">=</span> <span class="n">model_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loss_type</span> <span class="o">=</span> <span class="n">loss_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_preprocessor_type</span> <span class="o">=</span> <span class="n">preprocessor_type</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_user_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_user_data</span><span class="p">,</span> <span class="n">datacase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_direct_user_data</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_user_data</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_case</span> <span class="o">=</span> <span class="n">datacase</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fill_data_info</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ontologies</span> <span class="o">=</span> <span class="n">ontologies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_preprocessor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocessor_type</span><span class="p">(</span>
            <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">ontologies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ontologies</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_visualizer</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">visualizer</span><span class="p">()</span>  <span class="c1"># ty: ignore[call-non-callable]</span>
            <span class="k">if</span> <span class="n">visualizer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">BaseVisualizer</span><span class="p">()</span>  <span class="c1"># ty: ignore[call-non-callable]</span>
        <span class="p">)</span>  <span class="c1"># ty: ignore[call-non-callable]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_evaluator</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">evaluator</span><span class="p">()</span>  <span class="c1"># ty: ignore[call-non-callable]</span>
            <span class="k">if</span> <span class="n">evaluator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">BaseEvaluator</span><span class="p">()</span>  <span class="c1"># ty: ignore[call-non-callable]</span>
        <span class="p">)</span>  <span class="c1"># ty: ignore[call-non-callable]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Result</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_type</span> <span class="o">=</span> <span class="n">dataset_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_splitter</span> <span class="o">=</span> <span class="n">datasplitter_type</span><span class="p">(</span>
            <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">custom_splits</span><span class="o">=</span><span class="n">custom_split</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DatasetContainer</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">processed_data</span>  <span class="c1"># None, or user input</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets config to default if None, or validates its type.</span>
<span class="sd">        Args:</span>
<span class="sd">            config: Configuration object to validate or set to default.</span>
<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If config is not of type DefaultConfig</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_config</span>  <span class="c1"># type: ignore</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">DefaultConfig</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Expected config type to be DefaultConfig, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_config</span><span class="p">)):</span>  <span class="c1"># type: ignore</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Your config is of type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="si">}</span><span class="s2">, for this pipeline the default params of: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_config</span><span class="p">)</span><span class="si">}</span><span class="s2"> work best&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_user_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensures that user-provided data is of a valid type.</span>
<span class="sd">        Args:</span>
<span class="sd">            data: User-provided data to validate.</span>
<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If data is not of a supported type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="n">DataPackage</span><span class="p">,</span>
                <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">,</span>
                <span class="n">MuData</span><span class="p">,</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                <span class="nb">dict</span><span class="p">,</span>
                <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
                <span class="n">DatasetContainer</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expected data type to be one of [DataPackage, AnnData, MuData, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;pd.DataFrame, dict, DatasetContainer], got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_direct_user_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">DataPackage</span><span class="p">,</span> <span class="n">DataCase</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts raw user data into a standardized DataPackage format.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: Raw input data in various formats.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataPackage containing the standardized data</span>
<span class="sd">            DataCase, muliti_single_cell or multi_bulk, etc.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If data format is not supported.</span>
<span class="sd">            ValueError: If data doesn&#39;t meet format requirements or data_case</span>
<span class="sd">                cannot be inferred.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;in handle_direct_user_data with data: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">data_case</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_case</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">DataPackage</span><span class="p">):</span>
            <span class="n">data_package</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">data_case</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_case</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">):</span>
            <span class="n">mudata</span> <span class="o">=</span> <span class="n">MuData</span><span class="p">({</span><span class="s2">&quot;user-data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">})</span>
            <span class="n">data_package</span> <span class="o">=</span> <span class="n">DataPackage</span><span class="p">(</span><span class="n">multi_sc</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;multi_sc&quot;</span><span class="p">:</span> <span class="n">mudata</span><span class="p">})</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_case</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data_case</span> <span class="o">=</span> <span class="n">DataCase</span><span class="o">.</span><span class="n">MULTI_SINGLE_CELL</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">MuData</span><span class="p">):</span>
            <span class="n">data_package</span> <span class="o">=</span> <span class="n">DataPackage</span><span class="p">(</span><span class="n">multi_sc</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;multi_sc&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">})</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_case</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data_case</span> <span class="o">=</span> <span class="n">DataCase</span><span class="o">.</span><span class="n">MULTI_SINGLE_CELL</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">data_package</span> <span class="o">=</span> <span class="n">DataPackage</span><span class="p">(</span><span class="n">multi_bulk</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;user-data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">})</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_case</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data_case</span> <span class="o">=</span> <span class="n">DataCase</span><span class="o">.</span><span class="n">MULTI_BULK</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># Check if all values in the dictionary are pandas DataFrames</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">data_package</span> <span class="o">=</span> <span class="n">DataPackage</span><span class="p">(</span><span class="n">multi_bulk</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_case</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">data_case</span> <span class="o">=</span> <span class="n">DataCase</span><span class="o">.</span><span class="n">MULTI_BULK</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;All values in the dictionary must be pandas DataFrames.&quot;</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">data_case</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;data_case must be provided if it cannot be inferred.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_package</span><span class="p">,</span> <span class="n">data_case</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_raw_user_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates the format and content of user-provided raw data.</span>

<span class="sd">        Ensures that raw_user_data is a valid DataPackage with properly formatted</span>
<span class="sd">        attributes.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If raw_user_data is not a DataPackage.</span>
<span class="sd">            ValueError: If DataPackage attributes aren&#39;t dictionaries or all are None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_user_data</span><span class="p">,</span> <span class="n">DataPackage</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expected raw_user_data to be of type DataPackage, got &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_user_data</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="n">all_none</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_user_data</span><span class="o">.</span><span class="vm">__annotations__</span><span class="p">:</span>
            <span class="n">attr_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_user_data</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attr_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">all_none</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Attribute &#39;</span><span class="si">{</span><span class="n">attr_name</span><span class="si">}</span><span class="s2">&#39; of raw_user_data must be a dictionary, &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">attr_value</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="n">all_none</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;All attributes of raw_user_data are None. At least one must be non-None.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fill_data_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Populates the config&#39;s data_info with entries for all data keys.</span>

<span class="sd">        Creates DataInfo objects for each data key found in raw_user_data</span>
<span class="sd">        if they don&#39;t already exist in the configuration.</span>
<span class="sd">        This method is needed, when the user provides data via the Pipeline and</span>
<span class="sd">        not via the config.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_user_data</span><span class="o">.</span><span class="vm">__annotations__</span><span class="p">:</span>
            <span class="n">attr_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_user_data</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="n">all_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">all_keys</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">attr_value</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attr_value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">MuData</span><span class="p">):</span>
                        <span class="n">all_keys</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">all_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_config</span><span class="o">.</span><span class="n">data_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_config</span><span class="o">.</span><span class="n">data_info</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">DataInfo</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_user_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates user-provided data based on its source and format.</span>

<span class="sd">        Performs different validation based on whether the user provided</span>
<span class="sd">        preprocessed data, raw data, or a data configuration.</span>

<span class="sd">        Raises:</span>
<span class="sd">            Various exceptions depending on validation results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_user_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># case when user passes preprocessed data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_container</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># user passes data via config</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_config_data</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_raw_user_data</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_container</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates that a DatasetContainer has at least one valid dataset.</span>

<span class="sd">        Ensures the container has properly formatted datasets and at least</span>
<span class="sd">        one split is present.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If container validation fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessed_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;DatasetContainer is None. Please provide valid datasets.&quot;</span><span class="p">)</span>
        <span class="n">none_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessed_data</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessed_data</span><span class="o">.</span><span class="n">train</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Train dataset has to be either None or Dataset, got &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessed_data</span><span class="o">.</span><span class="n">train</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">none_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessed_data</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessed_data</span><span class="o">.</span><span class="n">test</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Test dataset has to be either None or Dataset, got &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessed_data</span><span class="o">.</span><span class="n">test</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">none_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessed_data</span><span class="o">.</span><span class="n">valid</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessed_data</span><span class="o">.</span><span class="n">valid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Valid dataset has to be either None or Dataset, got &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessed_data</span><span class="o">.</span><span class="n">valid</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">none_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">none_count</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one split needs to be provided&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_config_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates the data configuration provided via config.</span>

<span class="sd">        Ensures the data configuration has the necessary components based</span>
<span class="sd">        on the data types being processed.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If data configuration validation fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_info_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_config</span><span class="o">.</span><span class="n">data_info</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data_info_dict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;data_info dictionary is empty.&quot;</span><span class="p">)</span>

        <span class="c1"># Check if there&#39;s at least one non-annotation file</span>
        <span class="n">non_annotation_files</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">info</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">data_info_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">data_type</span> <span class="o">!=</span> <span class="s2">&quot;ANNOTATION&quot;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">non_annotation_files</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one non-annotation file must be provided.&quot;</span><span class="p">)</span>

        <span class="c1"># Check if there&#39;s any non-single-cell data</span>
        <span class="n">non_single_cell_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">info</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">data_info_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">info</span><span class="o">.</span><span class="n">is_single_cell</span> <span class="ow">and</span> <span class="n">info</span><span class="o">.</span><span class="n">data_type</span> <span class="o">!=</span> <span class="s2">&quot;ANNOTATION&quot;</span>
        <span class="p">}</span>

        <span class="c1"># If there&#39;s non-single-cell data, check for annotation file</span>
        <span class="k">if</span> <span class="n">non_single_cell_data</span><span class="p">:</span>
            <span class="n">annotation_files</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">key</span><span class="p">:</span> <span class="n">info</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">data_info_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;ANNOTATION&quot;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">annotation_files</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;When working with non-single-cell data, an annotation file must be &quot;</span>
                    <span class="s2">&quot;provided.&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">DefaultConfig</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filters, normalizes and prepares data for model training.</span>

<span class="sd">        Processes raw input data into the format required by the model and creates</span>
<span class="sd">        train/validation/test splits as needed.</span>

<span class="sd">        Args:</span>
<span class="sd">            config: Optional custom configuration for preprocessing.</span>
<span class="sd">            **kwargs: Additional configuration parameters as keyword arguments.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: If preprocessor is not initialized.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocessor_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Preprocessor not initialized&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_user_data</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessed_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocessor</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span>
                <span class="n">raw_user_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_user_data</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">datasets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessed_data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">datasets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessed_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">DefaultConfig</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Trains the model on preprocessed data.</span>

<span class="sd">        Creates and configures a trainer instance, then executes the training</span>
<span class="sd">        process using the preprocessed datasets.</span>

<span class="sd">        Args:</span>
<span class="sd">            config: Optional custom configuration for training.</span>
<span class="sd">            **kwargs: Additional configuration parameters as keyword arguments.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If datasets aren&#39;t available for training.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Datasets not built. Please run the preprocess method first.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_trainer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trainer_type</span><span class="p">(</span>
            <span class="n">trainset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span><span class="o">.</span><span class="n">train</span><span class="p">,</span>
            <span class="n">validset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span><span class="o">.</span><span class="n">valid</span><span class="p">,</span>
            <span class="n">result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
            <span class="n">model_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span><span class="p">,</span>
            <span class="n">loss_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_loss_type</span><span class="p">,</span>
            <span class="n">ontologies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ontologies</span><span class="p">,</span>  <span class="c1"># Ontix</span>
        <span class="p">)</span>
        <span class="n">trainer_result</span><span class="p">:</span> <span class="n">Result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trainer</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">trainer_result</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span>
                <span class="n">DataPackage</span><span class="p">,</span>
                <span class="n">DatasetContainer</span><span class="p">,</span>
                <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">,</span>
                <span class="n">MuData</span><span class="p">,</span>  <span class="c1"># ty: ignore[invalid-type-form]</span>
            <span class="p">]</span>  <span class="c1"># ty: ignore[invalid-type-form]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># ty: ignore[invalid-type-form]</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">DefaultConfig</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">from_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">to_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates predictions using the trained model.</span>

<span class="sd">        Uses the trained model to make predictions on test data or new data</span>
<span class="sd">        provided by the user. Processes the results and stores them in the</span>
<span class="sd">        result container.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: Optional new data for predictions.</span>
<span class="sd">            config: Optional custom configuration for prediction.</span>
<span class="sd">            **kwargs: Additional configuration parameters as keyword arguments.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: If required components aren&#39;t initialized.</span>
<span class="sd">            ValueError: If no test data is available or data format is invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_prediction_requirements</span><span class="p">()</span>

        <span class="n">original_input</span> <span class="o">=</span> <span class="n">data</span>
        <span class="n">predict_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_prediction_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

        <span class="n">predictor_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_predictions</span><span class="p">(</span>
            <span class="n">predict_data</span><span class="o">=</span><span class="n">predict_data</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_process_latent_results</span><span class="p">(</span>
            <span class="n">predictor_results</span><span class="o">=</span><span class="n">predictor_results</span><span class="p">,</span> <span class="n">predict_data</span><span class="o">=</span><span class="n">predict_data</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_reconstruction</span><span class="p">(</span>
            <span class="n">predictor_results</span><span class="o">=</span><span class="n">predictor_results</span><span class="p">,</span>
            <span class="n">original_input</span><span class="o">=</span><span class="n">original_input</span><span class="p">,</span>
            <span class="n">predict_data</span><span class="o">=</span><span class="n">predict_data</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_prediction_requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate that required components are initialized.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocessor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Preprocessor not initialized&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;Model not trained. Please run the fit method first&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prepare_prediction_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span>
                <span class="n">DataPackage</span><span class="p">,</span>
                <span class="n">DatasetContainer</span><span class="p">,</span>
                <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">,</span>
                <span class="n">MuData</span><span class="p">,</span>  <span class="c1"># ty: ignore[invalid-type-form]</span>
            <span class="p">]</span>  <span class="c1"># ty: ignore[invalid-type-form]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># ty: ignore[invalid-type-form]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetContainer</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare and validate input data for prediction.</span>
<span class="sd">        Args:</span>
<span class="sd">            data: Optional new data for predictions. If None, uses existing datasets.</span>
<span class="sd">        Returns:</span>
<span class="sd">            DatasetContainer: The prepared dataset container for predictions.</span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If data type is unsupported or no test data is available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_existing_datasets</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">DatasetContainer</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_dataset_container</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">DataPackage</span><span class="p">,</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">,</span> <span class="n">MuData</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_user_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported data type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_existing_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetContainer</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get existing preprocessed datasets and validate them for prediction.</span>
<span class="sd">        Returns:</span>
<span class="sd">            DatasetContainer: The preprocessed datasets available for prediction.</span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If no datasets are available or no test data is present.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;No data provided for prediction and no preprocessed datasets &quot;</span>
                <span class="s2">&quot;available. Please run the preprocess method first or provide &quot;</span>
                <span class="s2">&quot;data for prediction.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span><span class="o">.</span><span class="n">test</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No test data available for prediction&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_dataset_container</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DatasetContainer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetContainer</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle DatasetContainer input for prediction.</span>
<span class="sd">        Args:</span>
<span class="sd">            data: DatasetContainer containing preprocessed datasets.</span>
<span class="sd">        Returns:</span>
<span class="sd">            DatasetContainer: The processed dataset container for predictions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">new_datasets</span> <span class="o">=</span> <span class="n">data</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_preprocessor</span><span class="p">,</span> <span class="s2">&quot;_dataset_container&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_preprocessor</span><span class="o">.</span><span class="n">_dataset_container</span> <span class="o">=</span> <span class="n">data</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_user_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetContainer</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle user-provided data (DataPackage, AnnData, etc.).</span>
<span class="sd">        Args:</span>
<span class="sd">            data: Raw user data in various formats (DataPackage, AnnData, etc.).</span>
<span class="sd">        Returns:</span>
<span class="sd">            DatasetContainer: The processed dataset container for predictions.</span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If data type is unsupported or no test data is available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">processed_data</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_direct_user_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">predict_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocessor</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span>
            <span class="n">raw_user_data</span><span class="o">=</span><span class="n">processed_data</span><span class="p">,</span> <span class="n">predict_new_data</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">new_datasets</span> <span class="o">=</span> <span class="n">predict_data</span>
        <span class="k">return</span> <span class="n">predict_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_prediction_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predict_data</span><span class="p">:</span> <span class="n">DatasetContainer</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate that prediction data has required test split.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">predict_data</span><span class="o">.</span><span class="n">test</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The data for prediction need to be a DatasetContainer with a test &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;attribute, got: </span><span class="si">{</span><span class="n">predict_data</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_predictions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">predict_data</span><span class="p">:</span> <span class="n">DatasetContainer</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate predictions using the trained model.</span>
<span class="sd">        Args:</span>
<span class="sd">            predict_data: DatasetContainer with preprocessed datasets for prediction.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Predictor results containing latent spaces and reconstructions.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_prediction_data</span><span class="p">(</span><span class="n">predict_data</span><span class="o">=</span><span class="n">predict_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trainer</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">predict_data</span><span class="o">.</span><span class="n">test</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
        <span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_latent_results</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">predictor_results</span><span class="p">,</span> <span class="n">predict_data</span><span class="p">:</span> <span class="n">DatasetContainer</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process and store latent space results.</span>
<span class="sd">        Args:</span>
<span class="sd">            predictor_results: Results from the prediction step containing latents.</span>
<span class="sd">            predict_data: DatasetContainer with preprocessed datasets for prediction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">latent</span> <span class="o">=</span> <span class="n">predictor_results</span><span class="o">.</span><span class="n">latentspaces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">epoch</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">latent</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Detected dictionary in latent results, extracting array...&quot;</span><span class="p">)</span>
            <span class="n">latent</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">latent</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>  <span class="c1"># TODO better adjust for xmodal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">adata_latent</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">(</span><span class="n">latent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">adata_latent</span><span class="o">.</span><span class="n">obs_names</span> <span class="o">=</span> <span class="n">predict_data</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">sample_ids</span>  <span class="c1"># type: ignore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">adata_latent</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s2">&quot;var_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">predict_data</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">feature_ids</span>  <span class="c1"># type: ignore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">predictor_results</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_postprocess_reconstruction</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">predictor_results</span><span class="p">,</span> <span class="n">original_input</span><span class="p">,</span> <span class="n">predict_data</span><span class="p">:</span> <span class="n">DatasetContainer</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Postprocess reconstruction results based on input type.</span>

<span class="sd">        This outpus the reconstruction in the same format as the original input data,</span>
<span class="sd">        whether it is a DatasetContainer, DataPackage, AnnData, MuData, or other formats.</span>

<span class="sd">        Args:</span>
<span class="sd">            predictor_results: Results from the prediction step containing reconstructions.</span>
<span class="sd">            original_input: Original input data format (if provided).</span>
<span class="sd">            predict_data: DatasetContainer with preprocessed datasets for prediction.</span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If reconstruction fails or data types are incompatible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raw_recon</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">reconstructions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">epoch</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_recon</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">raw_recon</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">raw_recon</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_recon</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">raw_recon</span> <span class="o">=</span> <span class="n">raw_recon</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;translation&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
            <span class="k">if</span> <span class="n">raw_recon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Raw recon is dict, but has no translation key, this should not happen: </span><span class="si">{</span><span class="n">raw_recon</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">raw_recon</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">raw_recon</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;type of raw_recon has to be &#39;dict&#39; or &#39;np.ndarray&#39;, got: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">raw_recon</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">original_input</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Using existing datasets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_dataset_container_reconstruction</span><span class="p">(</span>
                <span class="n">raw_recon</span><span class="o">=</span><span class="n">raw_recon</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
                <span class="n">dataset_container</span><span class="o">=</span><span class="n">predict_data</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="s2">&quot;existing datasets&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">original_input</span><span class="p">,</span> <span class="n">DatasetContainer</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_dataset_container_reconstruction</span><span class="p">(</span>
                <span class="n">raw_recon</span><span class="o">=</span><span class="n">raw_recon</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
                <span class="n">dataset_container</span><span class="o">=</span><span class="n">original_input</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="s2">&quot;provided DatasetContainer&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_case</span> <span class="o">==</span> <span class="n">DataCase</span><span class="o">.</span><span class="n">MULTI_SINGLE_CELL</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_multi_single_cell_reconstruction</span><span class="p">(</span>
                <span class="n">raw_recon</span><span class="o">=</span><span class="n">raw_recon</span><span class="p">,</span>
                <span class="n">predictor_results</span><span class="o">=</span><span class="n">predictor_results</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">original_input</span><span class="p">,</span> <span class="p">(</span><span class="n">DataPackage</span><span class="p">,</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">,</span> <span class="n">MuData</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_user_data_reconstruction</span><span class="p">(</span>
                <span class="n">raw_recon</span><span class="o">=</span><span class="n">raw_recon</span><span class="p">,</span> <span class="n">predictor_results</span><span class="o">=</span><span class="n">predictor_results</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_unsupported_reconstruction</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_dataset_container_reconstruction</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">raw_recon</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">dataset_container</span><span class="p">:</span> <span class="n">DatasetContainer</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DatasetContainer&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle reconstruction for DatasetContainer input.</span>
<span class="sd">        Args:</span>
<span class="sd">            raw_recon: Raw reconstruction tensor from the model.</span>
<span class="sd">            dataset_container: Original DatasetContainer provided by the user.</span>
<span class="sd">            context: Description of the data context for error messages.</span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If no test data is available in the container.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dataset_container</span><span class="o">.</span><span class="n">test</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No test data available in </span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2"> for reconstruction.&quot;</span><span class="p">)</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dataset_container</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
        <span class="n">temp</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">raw_recon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">final_reconstruction</span> <span class="o">=</span> <span class="n">temp</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_multi_single_cell_reconstruction</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">raw_recon</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">predictor_results</span><span class="p">:</span> <span class="n">Result</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle reconstruction for multi-single-cell data</span>
<span class="sd">        Args:</span>
<span class="sd">            raw_recon: Raw reconstruction tensor from the model.</span>
<span class="sd">            predictor_results: Results from the prediction step containing reconstructions.</span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If reconstruction formatting fails or data types are incompatible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pkg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocessor</span><span class="o">.</span><span class="n">format_reconstruction</span><span class="p">(</span>
            <span class="n">reconstruction</span><span class="o">=</span><span class="n">raw_recon</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">predictor_results</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="n">multi_sc</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Expected pkg.multi_sc to be a dictionary, got &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="n">multi_sc</span><span class="p">)</span><span class="si">}</span><span class="s2"> instead.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">final_reconstruction</span> <span class="o">=</span> <span class="n">pkg</span><span class="o">.</span><span class="n">multi_sc</span><span class="p">[</span><span class="s2">&quot;multi_sc&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_user_data_reconstruction</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">raw_recon</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">predictor_results</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle reconstruction for user-provided data formats.</span>
<span class="sd">        Args:</span>
<span class="sd">            raw_recon: Raw reconstruction tensor from the model.</span>
<span class="sd">            predictor_results: Results from the prediction step containing reconstructions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pkg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocessor</span><span class="o">.</span><span class="n">format_reconstruction</span><span class="p">(</span>
            <span class="n">reconstruction</span><span class="o">=</span><span class="n">raw_recon</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">predictor_results</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">final_reconstruction</span> <span class="o">=</span> <span class="n">pkg</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_unsupported_reconstruction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle cases where reconstruction formatting is not available.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Reconstruction Formatting (the process of using the reconstruction &quot;</span>
            <span class="s2">&quot;output of the autoencoder models and combine it with metadata to get &quot;</span>
            <span class="s2">&quot;the exact same data structure as the raw input data i.e, a DataPackage, &quot;</span>
            <span class="s2">&quot;DatasetContainer, or AnnData) not available for this data type or case.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">decode</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">latent</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transforms latent space representations back to input space.</span>

<span class="sd">        Handles various input formats for the latent representation and</span>
<span class="sd">        returns the decoded data in a matching format.</span>

<span class="sd">        Args:</span>
<span class="sd">            latent: Latent space representation to decode.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Decoded data in a format matching the input.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If no model has been trained or input type is invalid.</span>
<span class="sd">            ValueError: If latent dimensions are incompatible with the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;No model trained yet, use fit() or run() method first&quot;</span><span class="p">)</span>
        <span class="n">recons</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">latent</span><span class="p">,</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">):</span>
            <span class="n">latent_data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
                <span class="n">latent</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span>
            <span class="p">)</span>  <span class="c1"># Ensure float for compatibility</span>

            <span class="n">expected_latent_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">latent_dim</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">latent_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">expected_latent_dim</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Input AnnData&#39;s .X has shape </span><span class="si">{</span><span class="n">latent_data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, but the model &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;expects a latent vector of size </span><span class="si">{</span><span class="n">expected_latent_dim</span><span class="si">}</span><span class="s2">. Consider &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;projecting the AnnData to the correct latent space first.&quot;</span>
                <span class="p">)</span>
            <span class="n">latent_tensor</span> <span class="o">=</span> <span class="n">latent_data</span>

            <span class="n">recons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trainer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">latent_tensor</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;No datasets available in the DatasetContainer to reconstruct &quot;</span>
                    <span class="s2">&quot;AnnData objects. Please provide a valid DatasetContainer.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span><span class="o">.</span><span class="n">train</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;The train dataset in the DatasetContainer is None. &quot;</span>
                    <span class="s2">&quot;Please provide a valid train dataset to reconstruct AnnData objects.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">BaseDataset</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;The train dataset in the DatasetContainer must be a BaseDataset &quot;</span>
                    <span class="s2">&quot;to reconstruct AnnData objects.&quot;</span>
                <span class="p">)</span>
            <span class="n">recons_adata</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">(</span>
                <span class="n">X</span><span class="o">=</span><span class="n">recons</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
                <span class="n">obs</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">latent</span><span class="o">.</span><span class="n">obs_names</span><span class="p">),</span>
                <span class="n">var</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">feature_ids</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">recons_adata</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">latent</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">latent_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">latent</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            <span class="n">recons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trainer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">latent_tensor</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="n">recons</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
                <span class="n">index</span><span class="o">=</span><span class="n">latent</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                <span class="n">columns</span><span class="o">=</span><span class="n">latent</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">latent</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
            <span class="c1"># Check size compatibility</span>
            <span class="n">expected_latent_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">latent_dim</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">latent</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">expected_latent_dim</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Input tensor has shape </span><span class="si">{</span><span class="n">latent</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, but the model expects a &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;latent vector of size </span><span class="si">{</span><span class="n">expected_latent_dim</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="n">latent_tensor</span> <span class="o">=</span> <span class="n">latent</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Input &#39;latent&#39; must be either a torch.Tensor or an AnnData object, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">latent</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trainer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">latent_tensor</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ml_model_class</span><span class="p">:</span> <span class="n">ClassifierMixin</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LogisticRegression</span><span class="p">(),</span>  <span class="c1"># Default is sklearn LogisticRegression</span>
        <span class="n">ml_model_regression</span><span class="p">:</span> <span class="n">RegressorMixin</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">(),</span>  <span class="c1"># Default is sklearn LinearRegression</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="nb">list</span><span class="p">,</span> <span class="nb">str</span>
        <span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>  <span class="c1"># Default empty list, to use all parameters use string &quot;all&quot;</span>
        <span class="n">metric_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;roc_auc_ovo&quot;</span><span class="p">,</span>  <span class="c1"># Default is &#39;roc_auc_ovo&#39; via https://scikit-learn.org/stable/modules/model_evaluation.html#scoring-string-names</span>
        <span class="n">metric_regression</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;r2&quot;</span><span class="p">,</span>  <span class="c1"># Default is &#39;r2&#39;</span>
        <span class="n">reference_methods</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>  <span class="c1"># Default [], Options are &quot;PCA&quot;, &quot;UMAP&quot;, &quot;TSNE&quot;, &quot;RandomFeature&quot;</span>
        <span class="n">split_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;use-split&quot;</span><span class="p">,</span>  <span class="c1"># Default is &quot;use-split&quot;, other options: &quot;CV-5&quot;, ... &quot;LOOCV&quot;?</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TODO&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Evaluator not initialized&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;Model not trained. Please run the fit method first&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_classifier</span><span class="p">(</span><span class="n">ml_model_class</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The provided model is not a sklearn-type classifier. &quot;</span>
                <span class="s2">&quot;Evaluation continues but may produce incorrect results or errors.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_regressor</span><span class="p">(</span><span class="n">ml_model_regression</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The provided model is not a sklearn-type regressor. &quot;</span>
                <span class="s2">&quot;Evaluation continues but may produce incorrect results or errors.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
            <span class="n">datasets</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span><span class="p">,</span>
            <span class="n">result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span>
            <span class="n">ml_model_class</span><span class="o">=</span><span class="n">ml_model_class</span><span class="p">,</span>
            <span class="n">ml_model_regression</span><span class="o">=</span><span class="n">ml_model_regression</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
            <span class="n">metric_class</span><span class="o">=</span><span class="n">metric_class</span><span class="p">,</span>
            <span class="n">metric_regression</span><span class="o">=</span><span class="n">metric_regression</span><span class="p">,</span>
            <span class="n">reference_methods</span><span class="o">=</span><span class="n">reference_methods</span><span class="p">,</span>
            <span class="n">split_type</span><span class="o">=</span><span class="n">split_type</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">_</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visualizer</span><span class="o">.</span><span class="n">_plot_evaluation</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visualize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">DefaultConfig</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates visualizations of model results and performance.</span>

<span class="sd">        Args:</span>
<span class="sd">            config: Optional custom configuration for visualization.</span>
<span class="sd">            **kwargs: Additional configuration parameters.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: If visualizer is not initialized.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visualizer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Visualizer not initialized&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_visualizer</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">show_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Displays key visualizations of model results.</span>

<span class="sd">        This method generates the following visualizations:</span>
<span class="sd">        1. Loss Curves: Displays the absolute loss curves to provide insights into</span>
<span class="sd">           the model&#39;s training and validation performance over epochs.</span>
<span class="sd">        2. Latent Space Ridgeline Plot: Visualizes the distribution of the latent</span>
<span class="sd">           space representations across different dimensions, offering a high-level</span>
<span class="sd">           overview of the learned embeddings.</span>
<span class="sd">        3. Latent Space 2D Scatter Plot: Projects the latent space into two dimensions</span>
<span class="sd">           for a detailed view of the clustering or separation of data points.</span>

<span class="sd">        These visualizations help in understanding the model&#39;s performance and</span>
<span class="sd">        the structure of the latent space representations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating plots ...&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_visualizer</span><span class="o">.</span><span class="n">show_loss</span><span class="p">(</span><span class="n">plot_type</span><span class="o">=</span><span class="s2">&quot;absolute&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_visualizer</span><span class="o">.</span><span class="n">show_latent_space</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s2">&quot;Ridgeline&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_visualizer</span><span class="o">.</span><span class="n">show_latent_space</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s2">&quot;2D-scatter&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">DatasetContainer</span><span class="p">,</span> <span class="n">DataPackage</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes the complete pipeline from preprocessing to visualization.</span>

<span class="sd">        Runs all pipeline steps in sequence and returns the result.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: Optional data for prediction (overrides test data).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Complete pipeline results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves the pipeline to a file.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path: Path where the pipeline should be saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">saver</span> <span class="o">=</span> <span class="n">Saver</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">saver</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads a pipeline from a file.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path: Path to the saved pipeline.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The loaded pipeline instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">Loader</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">loader</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BasePipeline.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">dataset_type</span><span class="p">,</span> <span class="n">trainer_type</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="n">loss_type</span><span class="p">,</span> <span class="n">datasplitter_type</span><span class="p">,</span> <span class="n">preprocessor_type</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">visualizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">custom_split</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ontologies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes the pipeline with components and configuration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dataset_type</code>
            </td>
            <td>
                  <code><span title="typing.Type">Type</span>[<a class="autorefs autorefs-internal" title="BaseDataset (autoencodix.base._base_dataset.BaseDataset)" href="#autoencodix.base.BaseDataset">BaseDataset</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Class for dataset implementations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trainer_type</code>
            </td>
            <td>
                  <code><span title="typing.Type">Type</span>[<a class="autorefs autorefs-internal" title="BaseTrainer (autoencodix.base._base_trainer.BaseTrainer)" href="#autoencodix.base.BaseTrainer">BaseTrainer</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Class for model training implementations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_type</code>
            </td>
            <td>
                  <code><span title="typing.Type">Type</span>[<a class="autorefs autorefs-internal" title="BaseAutoencoder (autoencodix.base._base_autoencoder.BaseAutoencoder)" href="#autoencodix.base.BaseAutoencoder">BaseAutoencoder</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Class for model architecture implementations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>loss_type</code>
            </td>
            <td>
                  <code><span title="typing.Type">Type</span>[<a class="autorefs autorefs-internal" title="BaseLoss (autoencodix.base._base_loss.BaseLoss)" href="#autoencodix.base.BaseLoss">BaseLoss</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Class for loss function implementations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>datasplitter_type</code>
            </td>
            <td>
                  <code><span title="typing.Type">Type</span>[<a class="autorefs autorefs-internal" title="DataSplitter (autoencodix.data._datasplitter.DataSplitter)" href="../data/#autoencodix.data.DataSplitter">DataSplitter</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Class for data splitting implementation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>preprocessor_type</code>
            </td>
            <td>
                  <code><span title="typing.Type">Type</span>[<a class="autorefs autorefs-internal" title="BasePreprocessor (autoencodix.base._base_preprocessor.BasePreprocessor)" href="#autoencodix.base.BasePreprocessor">BasePreprocessor</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Class for data preprocessing implementation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>visualizer</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="BaseVisualizer (autoencodix.base._base_visualizer.BaseVisualizer)" href="#autoencodix.base.BaseVisualizer">BaseVisualizer</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Component for generating visualizations.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="DataPackage


  
      dataclass
   (autoencodix.data.datapackage.DataPackage)" href="../data/#autoencodix.data.DataPackage">DataPackage</a>, <a class="autorefs autorefs-internal" title="DatasetContainer


  
      dataclass
   (autoencodix.data._datasetcontainer.DatasetContainer)" href="../data/#autoencodix.data.DatasetContainer">DatasetContainer</a>, <span title="anndata.AnnData">AnnData</span>, <span title="mudata.MuData">MuData</span>, <span title="pandas.DataFrame">DataFrame</span>, <span title="dict">dict</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input data to be processed or already processed data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>evaluator</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="BaseEvaluator (autoencodix.base._base_evaluator.BaseEvaluator)" href="#autoencodix.base.BaseEvaluator">BaseEvaluator</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Component for assessing model performance.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="Result


  
      dataclass
   (autoencodix.utils._result.Result)" href="../utils/#autoencodix.utils.Result">Result</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage container for pipeline outputs.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="DefaultConfig (autoencodix.configs.default_config.DefaultConfig)" href="../configs/#autoencodix.configs.DefaultConfig">DefaultConfig</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration parameters for all pipeline components.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>custom_split</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="numpy.ndarray">ndarray</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User-provided data splits (train/validation/test).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="TypeError">TypeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If inputs have incorrect types.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataset_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseDataset</span><span class="p">],</span>
    <span class="n">trainer_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseTrainer</span><span class="p">],</span>
    <span class="n">model_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseAutoencoder</span><span class="p">],</span>
    <span class="n">loss_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseLoss</span><span class="p">],</span>
    <span class="n">datasplitter_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">DataSplitter</span><span class="p">],</span>
    <span class="n">preprocessor_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BasePreprocessor</span><span class="p">],</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span><span class="n">DataPackage</span><span class="p">,</span> <span class="n">DatasetContainer</span><span class="p">,</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">,</span> <span class="n">MuData</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>  <span class="c1"># type: ignore[invalid-type-form]</span>
    <span class="p">],</span>
    <span class="n">visualizer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseVisualizer</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">evaluator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseEvaluator</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Result</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DefaultConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">custom_split</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ontologies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># ty: ignore[call-non-callable]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the pipeline with components and configuration.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset_type: Class for dataset implementations.</span>
<span class="sd">        trainer_type: Class for model training implementations.</span>
<span class="sd">        model_type: Class for model architecture implementations.</span>
<span class="sd">        loss_type: Class for loss function implementations.</span>
<span class="sd">        datasplitter_type: Class for data splitting implementation.</span>
<span class="sd">        preprocessor_type: Class for data preprocessing implementation.</span>
<span class="sd">        visualizer: Component for generating visualizations.</span>
<span class="sd">        data: Input data to be processed or already processed data.</span>
<span class="sd">        evaluator: Component for assessing model performance.</span>
<span class="sd">        result: Storage container for pipeline outputs.</span>
<span class="sd">        config: Configuration parameters for all pipeline components.</span>
<span class="sd">        custom_split: User-provided data splits (train/validation/test).</span>
<span class="sd">        **kwargs: Additional keyword arguments.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: If inputs have incorrect types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_default_config&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                        The _default_config attribute has not been specified in your pipeline class.</span>

<span class="sd">                        Example:</span>
<span class="sd">                        self._default_config = XModalixConfig()</span>

<span class="sd">                        This error typically occurs when a new architecture is added without setting the</span>
<span class="sd">                        _default_config in its corresponding pipeline class.</span>

<span class="sd">                        For more details, please refer to the &#39;how to add a new architecture&#39; section in our documentation.</span>
<span class="sd">                        &quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_config</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_user_input</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="n">processed_data</span> <span class="o">=</span> <span class="n">data</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">DatasetContainer</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">raw_user_data</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">data</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">DataPackage</span><span class="p">,</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">,</span> <span class="n">MuData</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">dict</span><span class="p">))</span>
        <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">processed_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
        <span class="n">processed_data</span><span class="p">,</span> <span class="n">DatasetContainer</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Expected data type to be DatasetContainer, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">processed_data</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">preprocessed_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DatasetContainer</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed_data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">raw_user_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">DataPackage</span><span class="p">,</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">,</span> <span class="n">MuData</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">dict</span>  <span class="c1"># type: ignore[invalid-type-form]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="n">raw_user_data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_trainer_type</span> <span class="o">=</span> <span class="n">trainer_type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span> <span class="o">=</span> <span class="n">model_type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_loss_type</span> <span class="o">=</span> <span class="n">loss_type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_preprocessor_type</span> <span class="o">=</span> <span class="n">preprocessor_type</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_user_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_user_data</span><span class="p">,</span> <span class="n">datacase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_direct_user_data</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_user_data</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_case</span> <span class="o">=</span> <span class="n">datacase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_data_info</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_ontologies</span> <span class="o">=</span> <span class="n">ontologies</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_preprocessor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocessor_type</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">ontologies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ontologies</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_visualizer</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">visualizer</span><span class="p">()</span>  <span class="c1"># ty: ignore[call-non-callable]</span>
        <span class="k">if</span> <span class="n">visualizer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="n">BaseVisualizer</span><span class="p">()</span>  <span class="c1"># ty: ignore[call-non-callable]</span>
    <span class="p">)</span>  <span class="c1"># ty: ignore[call-non-callable]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_evaluator</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">evaluator</span><span class="p">()</span>  <span class="c1"># ty: ignore[call-non-callable]</span>
        <span class="k">if</span> <span class="n">evaluator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="n">BaseEvaluator</span><span class="p">()</span>  <span class="c1"># ty: ignore[call-non-callable]</span>
    <span class="p">)</span>  <span class="c1"># ty: ignore[call-non-callable]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Result</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_type</span> <span class="o">=</span> <span class="n">dataset_type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data_splitter</span> <span class="o">=</span> <span class="n">datasplitter_type</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">custom_splits</span><span class="o">=</span><span class="n">custom_split</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DatasetContainer</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">processed_data</span>  <span class="c1"># None, or user input</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BasePipeline.decode" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">decode</span><span class="p">(</span><span class="n">latent</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Transforms latent space representations back to input space.</p>
<p>Handles various input formats for the latent representation and
returns the decoded data in a matching format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>latent</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="torch.Tensor">Tensor</span>, <span title="anndata.AnnData">AnnData</span>, <span title="pandas.DataFrame">DataFrame</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latent space representation to decode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="torch.Tensor">Tensor</span>, <span title="anndata.AnnData">AnnData</span>, <span title="pandas.DataFrame">DataFrame</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Decoded data in a format matching the input.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="TypeError">TypeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no model has been trained or input type is invalid.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If latent dimensions are incompatible with the model.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">decode</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">latent</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transforms latent space representations back to input space.</span>

<span class="sd">    Handles various input formats for the latent representation and</span>
<span class="sd">    returns the decoded data in a matching format.</span>

<span class="sd">    Args:</span>
<span class="sd">        latent: Latent space representation to decode.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Decoded data in a format matching the input.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: If no model has been trained or input type is invalid.</span>
<span class="sd">        ValueError: If latent dimensions are incompatible with the model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;No model trained yet, use fit() or run() method first&quot;</span><span class="p">)</span>
    <span class="n">recons</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">latent</span><span class="p">,</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">):</span>
        <span class="n">latent_data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
            <span class="n">latent</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span>
        <span class="p">)</span>  <span class="c1"># Ensure float for compatibility</span>

        <span class="n">expected_latent_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">latent_dim</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">latent_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">expected_latent_dim</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Input AnnData&#39;s .X has shape </span><span class="si">{</span><span class="n">latent_data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, but the model &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;expects a latent vector of size </span><span class="si">{</span><span class="n">expected_latent_dim</span><span class="si">}</span><span class="s2">. Consider &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;projecting the AnnData to the correct latent space first.&quot;</span>
            <span class="p">)</span>
        <span class="n">latent_tensor</span> <span class="o">=</span> <span class="n">latent_data</span>

        <span class="n">recons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trainer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">latent_tensor</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;No datasets available in the DatasetContainer to reconstruct &quot;</span>
                <span class="s2">&quot;AnnData objects. Please provide a valid DatasetContainer.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span><span class="o">.</span><span class="n">train</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The train dataset in the DatasetContainer is None. &quot;</span>
                <span class="s2">&quot;Please provide a valid train dataset to reconstruct AnnData objects.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">BaseDataset</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;The train dataset in the DatasetContainer must be a BaseDataset &quot;</span>
                <span class="s2">&quot;to reconstruct AnnData objects.&quot;</span>
            <span class="p">)</span>
        <span class="n">recons_adata</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">(</span>
            <span class="n">X</span><span class="o">=</span><span class="n">recons</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
            <span class="n">obs</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">latent</span><span class="o">.</span><span class="n">obs_names</span><span class="p">),</span>
            <span class="n">var</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">feature_ids</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">recons_adata</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">latent</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">latent_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">latent</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">recons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trainer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">latent_tensor</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">recons</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
            <span class="n">index</span><span class="o">=</span><span class="n">latent</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">latent</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">latent</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
        <span class="c1"># Check size compatibility</span>
        <span class="n">expected_latent_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">latent_dim</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">latent</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">expected_latent_dim</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Input tensor has shape </span><span class="si">{</span><span class="n">latent</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, but the model expects a &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;latent vector of size </span><span class="si">{</span><span class="n">expected_latent_dim</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="n">latent_tensor</span> <span class="o">=</span> <span class="n">latent</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Input &#39;latent&#39; must be either a torch.Tensor or an AnnData object, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">latent</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trainer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">latent_tensor</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BasePipeline.evaluate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">evaluate</span><span class="p">(</span><span class="n">ml_model_class</span><span class="o">=</span><span class="n">linear_model</span><span class="o">.</span><span class="n">LogisticRegression</span><span class="p">(),</span> <span class="n">ml_model_regression</span><span class="o">=</span><span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">(),</span> <span class="n">params</span><span class="o">=</span><span class="p">[],</span> <span class="n">metric_class</span><span class="o">=</span><span class="s1">&#39;roc_auc_ovo&#39;</span><span class="p">,</span> <span class="n">metric_regression</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">reference_methods</span><span class="o">=</span><span class="p">[],</span> <span class="n">split_type</span><span class="o">=</span><span class="s1">&#39;use-split&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>TODO</p>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">ml_model_class</span><span class="p">:</span> <span class="n">ClassifierMixin</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LogisticRegression</span><span class="p">(),</span>  <span class="c1"># Default is sklearn LogisticRegression</span>
    <span class="n">ml_model_regression</span><span class="p">:</span> <span class="n">RegressorMixin</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">(),</span>  <span class="c1"># Default is sklearn LinearRegression</span>
    <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="nb">list</span><span class="p">,</span> <span class="nb">str</span>
    <span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>  <span class="c1"># Default empty list, to use all parameters use string &quot;all&quot;</span>
    <span class="n">metric_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;roc_auc_ovo&quot;</span><span class="p">,</span>  <span class="c1"># Default is &#39;roc_auc_ovo&#39; via https://scikit-learn.org/stable/modules/model_evaluation.html#scoring-string-names</span>
    <span class="n">metric_regression</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;r2&quot;</span><span class="p">,</span>  <span class="c1"># Default is &#39;r2&#39;</span>
    <span class="n">reference_methods</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>  <span class="c1"># Default [], Options are &quot;PCA&quot;, &quot;UMAP&quot;, &quot;TSNE&quot;, &quot;RandomFeature&quot;</span>
    <span class="n">split_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;use-split&quot;</span><span class="p">,</span>  <span class="c1"># Default is &quot;use-split&quot;, other options: &quot;CV-5&quot;, ... &quot;LOOCV&quot;?</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;TODO&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Evaluator not initialized&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;Model not trained. Please run the fit method first&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_classifier</span><span class="p">(</span><span class="n">ml_model_class</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;The provided model is not a sklearn-type classifier. &quot;</span>
            <span class="s2">&quot;Evaluation continues but may produce incorrect results or errors.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_regressor</span><span class="p">(</span><span class="n">ml_model_regression</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;The provided model is not a sklearn-type regressor. &quot;</span>
            <span class="s2">&quot;Evaluation continues but may produce incorrect results or errors.&quot;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
        <span class="n">datasets</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span><span class="p">,</span>
        <span class="n">result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span>
        <span class="n">ml_model_class</span><span class="o">=</span><span class="n">ml_model_class</span><span class="p">,</span>
        <span class="n">ml_model_regression</span><span class="o">=</span><span class="n">ml_model_regression</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
        <span class="n">metric_class</span><span class="o">=</span><span class="n">metric_class</span><span class="p">,</span>
        <span class="n">metric_regression</span><span class="o">=</span><span class="n">metric_regression</span><span class="p">,</span>
        <span class="n">reference_methods</span><span class="o">=</span><span class="n">reference_methods</span><span class="p">,</span>
        <span class="n">split_type</span><span class="o">=</span><span class="n">split_type</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">_</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visualizer</span><span class="o">.</span><span class="n">_plot_evaluation</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BasePipeline.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Trains the model on preprocessed data.</p>
<p>Creates and configures a trainer instance, then executes the training
process using the preprocessed datasets.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[None, <a class="autorefs autorefs-internal" title="DefaultConfig (autoencodix.configs.default_config.DefaultConfig)" href="../configs/#autoencodix.configs.DefaultConfig">DefaultConfig</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional custom configuration for training.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional configuration parameters as keyword arguments.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If datasets aren't available for training.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">DefaultConfig</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Trains the model on preprocessed data.</span>

<span class="sd">    Creates and configures a trainer instance, then executes the training</span>
<span class="sd">    process using the preprocessed datasets.</span>

<span class="sd">    Args:</span>
<span class="sd">        config: Optional custom configuration for training.</span>
<span class="sd">        **kwargs: Additional configuration parameters as keyword arguments.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If datasets aren&#39;t available for training.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Datasets not built. Please run the preprocess method first.&quot;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_trainer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trainer_type</span><span class="p">(</span>
        <span class="n">trainset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span><span class="o">.</span><span class="n">train</span><span class="p">,</span>
        <span class="n">validset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span><span class="o">.</span><span class="n">valid</span><span class="p">,</span>
        <span class="n">result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
        <span class="n">model_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span><span class="p">,</span>
        <span class="n">loss_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_loss_type</span><span class="p">,</span>
        <span class="n">ontologies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ontologies</span><span class="p">,</span>  <span class="c1"># Ontix</span>
    <span class="p">)</span>
    <span class="n">trainer_result</span><span class="p">:</span> <span class="n">Result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trainer</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">trainer_result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BasePipeline.load" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Loads a pipeline from a file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the saved pipeline.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The loaded pipeline instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads a pipeline from a file.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path: Path to the saved pipeline.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The loaded pipeline instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">Loader</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loader</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BasePipeline.predict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generates predictions using the trained model.</p>
<p>Uses the trained model to make predictions on test data or new data
provided by the user. Processes the results and stores them in the
result container.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="DataPackage


  
      dataclass
   (autoencodix.data.datapackage.DataPackage)" href="../data/#autoencodix.data.DataPackage">DataPackage</a>, <a class="autorefs autorefs-internal" title="DatasetContainer


  
      dataclass
   (autoencodix.data._datasetcontainer.DatasetContainer)" href="../data/#autoencodix.data.DatasetContainer">DatasetContainer</a>, <span title="anndata.AnnData">AnnData</span>, <span title="mudata.MuData">MuData</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional new data for predictions.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[None, <a class="autorefs autorefs-internal" title="DefaultConfig (autoencodix.configs.default_config.DefaultConfig)" href="../configs/#autoencodix.configs.DefaultConfig">DefaultConfig</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional custom configuration for prediction.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional configuration parameters as keyword arguments.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="NotImplementedError">NotImplementedError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If required components aren't initialized.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no test data is available or data format is invalid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span>
            <span class="n">DataPackage</span><span class="p">,</span>
            <span class="n">DatasetContainer</span><span class="p">,</span>
            <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">,</span>
            <span class="n">MuData</span><span class="p">,</span>  <span class="c1"># ty: ignore[invalid-type-form]</span>
        <span class="p">]</span>  <span class="c1"># ty: ignore[invalid-type-form]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># ty: ignore[invalid-type-form]</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">DefaultConfig</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">from_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">to_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates predictions using the trained model.</span>

<span class="sd">    Uses the trained model to make predictions on test data or new data</span>
<span class="sd">    provided by the user. Processes the results and stores them in the</span>
<span class="sd">    result container.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: Optional new data for predictions.</span>
<span class="sd">        config: Optional custom configuration for prediction.</span>
<span class="sd">        **kwargs: Additional configuration parameters as keyword arguments.</span>

<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: If required components aren&#39;t initialized.</span>
<span class="sd">        ValueError: If no test data is available or data format is invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_prediction_requirements</span><span class="p">()</span>

    <span class="n">original_input</span> <span class="o">=</span> <span class="n">data</span>
    <span class="n">predict_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_prediction_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

    <span class="n">predictor_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_predictions</span><span class="p">(</span>
        <span class="n">predict_data</span><span class="o">=</span><span class="n">predict_data</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_process_latent_results</span><span class="p">(</span>
        <span class="n">predictor_results</span><span class="o">=</span><span class="n">predictor_results</span><span class="p">,</span> <span class="n">predict_data</span><span class="o">=</span><span class="n">predict_data</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_reconstruction</span><span class="p">(</span>
        <span class="n">predictor_results</span><span class="o">=</span><span class="n">predictor_results</span><span class="p">,</span>
        <span class="n">original_input</span><span class="o">=</span><span class="n">original_input</span><span class="p">,</span>
        <span class="n">predict_data</span><span class="o">=</span><span class="n">predict_data</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BasePipeline.preprocess" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">preprocess</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Filters, normalizes and prepares data for model training.</p>
<p>Processes raw input data into the format required by the model and creates
train/validation/test splits as needed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[None, <a class="autorefs autorefs-internal" title="DefaultConfig (autoencodix.configs.default_config.DefaultConfig)" href="../configs/#autoencodix.configs.DefaultConfig">DefaultConfig</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional custom configuration for preprocessing.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional configuration parameters as keyword arguments.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="NotImplementedError">NotImplementedError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If preprocessor is not initialized.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">DefaultConfig</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filters, normalizes and prepares data for model training.</span>

<span class="sd">    Processes raw input data into the format required by the model and creates</span>
<span class="sd">    train/validation/test splits as needed.</span>

<span class="sd">    Args:</span>
<span class="sd">        config: Optional custom configuration for preprocessing.</span>
<span class="sd">        **kwargs: Additional configuration parameters as keyword arguments.</span>

<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: If preprocessor is not initialized.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocessor_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Preprocessor not initialized&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_user_data</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessed_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocessor</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span>
            <span class="n">raw_user_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_user_data</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">datasets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_datasets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessed_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">datasets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessed_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BasePipeline.run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Executes the complete pipeline from preprocessing to visualization.</p>
<p>Runs all pipeline steps in sequence and returns the result.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="DatasetContainer


  
      dataclass
   (autoencodix.data._datasetcontainer.DatasetContainer)" href="../data/#autoencodix.data.DatasetContainer">DatasetContainer</a>, <a class="autorefs autorefs-internal" title="DataPackage


  
      dataclass
   (autoencodix.data.datapackage.DataPackage)" href="../data/#autoencodix.data.DataPackage">DataPackage</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional data for prediction (overrides test data).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Result


  
      dataclass
   (autoencodix.utils._result.Result)" href="../utils/#autoencodix.utils.Result">Result</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Complete pipeline results.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">DatasetContainer</span><span class="p">,</span> <span class="n">DataPackage</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Executes the complete pipeline from preprocessing to visualization.</span>

<span class="sd">    Runs all pipeline steps in sequence and returns the result.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: Optional data for prediction (overrides test data).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Complete pipeline results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BasePipeline.save" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Saves the pipeline to a file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path where the pipeline should be saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Saves the pipeline to a file.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path: Path where the pipeline should be saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">saver</span> <span class="o">=</span> <span class="n">Saver</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">saver</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BasePipeline.show_result" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">show_result</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Displays key visualizations of model results.</p>
<p>This method generates the following visualizations:
1. Loss Curves: Displays the absolute loss curves to provide insights into
   the model's training and validation performance over epochs.
2. Latent Space Ridgeline Plot: Visualizes the distribution of the latent
   space representations across different dimensions, offering a high-level
   overview of the learned embeddings.
3. Latent Space 2D Scatter Plot: Projects the latent space into two dimensions
   for a detailed view of the clustering or separation of data points.</p>
<p>These visualizations help in understanding the model's performance and
the structure of the latent space representations.</p>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">show_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Displays key visualizations of model results.</span>

<span class="sd">    This method generates the following visualizations:</span>
<span class="sd">    1. Loss Curves: Displays the absolute loss curves to provide insights into</span>
<span class="sd">       the model&#39;s training and validation performance over epochs.</span>
<span class="sd">    2. Latent Space Ridgeline Plot: Visualizes the distribution of the latent</span>
<span class="sd">       space representations across different dimensions, offering a high-level</span>
<span class="sd">       overview of the learned embeddings.</span>
<span class="sd">    3. Latent Space 2D Scatter Plot: Projects the latent space into two dimensions</span>
<span class="sd">       for a detailed view of the clustering or separation of data points.</span>

<span class="sd">    These visualizations help in understanding the model&#39;s performance and</span>
<span class="sd">    the structure of the latent space representations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating plots ...&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_visualizer</span><span class="o">.</span><span class="n">show_loss</span><span class="p">(</span><span class="n">plot_type</span><span class="o">=</span><span class="s2">&quot;absolute&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_visualizer</span><span class="o">.</span><span class="n">show_latent_space</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s2">&quot;Ridgeline&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_visualizer</span><span class="o">.</span><span class="n">show_latent_space</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s2">&quot;2D-scatter&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BasePipeline.visualize" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">visualize</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Creates visualizations of model results and performance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[None, <a class="autorefs autorefs-internal" title="DefaultConfig (autoencodix.configs.default_config.DefaultConfig)" href="../configs/#autoencodix.configs.DefaultConfig">DefaultConfig</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional custom configuration for visualization.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional configuration parameters.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="NotImplementedError">NotImplementedError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If visualizer is not initialized.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">visualize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">DefaultConfig</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates visualizations of model results and performance.</span>

<span class="sd">    Args:</span>
<span class="sd">        config: Optional custom configuration for visualization.</span>
<span class="sd">        **kwargs: Additional configuration parameters.</span>

<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: If visualizer is not initialized.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visualizer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Visualizer not initialized&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_visualizer</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="autoencodix.base.BasePreprocessor" class="doc doc-heading">
            <code>BasePreprocessor</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Contains logic for data preprocessing in the Autoencodix framework.</p>
<p>This class defines the general preprocessing workflow and provides
methods for handling different data modalities and data cases.
Subclasses should implement the <code>preprocess</code> method to perform
specific preprocessing steps.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePreprocessor.config">config</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A DefaultConfig object containing preprocessing configurations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePreprocessor.processed_data">processed_data</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary to store processed DataPackage objects for each data split.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePreprocessor.bulk_genes_to_keep">bulk_genes_to_keep</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.List">List</span>[<span title="str">str</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional list of genes to keep for bulk data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePreprocessor.bulk_scalers">bulk_scalers</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional dictionary of scalers for bulk data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePreprocessor.sc_genes_to_keep">sc_genes_to_keep</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.List">List</span>[<span title="str">str</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional dictionary mapping modality keys to lists of genes to keep for single-cell data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePreprocessor.sc_scalers">sc_scalers</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional dictionary mapping modality keys to scalers for single-cell data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePreprocessor.sc_general_genes_to_keep">sc_general_genes_to_keep</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.List">List</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional dictionary mapping modality keys to lists of genes to keep filtered by non-SC specific methods.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePreprocessor.data_readers">data_readers</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="enum.Enum">Enum</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary mapping DataCase enum values to data reader instances for different modalities.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BasePreprocessor._dataset_container">_dataset_container</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="DatasetContainer


  
      dataclass
   (autoencodix.data._datasetcontainer.DatasetContainer)" href="../data/#autoencodix.data.DatasetContainer">DatasetContainer</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional DatasetContainer to hold the processed datasets.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/autoencodix/base/_base_preprocessor.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  33</span>
<span class="normal">  34</span>
<span class="normal">  35</span>
<span class="normal">  36</span>
<span class="normal">  37</span>
<span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BasePreprocessor</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Contains logic for data preprocessing in the Autoencodix framework.</span>

<span class="sd">    This class defines the general preprocessing workflow and provides</span>
<span class="sd">    methods for handling different data modalities and data cases.</span>
<span class="sd">    Subclasses should implement the `preprocess` method to perform</span>
<span class="sd">    specific preprocessing steps.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        config: A DefaultConfig object containing preprocessing configurations.</span>
<span class="sd">        processed_data: A dictionary to store processed DataPackage objects for each data split.</span>
<span class="sd">        bulk_genes_to_keep: Optional list of genes to keep for bulk data.</span>
<span class="sd">        bulk_scalers: Optional dictionary of scalers for bulk data.</span>
<span class="sd">        sc_genes_to_keep: Optional dictionary mapping modality keys to lists of genes to keep for single-cell data.</span>
<span class="sd">        sc_scalers: Optional dictionary mapping modality keys to scalers for single-cell data.</span>
<span class="sd">        sc_general_genes_to_keep: Optional dictionary mapping modality keys to lists of genes to keep filtered by non-SC specific methods.</span>
<span class="sd">        data_readers: A dictionary mapping DataCase enum values to data reader instances for different modalities.</span>
<span class="sd">        _dataset_container: Optional DatasetContainer to hold the processed datasets.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">DefaultConfig</span><span class="p">,</span>
        <span class="n">ontologies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the BasePreprocessor with a configuration object.</span>

<span class="sd">        Args :</span>
<span class="sd">            config: A DefaultConfig object containing preprocessing configurations.</span>
<span class="sd">            ontologies: Ontology information, if provided for Ontix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_container</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DatasetContainer</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processed_data</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">DataPackage</span><span class="p">]]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bulk_genes_to_keep</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bulk_scalers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sc_genes_to_keep</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sc_scalers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sc_general_genes_to_keep</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ontologies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">ontologies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_readers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Enum</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">DataCase</span><span class="o">.</span><span class="n">MULTI_SINGLE_CELL</span><span class="p">:</span> <span class="n">SingleCellDataReader</span><span class="p">(),</span>
            <span class="n">DataCase</span><span class="o">.</span><span class="n">MULTI_BULK</span><span class="p">:</span> <span class="n">BulkDataReader</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">),</span>
            <span class="n">DataCase</span><span class="o">.</span><span class="n">BULK_TO_BULK</span><span class="p">:</span> <span class="n">BulkDataReader</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">),</span>
            <span class="n">DataCase</span><span class="o">.</span><span class="n">SINGLE_CELL_TO_SINGLE_CELL</span><span class="p">:</span> <span class="n">SingleCellDataReader</span><span class="p">(),</span>
            <span class="n">DataCase</span><span class="o">.</span><span class="n">IMG_TO_BULK</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;bulk&quot;</span><span class="p">:</span> <span class="n">BulkDataReader</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">),</span>
                <span class="s2">&quot;img&quot;</span><span class="p">:</span> <span class="n">ImageDataReader</span><span class="p">(),</span>
            <span class="p">},</span>
            <span class="n">DataCase</span><span class="o">.</span><span class="n">SINGLE_CELL_TO_IMG</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;sc&quot;</span><span class="p">:</span> <span class="n">SingleCellDataReader</span><span class="p">(),</span>
                <span class="s2">&quot;img&quot;</span><span class="p">:</span> <span class="n">ImageDataReader</span><span class="p">(),</span>
            <span class="p">},</span>
            <span class="n">DataCase</span><span class="o">.</span><span class="n">IMG_TO_IMG</span><span class="p">:</span> <span class="n">ImageDataReader</span><span class="p">(),</span>
        <span class="p">}</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">preprocess</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">raw_user_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataPackage</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">predict_new_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetContainer</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To be implemented by subclasses for specific preprocessing steps.</span>
<span class="sd">        Args:</span>
<span class="sd">            raw_user_data: Users can provide raw data. This is an alternative way of</span>
<span class="sd">                providing data via filepaths in the config. If this param is passed, we skip the data reading step.</span>
<span class="sd">            predict_new_data: Indicates whether the user wants to predict with unseen data.</span>
<span class="sd">                If this is the case, we don&#39;t split the data and only prerpocess.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_general_preprocess</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">raw_user_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataPackage</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">predict_new_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">DataPackage</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Orchestrates the preprocessing steps.</span>

<span class="sd">        This method determines the data case from the configuration and calls</span>
<span class="sd">        the appropriate processing function for that data case.</span>

<span class="sd">        Args:</span>
<span class="sd">            raw_user_data: Optional DataPackage containing user-provided data.</span>
<span class="sd">                If provided, the data reading step is skipped.</span>
<span class="sd">            predict_new_data: Boolean indicating whether to preprocess new unseen data</span>
<span class="sd">                without splitting it into train/validation/test sets.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing processed DataPackage objects for each data split</span>
<span class="sd">            (e.g., &#39;train&#39;, &#39;validation&#39;, &#39;test&#39;).</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If an unsupported data case is encountered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predict_new_data</span> <span class="o">=</span> <span class="n">predict_new_data</span>
        <span class="n">datacase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_case</span>
        <span class="k">if</span> <span class="n">datacase</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;datacase can&#39;t be None. Please ensure the configuration specifies a valid DataCase.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">raw_user_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">from_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_translation_keys</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">from_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_user_translation_keys</span><span class="p">(</span>
                <span class="n">raw_user_data</span><span class="o">=</span><span class="n">raw_user_data</span>
            <span class="p">)</span>
        <span class="n">process_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_process_function</span><span class="p">(</span><span class="n">datacase</span><span class="o">=</span><span class="n">datacase</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">process_function</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">process_function</span><span class="p">(</span><span class="n">raw_user_data</span><span class="o">=</span><span class="n">raw_user_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported data case: </span><span class="si">{</span><span class="n">datacase</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_process_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datacase</span><span class="p">:</span> <span class="n">DataCase</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the appropriate processing function based on the data case.</span>

<span class="sd">        Args:</span>
<span class="sd">            datacase: The DataCase enum value representing the current data case.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A callable function that performs the preprocessing for the given data case,</span>
<span class="sd">            or None if the data case is not supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">process_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">DataCase</span><span class="o">.</span><span class="n">MULTI_SINGLE_CELL</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_multi_single_cell</span><span class="p">,</span>
            <span class="n">DataCase</span><span class="o">.</span><span class="n">MULTI_BULK</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_multi_bulk_case</span><span class="p">,</span>
            <span class="n">DataCase</span><span class="o">.</span><span class="n">BULK_TO_BULK</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_multi_bulk_case</span><span class="p">,</span>
            <span class="n">DataCase</span><span class="o">.</span><span class="n">SINGLE_CELL_TO_SINGLE_CELL</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_multi_single_cell</span><span class="p">,</span>
            <span class="n">DataCase</span><span class="o">.</span><span class="n">IMG_TO_BULK</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_img_to_bulk_case</span><span class="p">,</span>
            <span class="n">DataCase</span><span class="o">.</span><span class="n">SINGLE_CELL_TO_IMG</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_sc_to_img_case</span><span class="p">,</span>
            <span class="n">DataCase</span><span class="o">.</span><span class="n">IMG_TO_IMG</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_img_to_img_case</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">process_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">datacase</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_data_case</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">data_package</span><span class="p">:</span> <span class="n">DataPackage</span><span class="p">,</span> <span class="n">modality_processors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">DataPackage</span><span class="p">]]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Processes the data package based on the provided modality processors.</span>

<span class="sd">        This method handles the common preprocessing steps for different data cases,</span>
<span class="sd">        including splitting the data package, removing NaNs, and applying</span>
<span class="sd">        modality-specific processors.</span>

<span class="sd">        Args::</span>
<span class="sd">            data_package: The DataPackage object to be processed.</span>
<span class="sd">            modality_processors: A dictionary mapping modality keys (e.g., &#39;multi_sc&#39;, &#39;from_modality&#39;)</span>
<span class="sd">                to callable processor functions that will be applied to the corresponding modality data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing processed DataPackage objects for each data split.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_new_data</span><span class="p">:</span>
            <span class="c1"># use train, because processing logic expects train split</span>
            <span class="n">mock_split</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">DataPackage</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data_package</span><span class="p">,</span>
                    <span class="s2">&quot;indices&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;paired&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])},</span>
                <span class="p">},</span>
                <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;indices&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;paired&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])}},</span>
                <span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;indices&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;paired&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])}},</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">skip_preprocessing</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">mock_split</span>

            <span class="n">clean_package</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_nans</span><span class="p">(</span><span class="n">data_package</span><span class="o">=</span><span class="n">data_package</span><span class="p">)</span>
            <span class="n">mock_split</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean_package</span>
            <span class="k">for</span> <span class="n">modality_key</span><span class="p">,</span> <span class="p">(</span>
                <span class="n">presplit_processor</span><span class="p">,</span>
                <span class="n">postsplit_processor</span><span class="p">,</span>
            <span class="p">)</span> <span class="ow">in</span> <span class="n">modality_processors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">modality_data</span> <span class="o">=</span> <span class="n">clean_package</span><span class="p">[</span><span class="n">modality_key</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">modality_data</span><span class="p">:</span>
                    <span class="n">processed_modality_data</span> <span class="o">=</span> <span class="n">presplit_processor</span><span class="p">(</span><span class="n">modality_data</span><span class="p">)</span>
                    <span class="c1"># mock the split</span>
                    <span class="n">clean_package</span><span class="p">[</span><span class="n">modality_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed_modality_data</span>
                    <span class="n">mock_split</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean_package</span>
                    <span class="n">mock_split</span> <span class="o">=</span> <span class="n">postsplit_processor</span><span class="p">(</span><span class="n">mock_split</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">mock_split</span>
        <span class="c1"># normal case without new data -----------------------------------</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">skip_preprocessing</span><span class="p">:</span>
            <span class="n">split_packages</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_data_package</span><span class="p">(</span><span class="n">data_package</span><span class="o">=</span><span class="n">data_package</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">split_packages</span>
        <span class="n">clean_package</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_nans</span><span class="p">(</span><span class="n">data_package</span><span class="o">=</span><span class="n">data_package</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">modality_key</span><span class="p">,</span> <span class="p">(</span><span class="n">presplit_processor</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">modality_processors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">modality_data</span> <span class="o">=</span> <span class="n">clean_package</span><span class="p">[</span><span class="n">modality_key</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">modality_data</span><span class="p">:</span>
                <span class="n">processed_modality_data</span> <span class="o">=</span> <span class="n">presplit_processor</span><span class="p">(</span><span class="n">modality_data</span><span class="p">)</span>
                <span class="n">clean_package</span><span class="p">[</span><span class="n">modality_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed_modality_data</span>
        <span class="n">split_packages</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_data_package</span><span class="p">(</span><span class="n">data_package</span><span class="o">=</span><span class="n">clean_package</span><span class="p">)</span>
        <span class="n">processed_splits</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">modality_key</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">postsplit_processor</span><span class="p">)</span> <span class="ow">in</span> <span class="n">modality_processors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">split_packages</span> <span class="o">=</span> <span class="n">postsplit_processor</span><span class="p">(</span><span class="n">split_packages</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">split_name</span><span class="p">,</span> <span class="n">split_package</span> <span class="ow">in</span> <span class="n">split_packages</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">split_indices</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">name</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">split</span><span class="p">:</span> <span class="n">idx</span>
                    <span class="k">for</span> <span class="n">split</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">split</span> <span class="o">==</span> <span class="n">split_name</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">indices</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="n">processed_splits</span><span class="p">[</span><span class="n">split_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">split_package</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">],</span>
                <span class="s2">&quot;indices&quot;</span><span class="p">:</span> <span class="n">split_indices</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="n">processed_splits</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_multi_single_cell</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">raw_user_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataPackage</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">DataPackage</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process MULTI_SINGLE_CELL case</span>

<span class="sd">        Reads multi-single-cell data, performs data splitting, NaN removal,</span>
<span class="sd">        and applies single-cell specific filtering.</span>
<span class="sd">        Args:</span>
<span class="sd">            raw_user_data: Optional DataPackage containing user-provided data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing processed DataPackage objects for each data split.</span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If multi_sc in data_package is None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">raw_user_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">screader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_readers</span><span class="p">[</span><span class="n">DataCase</span><span class="o">.</span><span class="n">MULTI_SINGLE_CELL</span><span class="p">]</span>  <span class="c1"># type: ignore</span>

            <span class="n">mudata</span> <span class="o">=</span> <span class="n">screader</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
            <span class="n">data_package</span><span class="p">:</span> <span class="n">DataPackage</span> <span class="o">=</span> <span class="n">DataPackage</span><span class="p">()</span>
            <span class="n">data_package</span><span class="o">.</span><span class="n">multi_sc</span> <span class="o">=</span> <span class="n">mudata</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_package</span> <span class="o">=</span> <span class="n">raw_user_data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">requires_paired</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;datapackge in process_multi_single_cell </span><span class="si">{</span><span class="n">data_package</span><span class="si">}</span><span class="s2"> and multi_sc: </span><span class="si">{</span><span class="n">data_package</span><span class="o">.</span><span class="n">multi_sc</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">common_ids</span> <span class="o">=</span> <span class="n">data_package</span><span class="o">.</span><span class="n">get_common_ids</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">data_package</span><span class="o">.</span><span class="n">multi_sc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;multi_sc in data_package is None&quot;</span><span class="p">)</span>
            <span class="n">data_package</span><span class="o">.</span><span class="n">multi_sc</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;multi_sc&quot;</span><span class="p">:</span> <span class="n">data_package</span><span class="o">.</span><span class="n">multi_sc</span><span class="p">[</span><span class="s2">&quot;multi_sc&quot;</span><span class="p">][</span><span class="n">common_ids</span><span class="p">]</span>
            <span class="p">}</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">presplit_processor</span><span class="p">(</span><span class="n">modality_data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modality_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">modality_data</span>
            <span class="n">sc_filter</span> <span class="o">=</span> <span class="n">SingleCellFilter</span><span class="p">(</span>
                <span class="n">data_info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_config</span><span class="o">.</span><span class="n">data_info</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">sc_filter</span><span class="o">.</span><span class="n">presplit_processing</span><span class="p">(</span><span class="n">multi_sc</span><span class="o">=</span><span class="n">modality_data</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">postsplit_processor</span><span class="p">(</span>
            <span class="n">split_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postsplit_multi_single_cell</span><span class="p">(</span>
                <span class="n">split_data</span><span class="o">=</span><span class="n">split_data</span><span class="p">,</span> <span class="n">datapackage_key</span><span class="o">=</span><span class="s2">&quot;multi_sc&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_data_case</span><span class="p">(</span>
            <span class="n">data_package</span><span class="p">,</span>
            <span class="n">modality_processors</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;multi_sc&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">presplit_processor</span><span class="p">,</span> <span class="n">postsplit_processor</span><span class="p">)},</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_multi_bulk_case</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">raw_user_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataPackage</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">DataPackage</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process MULTI_BULK case.</span>

<span class="sd">        Reads multi-bulk data, performs data splitting, NaN removal,</span>
<span class="sd">        and applies filtering and scaling to bulk dataframes.</span>
<span class="sd">        Args:</span>
<span class="sd">            raw_user_data: Optional DataPackage containing user-provided data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing processed DataPackage objects for each data split.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">raw_user_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bulkreader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_readers</span><span class="p">[</span><span class="n">DataCase</span><span class="o">.</span><span class="n">MULTI_BULK</span><span class="p">]</span>
            <span class="n">bulk_dfs</span><span class="p">,</span> <span class="n">annotation</span> <span class="o">=</span> <span class="n">bulkreader</span><span class="o">.</span><span class="n">read_data</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bulk_dfs keys in process_multi_bulk: </span><span class="si">{</span><span class="n">bulk_dfs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">data_package</span> <span class="o">=</span> <span class="n">DataPackage</span><span class="p">(</span><span class="n">multi_bulk</span><span class="o">=</span><span class="n">bulk_dfs</span><span class="p">,</span> <span class="n">annotation</span><span class="o">=</span><span class="n">annotation</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_package</span> <span class="o">=</span> <span class="n">raw_user_data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">requires_paired</span><span class="p">:</span>
            <span class="n">common_ids</span> <span class="o">=</span> <span class="n">data_package</span><span class="o">.</span><span class="n">get_common_ids</span><span class="p">()</span>
            <span class="n">unpaired_data</span> <span class="o">=</span> <span class="n">data_package</span><span class="o">.</span><span class="n">multi_bulk</span>
            <span class="n">unpaired_anno</span> <span class="o">=</span> <span class="n">data_package</span><span class="o">.</span><span class="n">annotation</span>
            <span class="k">if</span> <span class="n">unpaired_anno</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;annotation attribute of datapackge cannot be None&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">unpaired_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;multi_bulk attribute of datapackge cannot be None&quot;</span><span class="p">)</span>
            <span class="n">data_package</span><span class="o">.</span><span class="n">multi_bulk</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common_ids</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">unpaired_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>

            <span class="n">data_package</span><span class="o">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common_ids</span><span class="p">]</span>  <span class="c1"># ty: ignore</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">unpaired_anno</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>  <span class="c1"># ty: ignore</span>
            <span class="p">}</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">presplit_processor</span><span class="p">(</span>
            <span class="n">modality_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]],</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;For the multi_bulk modality we perform all operations after splitting at the moment.&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">modality_data</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">postsplit_processor</span><span class="p">(</span>
            <span class="n">split_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postsplit_multi_bulk</span><span class="p">(</span><span class="n">split_data</span><span class="o">=</span><span class="n">split_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_data_case</span><span class="p">(</span>
            <span class="n">data_package</span><span class="p">,</span>
            <span class="n">modality_processors</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;multi_bulk&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">presplit_processor</span><span class="p">,</span> <span class="n">postsplit_processor</span><span class="p">)</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_k_filter</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">remainder</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">base_features</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">k_filter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">extra</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">remainder</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">base_features</span> <span class="o">+</span> <span class="n">extra</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_postsplit_multi_single_cell</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">split_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
        <span class="n">datapackage_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;multi_sc&quot;</span><span class="p">,</span>
        <span class="n">modality_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Post-split processing for multi-single-cell data.</span>
<span class="sd">        This method applies filtering and scaling to the single-cell data after it has been split.</span>
<span class="sd">        Now supports multiple MuData objects in the input dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            split_data: A dictionary containing the split data for each data split.</span>
<span class="sd">            datapackage_key: The key in the DataPackage that contains the multi-single-cell data.</span>
<span class="sd">            modality_key: Optional specific modality key for backward compatibility.</span>
<span class="sd">                        If provided, only processes that specific modality.</span>
<span class="sd">                        If None, processes all modalities in the dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing processed DataPackage objects for each data split.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the train split data is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">processed_splits</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">train_split</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">split_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">train_split</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Train split data is None. Ensure that the data package contains valid train data.&quot;</span>
            <span class="p">)</span>

        <span class="n">train_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_split</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">train_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Train split data is None. Ensure that the data package contains valid train data.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Get all modality keys from the train data</span>
        <span class="n">mudata_dict</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="n">datapackage_key</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">modality_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modality_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mudata_dict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Specified modality_key &#39;</span><span class="si">{</span><span class="n">modality_key</span><span class="si">}</span><span class="s2">&#39; not found in </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">mudata_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">modality_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">modality_key</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Processing single modality (backward compatibility): </span><span class="si">{</span><span class="n">modality_key</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">modality_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mudata_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">modality_keys</span><span class="p">)</span><span class="si">}</span><span class="s2"> MuData objects: </span><span class="si">{</span><span class="n">modality_keys</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Initialize storage for scalers and gene filters for each modality</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sc_scalers</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sc_genes_to_keep</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sc_general_genes_to_keep</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;modality&quot;</span> <span class="ow">in</span> <span class="n">datapackage_key</span><span class="p">):</span>
            <span class="c1"># Process each MuData object in the train split</span>
            <span class="n">processed_mudata_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">all_scalers</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">all_sc_genes_to_keep</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">all_general_genes_to_keep</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">current_modality_key</span> <span class="ow">in</span> <span class="n">modality_keys</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing train modality: </span><span class="si">{</span><span class="n">current_modality_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">sc_filter</span> <span class="o">=</span> <span class="n">SingleCellFilter</span><span class="p">(</span>
                    <span class="n">data_info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_config</span><span class="o">.</span><span class="n">data_info</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span>
                <span class="p">)</span>

                <span class="c1"># Single-cell specific filtering</span>
                <span class="n">filtered_train</span><span class="p">,</span> <span class="n">sc_genes_to_keep</span> <span class="o">=</span> <span class="n">sc_filter</span><span class="o">.</span><span class="n">sc_postsplit_processing</span><span class="p">(</span>
                    <span class="n">mudata</span><span class="o">=</span><span class="n">mudata_dict</span><span class="p">[</span><span class="n">current_modality_key</span><span class="p">]</span>
                <span class="p">)</span>

                <span class="c1"># General post-processing</span>
                <span class="n">processed_train</span><span class="p">,</span> <span class="n">general_genes_to_keep</span><span class="p">,</span> <span class="n">scalers</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">sc_filter</span><span class="o">.</span><span class="n">general_postsplit_processing</span><span class="p">(</span>
                        <span class="n">mudata</span><span class="o">=</span><span class="n">filtered_train</span><span class="p">,</span> <span class="n">scaler_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gene_map</span><span class="o">=</span><span class="kc">None</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="c1"># Store processed data and filters for this modality</span>
                <span class="n">processed_mudata_dict</span><span class="p">[</span><span class="n">current_modality_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed_train</span>
                <span class="n">all_scalers</span><span class="p">[</span><span class="n">current_modality_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">scalers</span>
                <span class="n">all_sc_genes_to_keep</span><span class="p">[</span><span class="n">current_modality_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">sc_genes_to_keep</span>
                <span class="n">all_general_genes_to_keep</span><span class="p">[</span><span class="n">current_modality_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">general_genes_to_keep</span>

            <span class="c1"># Store all scalers and gene filters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sc_scalers</span> <span class="o">=</span> <span class="n">all_scalers</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sc_genes_to_keep</span> <span class="o">=</span> <span class="n">all_sc_genes_to_keep</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sc_general_genes_to_keep</span> <span class="o">=</span> <span class="n">all_general_genes_to_keep</span>

            <span class="c1"># Update train data with processed MuData objects</span>
            <span class="n">train_data</span><span class="p">[</span><span class="n">datapackage_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed_mudata_dict</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Use existing scalers and gene filters</span>
            <span class="n">all_scalers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sc_scalers</span>  <span class="c1"># type: ignore</span>
            <span class="n">all_sc_genes_to_keep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sc_genes_to_keep</span>  <span class="c1"># type: ignore</span>
            <span class="n">all_general_genes_to_keep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sc_general_genes_to_keep</span>  <span class="c1"># type: ignore</span>

        <span class="c1"># Store processed train split</span>
        <span class="n">processed_splits</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">train_data</span><span class="p">,</span>
            <span class="s2">&quot;indices&quot;</span><span class="p">:</span> <span class="n">split_data</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">][</span><span class="s2">&quot;indices&quot;</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="c1"># Process other splits (val, test, etc.)</span>
        <span class="k">for</span> <span class="n">split</span><span class="p">,</span> <span class="n">split_package</span> <span class="ow">in</span> <span class="n">split_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">split</span> <span class="o">==</span> <span class="s2">&quot;train&quot;</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">data_package</span> <span class="o">=</span> <span class="n">split_package</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">data_package</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">processed_splits</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="n">split_package</span>
                <span class="k">continue</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2"> split&quot;</span><span class="p">)</span>
            <span class="n">processed_mudata_dict</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># Process each MuData object in this split</span>
            <span class="k">for</span> <span class="n">current_modality_key</span> <span class="ow">in</span> <span class="n">modality_keys</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2"> modality: </span><span class="si">{</span><span class="n">current_modality_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">sc_filter</span> <span class="o">=</span> <span class="n">SingleCellFilter</span><span class="p">(</span>
                    <span class="n">data_info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_config</span><span class="o">.</span><span class="n">data_info</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span>
                <span class="p">)</span>

                <span class="c1"># Apply single-cell filtering using train-derived gene map</span>
                <span class="n">filtered_sc_data</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sc_filter</span><span class="o">.</span><span class="n">sc_postsplit_processing</span><span class="p">(</span>
                    <span class="n">mudata</span><span class="o">=</span><span class="n">data_package</span><span class="p">[</span><span class="n">datapackage_key</span><span class="p">][</span><span class="n">current_modality_key</span><span class="p">],</span>
                    <span class="n">gene_map</span><span class="o">=</span><span class="n">all_sc_genes_to_keep</span><span class="p">[</span><span class="n">current_modality_key</span><span class="p">],</span>
                <span class="p">)</span>

                <span class="c1"># Apply general processing using train-derived scalers and gene map</span>
                <span class="n">processed_general_data</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sc_filter</span><span class="o">.</span><span class="n">general_postsplit_processing</span><span class="p">(</span>
                    <span class="n">mudata</span><span class="o">=</span><span class="n">filtered_sc_data</span><span class="p">,</span>
                    <span class="n">gene_map</span><span class="o">=</span><span class="n">all_general_genes_to_keep</span><span class="p">[</span><span class="n">current_modality_key</span><span class="p">],</span>
                    <span class="n">scaler_map</span><span class="o">=</span><span class="n">all_scalers</span><span class="p">[</span><span class="n">current_modality_key</span><span class="p">],</span>
                <span class="p">)</span>

                <span class="n">processed_mudata_dict</span><span class="p">[</span><span class="n">current_modality_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed_general_data</span>

            <span class="c1"># Update data package with all processed MuData objects</span>
            <span class="n">data_package</span><span class="p">[</span><span class="n">datapackage_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed_mudata_dict</span>

            <span class="n">processed_splits</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data_package</span><span class="p">,</span>
                <span class="s2">&quot;indices&quot;</span><span class="p">:</span> <span class="n">split_package</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">],</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">processed_splits</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_postsplit_multi_bulk</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">split_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
        <span class="n">datapackage_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;multi_bulk&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Post-split processing for multi-bulk data.</span>

<span class="sd">        This method applies filtering and scaling to the bulk dataframes after they have been split.</span>

<span class="sd">        Args:</span>
<span class="sd">            split_data: A dictionary containing the split data for each data split.</span>
<span class="sd">            datapackage_key: The key in the DataPackage that contains the multi-bulk data.</span>
<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing processed DataPackage objects for each data split.</span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the train split data is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">train_split</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">split_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">train_split</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Train split data is None. Ensure that the data package contains valid train data.&quot;</span>
            <span class="p">)</span>
        <span class="n">train_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_split</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
        <span class="n">genes_to_keep_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">scalers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">processed_splits</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bulk_scalers</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">bulk_genes_to_keep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="s2">&quot;modality&quot;</span> <span class="ow">in</span> <span class="n">datapackage_key</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">train_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Train split data is None. Ensure that the data package contains valid train data.&quot;</span>
                <span class="p">)</span>
            <span class="n">n_modalities</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_data</span><span class="p">[</span><span class="n">datapackage_key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">remainder</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">base_features</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">k_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">base_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">k_filter</span> <span class="o">//</span> <span class="n">n_modalities</span>
                <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">k_filter</span> <span class="o">%</span> <span class="n">n_modalities</span>

            <span class="c1"># Get valid modality keys (those that are not None)</span>
            <span class="n">modality_keys</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">train_data</span><span class="p">[</span><span class="n">datapackage_key</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">]</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">modality_keys</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="n">datapackage_key</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                <span class="n">cur_k_filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_k_filter</span><span class="p">(</span>
                    <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">base_features</span><span class="o">=</span><span class="n">base_features</span><span class="p">,</span> <span class="n">remainder</span><span class="o">=</span><span class="n">remainder</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_config</span><span class="o">.</span><span class="n">data_info</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">k_filter</span> <span class="o">=</span> <span class="n">cur_k_filter</span>

                <span class="n">data_processor</span> <span class="o">=</span> <span class="n">DataFilter</span><span class="p">(</span>
                    <span class="n">data_info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_config</span><span class="o">.</span><span class="n">data_info</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                    <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
                    <span class="n">ontologies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ontologies</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">filtered_df</span><span class="p">,</span> <span class="n">genes_to_keep</span> <span class="o">=</span> <span class="n">data_processor</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
                <span class="n">scaler</span> <span class="o">=</span> <span class="n">data_processor</span><span class="o">.</span><span class="n">fit_scaler</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">filtered_df</span><span class="p">)</span>
                <span class="n">genes_to_keep_map</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">genes_to_keep</span>
                <span class="n">scalers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaler</span>
                <span class="n">scaled_df</span> <span class="o">=</span> <span class="n">data_processor</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">filtered_df</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="n">scaler</span><span class="p">)</span>
                <span class="n">train_data</span><span class="p">[</span><span class="n">datapackage_key</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaled_df</span>
                <span class="c1"># Check if indices stayed the same after filtering</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
                    <span class="n">mismatched_indices</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">symmetric_difference</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Indices mismatch after filtering for modality </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Mismatched indices: </span><span class="si">{</span><span class="n">mismatched_indices</span><span class="si">}</span><span class="s2">. &quot;</span>
                        <span class="s2">&quot;Ensure filtering does not alter the indices.&quot;</span>
                    <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">bulk_scalers</span> <span class="o">=</span> <span class="n">scalers</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bulk_genes_to_keep</span> <span class="o">=</span> <span class="n">genes_to_keep_map</span>  <span class="c1"># type: ignore</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scalers</span><span class="p">,</span> <span class="n">genes_to_keep_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bulk_scalers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bulk_genes_to_keep</span>  <span class="c1"># type: ignore</span>

        <span class="n">processed_splits</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">train_data</span><span class="p">,</span>
            <span class="s2">&quot;indices&quot;</span><span class="p">:</span> <span class="n">split_data</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">][</span><span class="s2">&quot;indices&quot;</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">split_name</span><span class="p">,</span> <span class="n">split_package</span> <span class="ow">in</span> <span class="n">split_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">split_name</span> <span class="o">==</span> <span class="s2">&quot;train&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">split_package</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">processed_splits</span><span class="p">[</span><span class="n">split_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">split_data</span><span class="p">[</span><span class="n">split_name</span><span class="p">]</span>
                <span class="k">continue</span>

            <span class="n">processed_package</span> <span class="o">=</span> <span class="n">split_package</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">processed_package</span><span class="p">[</span><span class="n">datapackage_key</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">data_processor</span> <span class="o">=</span> <span class="n">DataFilter</span><span class="p">(</span>
                    <span class="n">data_info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_config</span><span class="o">.</span><span class="n">data_info</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                    <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
                    <span class="n">ontologies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ontologies</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">filtered_df</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">data_processor</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">genes_to_keep</span><span class="o">=</span><span class="n">genes_to_keep_map</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">scaled_df</span> <span class="o">=</span> <span class="n">data_processor</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">filtered_df</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="n">scalers</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">processed_package</span><span class="p">[</span><span class="n">datapackage_key</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaled_df</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Indices mismatch after filtering for modality </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">. &quot;</span>
                        <span class="s2">&quot;Ensure filtering does not alter the indices.&quot;</span>
                    <span class="p">)</span>

            <span class="n">processed_splits</span><span class="p">[</span><span class="n">split_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">processed_package</span><span class="p">,</span>
                <span class="s2">&quot;indices&quot;</span><span class="p">:</span> <span class="n">split_package</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">],</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">processed_splits</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_img_to_bulk_case</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">raw_user_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataPackage</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">DataPackage</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process IMG_TO_BULK case</span>

<span class="sd">        Reads image and bulk data, prepares from/to modalities (IMG-&gt;BULK or BULK-&gt;IMG),</span>
<span class="sd">        performs data splitting, NaN removal, and applies normalization to image data</span>
<span class="sd">        and filtering/scaling to bulk dataframes.</span>
<span class="sd">        Args:</span>
<span class="sd">            raw_user_data: Optional DataPackage containing user-provided data.</span>
<span class="sd">                If provided, the data reading step is skipped.</span>
<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing processed DataPackage objects for each data split.</span>
<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If from_key or to_key is None, indicating that translation keys must be specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">raw_user_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bulkreader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_readers</span><span class="p">[</span><span class="n">DataCase</span><span class="o">.</span><span class="n">IMG_TO_BULK</span><span class="p">][</span><span class="s2">&quot;bulk&quot;</span><span class="p">]</span>
            <span class="n">imgreader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_readers</span><span class="p">[</span><span class="n">DataCase</span><span class="o">.</span><span class="n">IMG_TO_BULK</span><span class="p">][</span><span class="s2">&quot;img&quot;</span><span class="p">]</span>

            <span class="n">bulk_dfs</span><span class="p">,</span> <span class="n">annotation_bulk</span> <span class="o">=</span> <span class="n">bulkreader</span><span class="o">.</span><span class="n">read_data</span><span class="p">()</span>
            <span class="n">images</span><span class="p">,</span> <span class="n">annotation_img</span> <span class="o">=</span> <span class="n">imgreader</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
            <span class="n">annotation</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">annotation_bulk</span><span class="p">,</span> <span class="o">**</span><span class="n">annotation_img</span><span class="p">}</span>

            <span class="n">data_package</span> <span class="o">=</span> <span class="n">DataPackage</span><span class="p">(</span>
                <span class="n">multi_bulk</span><span class="o">=</span><span class="n">bulk_dfs</span><span class="p">,</span> <span class="n">img</span><span class="o">=</span><span class="n">images</span><span class="p">,</span> <span class="n">annotation</span><span class="o">=</span><span class="n">annotation</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_package</span> <span class="o">=</span> <span class="n">raw_user_data</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">presplit_processor</span><span class="p">(</span>
            <span class="n">modality_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">ImgData</span><span class="p">]]],</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">ImgData</span><span class="p">]]]:</span>
            <span class="k">for</span> <span class="n">modality_key</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">modality_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_image_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">):</span>
                    <span class="n">modality_data</span><span class="p">[</span><span class="n">modality_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_image_data</span><span class="p">(</span>
                        <span class="n">images</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
                        <span class="n">info_key</span><span class="o">=</span><span class="n">modality_key</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
                    <span class="p">)</span>
            <span class="c1"># we don&#39;t need to filter bulk data here</span>
            <span class="c1"># because we do it in the postsplit step</span>
            <span class="k">return</span> <span class="n">modality_data</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">postsplit_processor</span><span class="p">(</span>
            <span class="n">split_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">datapackage_key</span><span class="p">:</span> <span class="nb">str</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
            <span class="k">if</span> <span class="n">datapackage_key</span> <span class="o">==</span> <span class="s2">&quot;multi_bulk&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postsplit_multi_bulk</span><span class="p">(</span>
                    <span class="n">split_data</span><span class="o">=</span><span class="n">split_data</span><span class="p">,</span> <span class="n">datapackage_key</span><span class="o">=</span><span class="n">datapackage_key</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">split_data</span>  <span class="c1"># for img data we don&#39;t need to do anything</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_data_case</span><span class="p">(</span>
            <span class="n">data_package</span><span class="p">,</span>
            <span class="n">modality_processors</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;multi_bulk&quot;</span><span class="p">:</span> <span class="p">(</span>  <span class="c1"># TODO change to multi_bulk and img for all translation cases and ajdust processors accordingly</span>
                    <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">presplit_processor</span><span class="p">(</span><span class="n">modality_data</span><span class="o">=</span><span class="n">data</span><span class="p">),</span>
                    <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">postsplit_processor</span><span class="p">(</span>
                        <span class="n">split_data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">datapackage_key</span><span class="o">=</span><span class="s2">&quot;multi_bulk&quot;</span>
                    <span class="p">),</span>
                <span class="p">),</span>
                <span class="s2">&quot;img&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">presplit_processor</span><span class="p">(</span><span class="n">modality_data</span><span class="o">=</span><span class="n">data</span><span class="p">),</span>
                    <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">postsplit_processor</span><span class="p">(</span>
                        <span class="n">split_data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">datapackage_key</span><span class="o">=</span><span class="s2">&quot;img&quot;</span>
                    <span class="p">),</span>
                <span class="p">),</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_sc_to_img_case</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">raw_user_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataPackage</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">DataPackage</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process SC_TO_IMG case.</span>

<span class="sd">        Reads single-cell and image data, prepares from/to modalities (SC-&gt;IMG or IMG-&gt;SC),</span>
<span class="sd">        performs data splitting, NaN removal, and applies single-cell specific filtering</span>
<span class="sd">        to single-cell data and normalization to image data.</span>

<span class="sd">        Args:</span>
<span class="sd">            raw_user_data: Optional DataPackage containing user-provided data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing processed DataPackage objects for each data split.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">raw_user_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">screader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_readers</span><span class="p">[</span><span class="n">DataCase</span><span class="o">.</span><span class="n">SINGLE_CELL_TO_IMG</span><span class="p">][</span><span class="s2">&quot;sc&quot;</span><span class="p">]</span>
            <span class="n">imgreader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_readers</span><span class="p">[</span><span class="n">DataCase</span><span class="o">.</span><span class="n">SINGLE_CELL_TO_IMG</span><span class="p">][</span><span class="s2">&quot;img&quot;</span><span class="p">]</span>

            <span class="c1"># only one mudata type in this case we know this</span>
            <span class="n">mudata_dict</span> <span class="o">=</span> <span class="n">screader</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
            <span class="n">images</span><span class="p">,</span> <span class="n">annotation</span> <span class="o">=</span> <span class="n">imgreader</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>

            <span class="n">data_package</span> <span class="o">=</span> <span class="n">DataPackage</span><span class="p">(</span>
                <span class="n">multi_sc</span><span class="o">=</span><span class="n">mudata_dict</span><span class="p">,</span> <span class="n">img</span><span class="o">=</span><span class="n">images</span><span class="p">,</span> <span class="n">annotation</span><span class="o">=</span><span class="n">annotation</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_package</span> <span class="o">=</span> <span class="n">raw_user_data</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">presplit_processor</span><span class="p">(</span>
            <span class="n">modality_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">ImgData</span><span class="p">]]],</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">ImgData</span><span class="p">]]]:</span>
            <span class="n">was_image</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">modality_key</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">modality_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_image_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">):</span>
                    <span class="n">was_image</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">modality_data</span><span class="p">[</span><span class="n">modality_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_image_data</span><span class="p">(</span>
                        <span class="n">images</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
                        <span class="n">info_key</span><span class="o">=</span><span class="n">modality_key</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="n">was_image</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">modality_data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sc_filter</span> <span class="o">=</span> <span class="n">SingleCellFilter</span><span class="p">(</span>
                    <span class="n">data_info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_config</span><span class="o">.</span><span class="n">data_info</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">sc_filter</span><span class="o">.</span><span class="n">presplit_processing</span><span class="p">(</span><span class="n">multi_sc</span><span class="o">=</span><span class="n">modality_data</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">postsplit_processor</span><span class="p">(</span>
            <span class="n">split_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">datapackage_key</span><span class="p">:</span> <span class="nb">str</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
            <span class="k">if</span> <span class="n">datapackage_key</span> <span class="o">==</span> <span class="s2">&quot;multi_sc&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postsplit_multi_single_cell</span><span class="p">(</span>
                    <span class="n">split_data</span><span class="o">=</span><span class="n">split_data</span><span class="p">,</span> <span class="n">datapackage_key</span><span class="o">=</span><span class="n">datapackage_key</span>
                <span class="p">)</span>
            <span class="c1"># No postsplit processing needed for image data</span>
            <span class="k">return</span> <span class="n">split_data</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_data_case</span><span class="p">(</span>
            <span class="n">data_package</span><span class="p">,</span>
            <span class="n">modality_processors</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;multi_sc&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">presplit_processor</span><span class="p">(</span><span class="n">modality_data</span><span class="o">=</span><span class="n">data</span><span class="p">),</span>
                    <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">postsplit_processor</span><span class="p">(</span>
                        <span class="n">split_data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">datapackage_key</span><span class="o">=</span><span class="s2">&quot;multi_sc&quot;</span>
                    <span class="p">),</span>
                <span class="p">),</span>
                <span class="s2">&quot;img&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">presplit_processor</span><span class="p">(</span><span class="n">modality_data</span><span class="o">=</span><span class="n">data</span><span class="p">),</span>
                    <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">postsplit_processor</span><span class="p">(</span>
                        <span class="n">split_data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">datapackage_key</span><span class="o">=</span><span class="s2">&quot;img&quot;</span>
                    <span class="p">),</span>
                <span class="p">),</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_img_to_img_case</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">raw_user_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataPackage</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DataPackage</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process IMG_TO_IMG case.</span>

<span class="sd">        Reads image data for from/to modalities, performs data splitting,</span>
<span class="sd">        NaN removal, and applies normalization to both from and to image data.</span>

<span class="sd">        Args:</span>
<span class="sd">            raw_user_data: Optional DataPackage containing user-provided data.</span>
<span class="sd">                If provided, the data reading step is skipped.</span>
<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing processed DataPackage objects for each data split.</span>
<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If from_key or to_key is None, indicating that translation keys must be specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">raw_user_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">imgreader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_readers</span><span class="p">[</span><span class="n">DataCase</span><span class="o">.</span><span class="n">IMG_TO_IMG</span><span class="p">]</span>
            <span class="n">images</span><span class="p">,</span> <span class="n">annotation</span> <span class="o">=</span> <span class="n">imgreader</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>

            <span class="n">data_package</span> <span class="o">=</span> <span class="n">DataPackage</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">images</span><span class="p">,</span> <span class="n">annotation</span><span class="o">=</span><span class="n">annotation</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_package</span> <span class="o">=</span> <span class="n">raw_user_data</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">requires_paired</span><span class="p">:</span>
            <span class="n">common_ids</span> <span class="o">=</span> <span class="n">data_package</span><span class="o">.</span><span class="n">get_common_ids</span><span class="p">()</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">filter_imgdata_list</span><span class="p">(</span><span class="n">img_list</span><span class="p">,</span> <span class="n">ids</span><span class="p">):</span>
                <span class="n">filtered</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">imgdata</span> <span class="ow">in</span> <span class="n">img_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">imgdata</span><span class="o">.</span><span class="n">sample_id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
                        <span class="n">filtered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imgdata</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">filtered</span>

            <span class="n">images</span> <span class="o">=</span> <span class="n">data_package</span><span class="o">.</span><span class="n">img</span>
            <span class="k">if</span> <span class="n">images</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Images cannot be None&quot;</span><span class="p">)</span>
            <span class="n">data_package</span><span class="o">.</span><span class="n">img</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="n">filter_imgdata_list</span><span class="p">(</span><span class="n">img_list</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">ids</span><span class="o">=</span><span class="n">common_ids</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">images</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">presplit_processor</span><span class="p">(</span><span class="n">modality_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Processes img-to-img modality data with normalization for images.&quot;&quot;&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;calling normalize image in _process_ing_to_img_case&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_image_data</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">modality_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">postsplit_processor</span><span class="p">(</span>
            <span class="n">split_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;No postsplit processing needed for image data.&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">split_data</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_data_case</span><span class="p">(</span>
            <span class="n">data_package</span><span class="p">,</span>
            <span class="n">modality_processors</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;img&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">presplit_processor</span><span class="p">(</span>
                        <span class="n">data</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">postsplit_processor</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="c1"># This method would be inside your GeneralPreprocessor or a similar class</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_split_data_package</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">data_package</span><span class="p">:</span> <span class="n">DataPackage</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Splits a data package into train/validation/test sets using a</span>
<span class="sd">        pairing-aware strategy.</span>

<span class="sd">        This method first uses PairedUnpairedSplitter to generate a single,</span>
<span class="sd">        synchronized set of indices for all modalities. It then uses</span>
<span class="sd">        DataPackageSplitter to apply these indices to the data.</span>

<span class="sd">        Args:</span>
<span class="sd">            data_package: The DataPackage to be split.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple containing:</span>
<span class="sd">            1. A dictionary of the split DataPackages.</span>
<span class="sd">            2. A dictionary of the synchronized integer indices used for the split.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- Running Pairing-Aware Split ---&quot;</span><span class="p">)</span>

        <span class="c1"># 1. Instantiate our new pairing-aware splitter with the full data package.</span>
        <span class="n">pairing_splitter</span> <span class="o">=</span> <span class="n">PairedUnpairedSplitter</span><span class="p">(</span>
            <span class="n">data_package</span><span class="o">=</span><span class="n">data_package</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span>
        <span class="p">)</span>

        <span class="c1"># 2. Generate the single, synchronized dictionary of indices.</span>
        <span class="c1"># This is the exact `split_indices_config` you want to return.</span>
        <span class="n">split_indices_config</span> <span class="o">=</span> <span class="n">pairing_splitter</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Successfully generated synchronized indices for all modalities.&quot;</span><span class="p">)</span>

        <span class="c1"># 3. Instantiate your original DataPackageSplitter.</span>
        <span class="c1"># It now receives indices that are guaranteed to be consistent.</span>
        <span class="n">data_package_splitter</span> <span class="o">=</span> <span class="n">DataPackageSplitter</span><span class="p">(</span>
            <span class="n">data_package</span><span class="o">=</span><span class="n">data_package</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
            <span class="n">indices</span><span class="o">=</span><span class="n">split_indices_config</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># 4. Perform the actual split using the synchronized indices.</span>
        <span class="n">split_datasets</span> <span class="o">=</span> <span class="n">data_package_splitter</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

        <span class="c1"># 5. Return both the split data and the indices used, just like your old method.</span>
        <span class="k">return</span> <span class="n">split_datasets</span><span class="p">,</span> <span class="n">split_indices_config</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_image_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if data is image data.</span>

<span class="sd">        Determines if the provided data is a list of objects that are considered</span>
<span class="sd">        image data based on having an &#39;img&#39; attribute.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: The data to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the data is image data, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;img&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_remove_nans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_package</span><span class="p">:</span> <span class="n">DataPackage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataPackage</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove NaN values from the data package.</span>

<span class="sd">        Utilizes NaNRemover to identify and remove rows containing NaN values</span>
<span class="sd">        in relevant annotation columns within the DataPackage.</span>

<span class="sd">        Args:</span>
<span class="sd">            data_package: The DataPackage from which to remove NaNs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The DataPackage with NaN values removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nanremover</span> <span class="o">=</span> <span class="n">NaNRemover</span><span class="p">(</span>
            <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">nanremover</span><span class="o">.</span><span class="n">remove_nan</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_package</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_normalize_image_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">info_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process images with normalization.</span>

<span class="sd">        Normalizes a list of image data objects using ImageNormalizer based on</span>
<span class="sd">        the scaling method specified in the configuration for the given info_key.</span>

<span class="sd">        Args:</span>
<span class="sd">            images: A list of image data objects (each having an &#39;img&#39; attribute).</span>
<span class="sd">            info_key: The key referencing data information in the configuration to get the scaling method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of processed image data objects with normalized image data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">scaling_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_config</span><span class="o">.</span><span class="n">data_info</span><span class="p">[</span><span class="n">info_key</span><span class="p">]</span><span class="o">.</span><span class="n">scaling</span>
        <span class="k">if</span> <span class="n">scaling_method</span> <span class="o">==</span> <span class="s2">&quot;NONE&quot;</span><span class="p">:</span>
            <span class="n">scaling_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scaling</span>
        <span class="n">processed_images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">normalizer</span> <span class="o">=</span> <span class="n">ImageNormalizer</span><span class="p">()</span>  <span class="c1"># Instance created once here</span>

        <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
            <span class="n">img</span><span class="o">.</span><span class="n">img</span> <span class="o">=</span> <span class="n">normalizer</span><span class="o">.</span><span class="n">normalize_image</span><span class="p">(</span>  <span class="c1"># Modify directly</span>
                <span class="n">image</span><span class="o">=</span><span class="n">img</span><span class="o">.</span><span class="n">img</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">scaling_method</span>
            <span class="p">)</span>
            <span class="n">processed_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">processed_images</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_translation_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract from and to keys from config.</span>

<span class="sd">        Retrieves the &#39;from&#39; and &#39;to&#39; modality keys from the data configuration</span>
<span class="sd">        based on the &#39;translate_direction&#39; setting.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple containing the from_key and to_key as strings, or None if not found.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If neither &#39;from&#39; nor &#39;to&#39; keys are found in the data configuration.</span>
<span class="sd">            TypeError: If the translate_direction is not set for the data_info.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">from_key</span><span class="p">,</span> <span class="n">to_key</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_config</span><span class="o">.</span><span class="n">data_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">translate_direction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">translate_direction</span> <span class="o">==</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span>
                <span class="n">from_key</span> <span class="o">=</span> <span class="n">k</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">translate_direction</span> <span class="o">==</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span>
                <span class="n">to_key</span> <span class="o">=</span> <span class="n">k</span>
        <span class="k">return</span> <span class="n">from_key</span><span class="p">,</span> <span class="n">to_key</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_user_translation_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_user_data</span><span class="p">:</span> <span class="n">DataPackage</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_user_data</span><span class="o">.</span><span class="n">from_modality</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_user_data</span><span class="o">.</span><span class="n">to_modality</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">raw_user_data</span><span class="o">.</span><span class="n">from_modality</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">raw_user_data</span><span class="o">.</span><span class="n">to_modality</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;from_modality and to_modality cannot be None for Translation&quot;</span>
                <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">raw_user_data</span><span class="o">.</span><span class="n">from_modality</span><span class="o">.</span><span class="n">keys</span><span class="p">())),</span> <span class="nb">next</span><span class="p">(</span>
                    <span class="nb">iter</span><span class="p">(</span><span class="n">raw_user_data</span><span class="o">.</span><span class="n">to_modality</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error getting from or to keys&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;returning None&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">format_reconstruction</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">reconstruction</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Result</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataPackage</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BasePreprocessor.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">ontologies</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes the BasePreprocessor with a configuration object.</p>


<details class="args-" open>
  <summary>Args</summary>
  <p>config: A DefaultConfig object containing preprocessing configurations.
ontologies: Ontology information, if provided for Ontix.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">DefaultConfig</span><span class="p">,</span>
    <span class="n">ontologies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the BasePreprocessor with a configuration object.</span>

<span class="sd">    Args :</span>
<span class="sd">        config: A DefaultConfig object containing preprocessing configurations.</span>
<span class="sd">        ontologies: Ontology information, if provided for Ontix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_container</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DatasetContainer</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">processed_data</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">DataPackage</span><span class="p">]]]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bulk_genes_to_keep</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bulk_scalers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sc_genes_to_keep</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sc_scalers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sc_general_genes_to_keep</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ontologies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">ontologies</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_readers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Enum</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">DataCase</span><span class="o">.</span><span class="n">MULTI_SINGLE_CELL</span><span class="p">:</span> <span class="n">SingleCellDataReader</span><span class="p">(),</span>
        <span class="n">DataCase</span><span class="o">.</span><span class="n">MULTI_BULK</span><span class="p">:</span> <span class="n">BulkDataReader</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">),</span>
        <span class="n">DataCase</span><span class="o">.</span><span class="n">BULK_TO_BULK</span><span class="p">:</span> <span class="n">BulkDataReader</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">),</span>
        <span class="n">DataCase</span><span class="o">.</span><span class="n">SINGLE_CELL_TO_SINGLE_CELL</span><span class="p">:</span> <span class="n">SingleCellDataReader</span><span class="p">(),</span>
        <span class="n">DataCase</span><span class="o">.</span><span class="n">IMG_TO_BULK</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;bulk&quot;</span><span class="p">:</span> <span class="n">BulkDataReader</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">),</span>
            <span class="s2">&quot;img&quot;</span><span class="p">:</span> <span class="n">ImageDataReader</span><span class="p">(),</span>
        <span class="p">},</span>
        <span class="n">DataCase</span><span class="o">.</span><span class="n">SINGLE_CELL_TO_IMG</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;sc&quot;</span><span class="p">:</span> <span class="n">SingleCellDataReader</span><span class="p">(),</span>
            <span class="s2">&quot;img&quot;</span><span class="p">:</span> <span class="n">ImageDataReader</span><span class="p">(),</span>
        <span class="p">},</span>
        <span class="n">DataCase</span><span class="o">.</span><span class="n">IMG_TO_IMG</span><span class="p">:</span> <span class="n">ImageDataReader</span><span class="p">(),</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BasePreprocessor.preprocess" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">preprocess</span><span class="p">(</span><span class="n">raw_user_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">predict_new_data</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>To be implemented by subclasses for specific preprocessing steps.
Args:
    raw_user_data: Users can provide raw data. This is an alternative way of
        providing data via filepaths in the config. If this param is passed, we skip the data reading step.
    predict_new_data: Indicates whether the user wants to predict with unseen data.
        If this is the case, we don't split the data and only prerpocess.</p>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">preprocess</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">raw_user_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataPackage</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">predict_new_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetContainer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;To be implemented by subclasses for specific preprocessing steps.</span>
<span class="sd">    Args:</span>
<span class="sd">        raw_user_data: Users can provide raw data. This is an alternative way of</span>
<span class="sd">            providing data via filepaths in the config. If this param is passed, we skip the data reading step.</span>
<span class="sd">        predict_new_data: Indicates whether the user wants to predict with unseen data.</span>
<span class="sd">            If this is the case, we don&#39;t split the data and only prerpocess.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="autoencodix.base.BaseTrainer" class="doc doc-heading">
            <code>BaseTrainer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>General training logic for all autoencoder models.</p>
<p>This class sets up the model, optimizer, and data loaders. It also handles
reproducibility and model-specific configurations. Subclasses must implement
model training and prediction logic.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseTrainer._trainset">_trainset</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataset used for training.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseTrainer._validset">_validset</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataset used for validation, if provided.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseTrainer._result">_result</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An object to store and manage training results.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseTrainer._config">_config</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration object containing training hyperparameters and settings.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseTrainer._model_type">_model_type</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The autoencoder model class to be trained.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseTrainer._loss_fn">_loss_fn</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Instantiated loss function specific to the model.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseTrainer._trainloader">_trainloader</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the training dataset.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseTrainer._validloader">_validloader</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the validation dataset, if provided.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseTrainer._model">_model</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="BaseAutoencoder (autoencodix.base._base_autoencoder.BaseAutoencoder)" href="#autoencodix.base.BaseAutoencoder">BaseAutoencoder</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The instantiated model architecture.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseTrainer._optimizer">_optimizer</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="BaseAutoencoder (autoencodix.base._base_autoencoder.BaseAutoencoder)" href="#autoencodix.base.BaseAutoencoder">BaseAutoencoder</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The optimizer used for training.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseTrainer._fabric">_fabric</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Lightning Fabric wrapper for device and precision management.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseTrainer.ontologies">ontologies</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ontology information, if provided for Ontix</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/autoencodix/base/_base_trainer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BaseTrainer</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;General training logic for all autoencoder models.</span>

<span class="sd">    This class sets up the model, optimizer, and data loaders. It also handles</span>
<span class="sd">    reproducibility and model-specific configurations. Subclasses must implement</span>
<span class="sd">    model training and prediction logic.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        _trainset: The dataset used for training.</span>
<span class="sd">        _validset: The dataset used for validation, if provided.</span>
<span class="sd">        _result: An object to store and manage training results.</span>
<span class="sd">        _config: Configuration object containing training hyperparameters and settings.</span>
<span class="sd">        _model_type: The autoencoder model class to be trained.</span>
<span class="sd">        _loss_fn: Instantiated loss function specific to the model.</span>
<span class="sd">        _trainloader: DataLoader for the training dataset.</span>
<span class="sd">        _validloader: DataLoader for the validation dataset, if provided.</span>
<span class="sd">        _model: The instantiated model architecture.</span>
<span class="sd">        _optimizer: The optimizer used for training.</span>
<span class="sd">        _fabric: Lightning Fabric wrapper for device and precision management.</span>
<span class="sd">        ontologies: Ontology information, if provided for Ontix</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">trainset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseDataset</span><span class="p">],</span>
        <span class="n">validset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseDataset</span><span class="p">],</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">Result</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">DefaultConfig</span><span class="p">,</span>
        <span class="n">model_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseAutoencoder</span><span class="p">],</span>
        <span class="n">loss_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseLoss</span><span class="p">],</span>
        <span class="n">ontologies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Addition to Varix, mandotory for Ontix</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trainset</span> <span class="o">=</span> <span class="n">trainset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span> <span class="o">=</span> <span class="n">model_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validset</span> <span class="o">=</span> <span class="n">validset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ontologies</span> <span class="o">=</span> <span class="n">ontologies</span>

        <span class="c1"># Call this first for tests to work</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_validation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_reproducibility</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_loss_fn</span> <span class="o">=</span> <span class="n">loss_type</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">)</span>

        <span class="c1"># Internal data handling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">:</span> <span class="n">BaseAutoencoder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fabric</span> <span class="o">=</span> <span class="n">Fabric</span><span class="p">(</span>
            <span class="n">accelerator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
            <span class="n">devices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">n_gpus</span><span class="p">,</span>
            <span class="n">precision</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">float_precision</span><span class="p">,</span>
            <span class="n">strategy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">gpu_strategy</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_loaders</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_fabric</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_cpus</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_cpus</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_n_cpus</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_fabric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the model, optimizer, and data loaders with Lightning Fabric.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_dim</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">BaseDataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trainset</span><span class="p">)</span><span class="o">.</span><span class="n">get_input_dim</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_model_architecture</span><span class="p">(</span><span class="n">ontologies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ontologies</span><span class="p">)</span>  <span class="c1"># Ontix</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">AdamW</span><span class="p">(</span>
            <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span>
            <span class="n">lr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">learning_rate</span><span class="p">,</span>
            <span class="n">weight_decay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">weight_decay</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fabric</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimizer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trainloader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fabric</span><span class="o">.</span><span class="n">setup_dataloaders</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_trainloader</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validloader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validloader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fabric</span><span class="o">.</span><span class="n">setup_dataloaders</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validloader</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fabric</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_init_loaders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the DataLoaders for training and validation datasets.&quot;&quot;&quot;</span>
        <span class="n">last_batch_is_one_sample</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_trainset</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">corrected_bs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">last_batch_is_one_sample</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">batch_size</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">last_batch_is_one_sample</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;increased batch_size to </span><span class="si">{</span><span class="n">corrected_bs</span><span class="si">}</span><span class="s2"> for trainset, to avoid dropping samples and having batches (makes trainingdynamics messy with missing samples per epoch) of size one (fails for Models with BachNorm)&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_trainloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span>
            <span class="n">cast</span><span class="p">(</span><span class="n">BaseDataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trainset</span><span class="p">),</span>
            <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="n">corrected_bs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validset</span><span class="p">:</span>
            <span class="n">last_batch_is_one_sample</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validset</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="p">)</span>
            <span class="n">corrected_bs</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">last_batch_is_one_sample</span>
                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">batch_size</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">last_batch_is_one_sample</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;increased batch_size to </span><span class="si">{</span><span class="n">corrected_bs</span><span class="si">}</span><span class="s2"> for validset, to avoid dropping samples and having batches (makes trainingdynamics messy with missing samples per epoch) of size one (fails for Models with BachNorm)&quot;</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_validloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span>
                <span class="n">dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_validset</span><span class="p">,</span>
                <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
                <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validloader</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: ignore</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_input_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trainset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Trainset cannot be None. Check the indices you provided with a custom split or be sure that the train_ratio attribute of the config is &gt;0.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_trainset</span><span class="p">,</span> <span class="n">BaseDataset</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expected train type to be an instance of BaseDataset, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_trainset</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;training without validation&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validset</span><span class="p">,</span> <span class="n">BaseDataset</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expected valid type to be an instance of BaseDataset, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validset</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Config cannot be None.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_reproducibility</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets all relevant seeds for reproducibility</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: If the device is set to &quot;mps&quot; (Apple Silicon).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">reproducible</span><span class="p">:</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">use_deterministic_algorithms</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">global_seed</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="s2">&quot;cuda&quot;</span><span class="p">:</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">global_seed</span><span class="p">)</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">manual_seed_all</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">global_seed</span><span class="p">)</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">deterministic</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">benchmark</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="s2">&quot;mps&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">&quot;MPS backend does not support reproducibility settings.&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cpu not relevant here&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_init_model_architecture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ontologies</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the model architecture, based on the model type and input dimension.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ontologies</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span><span class="p">(</span>
                <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">,</span> <span class="n">input_dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_dim</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">## Ontix specific</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span><span class="p">(</span>
                <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">,</span>
                <span class="n">input_dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_dim</span><span class="p">,</span>
                <span class="n">ontologies</span><span class="o">=</span><span class="n">ontologies</span><span class="p">,</span>
                <span class="n">feature_order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_trainset</span><span class="o">.</span><span class="n">feature_ids</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_should_checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">checkpoint_interval</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="ow">or</span> <span class="n">epoch</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">epochs</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="p">)</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epochs_overwrite</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">BaseDataset</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="autoencodix.base.BaseVisualizer" class="doc doc-heading">
            <code>BaseVisualizer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Defines the interface for visualizing training results.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="autoencodix.base.BaseVisualizer.plots">plots</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A nested dictionary to store various plots.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/autoencodix/base/_base_visualizer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BaseVisualizer</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Defines the interface for visualizing training results.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        plots: A nested dictionary to store various plots.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plots</span> <span class="o">=</span> <span class="n">nested_dict</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span>

    <span class="c1">### Abstract Methods ###</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">visualize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">Result</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">DefaultConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">show_latent_space</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">Result</span><span class="p">,</span>
        <span class="n">plot_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2D-scatter&quot;</span><span class="p">,</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">param</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">epoch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">split</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">show_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1">### General Functions used by all Visualizers in similar way ###</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">show_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;absolute&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display the loss plot.</span>
<span class="sd">        Args:</span>
<span class="sd">            plot_type: Type of loss plot to display. Options are &quot;absolute&quot; or &quot;relative&quot;. Options are</span>
<span class="sd">                &quot;absolute&quot; for the absolute loss plot and</span>
<span class="sd">                &quot;relative&quot; for the relative loss plot.</span>
<span class="sd">                Defaults to &quot;absolute&quot;.</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;absolute&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;loss_absolute&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Absolute loss plot not found in the plots dictionary&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You need to run visualize() method first&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="s2">&quot;loss_absolute&quot;</span><span class="p">]</span>
                <span class="n">show_figure</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;relative&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;loss_relative&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Relative loss plot not found in the plots dictionary&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You need to run visualize() method first&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="s2">&quot;loss_relative&quot;</span><span class="p">]</span>
                <span class="n">show_figure</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">plot_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;absolute&quot;</span><span class="p">,</span> <span class="s2">&quot;relative&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Type of loss plot not recognized. Please use &#39;absolute&#39; or &#39;relative&#39;&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">show_evaluation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ml_alg</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays the evaluation plot for a specific clinical parameter, metric, and optionally ML algorithm.</span>
<span class="sd">        Args:</span>
<span class="sd">            param: clinical parameter to visualize.</span>
<span class="sd">            metric: metric to visualize.</span>
<span class="sd">            ml_alg: ML algorithm to visualize. If None, plots all available algorithms.</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;ML_Evaluation&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ML Evaluation plots not found in the plots dictionary&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You need to run evaluate() method first&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="s2">&quot;ML_Evaluation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parameter </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> not found in the ML Evaluation plots&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Available parameters: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="s1">&#39;ML_Evaluation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">metric</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="s2">&quot;ML_Evaluation&quot;</span><span class="p">][</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metric </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> not found in the ML Evaluation plots for </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Available metrics: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="s1">&#39;ML_Evaluation&#39;</span><span class="p">][</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">algs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="s2">&quot;ML_Evaluation&quot;</span><span class="p">][</span><span class="n">param</span><span class="p">][</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">ml_alg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ml_alg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">algs</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ML algorithm </span><span class="si">{</span><span class="n">ml_alg</span><span class="si">}</span><span class="s2"> not found for </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Available ML algorithms: </span><span class="si">{</span><span class="n">algs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="s2">&quot;ML_Evaluation&quot;</span><span class="p">][</span><span class="n">param</span><span class="p">][</span><span class="n">metric</span><span class="p">][</span><span class="n">ml_alg</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>
            <span class="n">show_figure</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">alg</span> <span class="ow">in</span> <span class="n">algs</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Showing plot for ML algorithm: </span><span class="si">{</span><span class="n">alg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="s2">&quot;ML_Evaluation&quot;</span><span class="p">][</span><span class="n">param</span><span class="p">][</span><span class="n">metric</span><span class="p">][</span><span class="n">alg</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>
                <span class="n">show_figure</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_plots</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">which</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;png&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save specified plots to the given path in the specified format.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: The directory path where the plots will be saved.</span>
<span class="sd">            which: A list of plot names to save or a string specifying which plots to save.</span>
<span class="sd">                   If &#39;all&#39;, all plots in the plots dictionary will be saved.</span>
<span class="sd">                   If a single plot name is provided as a string, only that plot will be saved.</span>
<span class="sd">            format: The file format in which to save the plots (e.g., &#39;png&#39;, &#39;jpg&#39;).</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the &#39;which&#39; parameter is not a list or a string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">which</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1">## Case when which is a string</span>
            <span class="k">if</span> <span class="n">which</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
                <span class="c1">## Case when all plots are to be saved</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No plots found in the plots dictionary&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You need to run  visualize() method first&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">nested_to_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">):</span>
                        <span class="n">fig</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1">## Figure is in last element of the tuple</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fullpath</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">## Case when a single plot is provided as string</span>
                <span class="k">if</span> <span class="n">which</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plot </span><span class="si">{</span><span class="n">which</span><span class="si">}</span><span class="s2"> not found in the plots dictionary&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All available plots are: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">nested_to_tuple</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="n">which</span><span class="p">]</span>
                    <span class="p">):</span>  <span class="c1"># Plot all epochs and splits of type which</span>
                        <span class="n">fig</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1">## Figure is in last element of the tuple</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="n">which</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># type: ignore</span>
                        <span class="n">fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fullpath</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">## Case when which is a list of plot specified as strings</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">which</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plot </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> not found in the plots dictionary&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All available plots are: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">nested_to_tuple</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    <span class="p">):</span>  <span class="c1"># Plot all epochs and splits of type key</span>
                        <span class="n">fig</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1">## Figure is in last element of the tuple</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fullpath</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1">### Utilities ###</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_make_loss_format</span><span class="p">(</span><span class="n">result</span><span class="p">:</span> <span class="n">Result</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">DefaultConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">loss_df_melt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">sub_losses</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># Get the loss values and ensure it&#39;s a dictionary</span>
            <span class="n">loss_values</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">sub_losses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">term</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

            <span class="c1"># Add explicit type checking/conversion</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">loss_values</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="c1"># If it&#39;s not a dict, try to convert it or handle appropriately</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">loss_values</span><span class="p">,</span> <span class="s2">&quot;to_dict&quot;</span><span class="p">):</span>
                    <span class="n">loss_values</span> <span class="o">=</span> <span class="n">loss_values</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># For non-convertible types, you might need a custom solution</span>
                    <span class="c1"># For numpy arrays, you could do something like:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">loss_values</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">):</span>
                        <span class="c1"># For numpy arrays, create a dict with indices as keys</span>
                        <span class="n">loss_values</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">loss_values</span><span class="p">)}</span>

            <span class="c1"># Now create the DataFrame</span>
            <span class="n">loss_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">loss_values</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

            <span class="c1"># Rest of your code remains the same</span>
            <span class="k">if</span> <span class="n">term</span> <span class="o">==</span> <span class="s2">&quot;var_loss&quot;</span><span class="p">:</span>
                <span class="n">loss_df</span> <span class="o">=</span> <span class="n">loss_df</span> <span class="o">*</span> <span class="n">config</span><span class="o">.</span><span class="n">beta</span>
            <span class="n">loss_df</span><span class="p">[</span><span class="s2">&quot;Epoch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loss_df</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">loss_df</span><span class="p">[</span><span class="s2">&quot;Loss Term&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">term</span>

            <span class="n">loss_df_melt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">loss_df_melt</span><span class="p">,</span>
                    <span class="n">loss_df</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
                        <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Epoch&quot;</span><span class="p">,</span> <span class="s2">&quot;Loss Term&quot;</span><span class="p">],</span>
                        <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;Split&quot;</span><span class="p">,</span>
                        <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;Loss Value&quot;</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">],</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Similar handling for the total losses</span>
        <span class="n">loss_values</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">loss_values</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">loss_values</span><span class="p">,</span> <span class="s2">&quot;to_dict&quot;</span><span class="p">):</span>
                <span class="n">loss_values</span> <span class="o">=</span> <span class="n">loss_values</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">loss_values</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">):</span>
                    <span class="n">loss_values</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">loss_values</span><span class="p">)}</span>

        <span class="n">loss_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">loss_values</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="n">loss_df</span><span class="p">[</span><span class="s2">&quot;Epoch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loss_df</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">loss_df</span><span class="p">[</span><span class="s2">&quot;Loss Term&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;total_loss&quot;</span>

        <span class="n">loss_df_melt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">loss_df_melt</span><span class="p">,</span>
                <span class="n">loss_df</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
                    <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Epoch&quot;</span><span class="p">,</span> <span class="s2">&quot;Loss Term&quot;</span><span class="p">],</span>
                    <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;Split&quot;</span><span class="p">,</span>
                    <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;Loss Value&quot;</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">loss_df_melt</span><span class="p">[</span><span class="s2">&quot;Loss Value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loss_df_melt</span><span class="p">[</span><span class="s2">&quot;Loss Value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">loss_df_melt</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_make_loss_plot</span><span class="p">(</span>
        <span class="n">df_plot</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">plot_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a plot for visualizing loss values from a DataFrame.</span>

<span class="sd">        Args:</span>
<span class="sd">            df_plot : DataFrame containing the loss values to be plotted. It should have the columns:</span>
<span class="sd">                - &quot;Loss Term&quot;: The type of loss term (e.g., &quot;total_loss&quot;, &quot;reconstruction_loss&quot;).</span>
<span class="sd">                - &quot;Epoch&quot;: The epoch number.</span>
<span class="sd">                - &quot;Loss Value&quot;: The value of the loss.</span>
<span class="sd">                - &quot;Split&quot;: The data split (e.g., &quot;train&quot;, &quot;validation&quot;).</span>

<span class="sd">            plot_type: The type of plot to generate. It can be either &quot;absolute&quot; or &quot;relative&quot;.</span>
<span class="sd">                - &quot;absolute&quot;: Generates a line plot for each unique loss term.</span>
<span class="sd">                - &quot;relative&quot;: Generates a density plot for each data split, excluding the &quot;total_loss&quot; term.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The generated matplotlib figure containing the loss plots.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_width_abs</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_plot</span><span class="p">[</span><span class="s2">&quot;Loss Term&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
        <span class="n">fig_width_rel</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_plot</span><span class="p">[</span><span class="s2">&quot;Split&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;absolute&quot;</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">df_plot</span><span class="p">[</span><span class="s2">&quot;Loss Term&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span>
                <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_width_abs</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">df_plot</span><span class="p">[</span><span class="s2">&quot;Loss Term&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">df_plot</span><span class="p">[(</span><span class="n">df_plot</span><span class="p">[</span><span class="s2">&quot;Loss Term&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">term</span><span class="p">)],</span>
                    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Epoch&quot;</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Loss Value&quot;</span><span class="p">,</span>
                    <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Split&quot;</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span>
                <span class="p">)</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
                <span class="n">ax</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;relative&quot;</span><span class="p">:</span>
            <span class="c1"># Check if loss values are positive</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">df_plot</span><span class="p">[</span><span class="s2">&quot;Loss Value&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="c1"># Warning</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Loss values contain negative values. Check your loss function if correct. Loss will be clipped to zero for plotting.&quot;</span>
                <span class="p">)</span>
                <span class="n">df_plot</span><span class="p">[</span><span class="s2">&quot;Loss Value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_plot</span><span class="p">[</span><span class="s2">&quot;Loss Value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Exclude loss terms where all Loss Value are zero or NaN over all epochs</span>
            <span class="n">valid_terms</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">term</span>
                <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">df_plot</span><span class="p">[</span><span class="s2">&quot;Loss Term&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">df_plot</span><span class="p">[</span><span class="n">df_plot</span><span class="p">[</span><span class="s2">&quot;Loss Term&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">term</span><span class="p">][</span><span class="s2">&quot;Loss Value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">())</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">df_plot</span><span class="p">[</span><span class="n">df_plot</span><span class="p">[</span><span class="s2">&quot;Loss Term&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">term</span><span class="p">][</span><span class="s2">&quot;Loss Value&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">]</span>
            <span class="n">exclude</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">df_plot</span><span class="p">[</span><span class="s2">&quot;Loss Term&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;total_loss&quot;</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">df_plot</span><span class="p">[</span><span class="s2">&quot;Loss Term&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;_factor&quot;</span><span class="p">))</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_plot</span><span class="p">[</span><span class="s2">&quot;Loss Term&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">valid_terms</span><span class="p">))</span>
            <span class="p">)</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_width_rel</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">ax</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">df_plot</span><span class="p">[</span><span class="s2">&quot;Split&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">df_plot</span><span class="p">[</span><span class="n">exclude</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_plot</span><span class="p">[</span><span class="s2">&quot;Split&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">split</span><span class="p">)],</span>
                    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Epoch&quot;</span><span class="p">,</span>
                    <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Loss Term&quot;</span><span class="p">,</span>
                    <span class="n">multiple</span><span class="o">=</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span>
                    <span class="n">weights</span><span class="o">=</span><span class="s2">&quot;Loss Value&quot;</span><span class="p">,</span>
                    <span class="n">clip</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">df_plot</span><span class="p">[</span><span class="s2">&quot;Epoch&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span>
                <span class="p">)</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">split</span><span class="p">)</span>
                <span class="n">ax</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fig</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_plot_model_weights</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Visualization of model weights in encoder and decoder layers as heatmap for each layer as subplot.</span>
<span class="sd">        Handles non-symmetrical autoencoder architectures.</span>
<span class="sd">        Plots _mu layer for encoder as well.</span>
<span class="sd">        Uses node_names for decoder layers if model has ontologies.</span>
<span class="sd">        ARGS:</span>
<span class="sd">            model (torch.nn.Module): PyTorch model instance.</span>
<span class="sd">        RETURNS:</span>
<span class="sd">            fig (matplotlib.figure): Figure handle (of last plot)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_weights</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">node_names</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;ontologies&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">ontologies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">node_names</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ontology</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">ontologies</span><span class="p">:</span>
                    <span class="n">node_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ontology</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="n">node_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">feature_order</span><span class="p">)</span>

        <span class="c1"># Collect encoder and decoder weights separately</span>
        <span class="n">encoder_weights</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">encoder_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">decoder_weights</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">decoder_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">named_parameters</span><span class="p">():</span>
            <span class="c1"># print(name)</span>
            <span class="k">if</span> <span class="s2">&quot;weight&quot;</span> <span class="ow">in</span> <span class="n">name</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;encoder&quot;</span> <span class="ow">in</span> <span class="n">name</span> <span class="ow">and</span> <span class="s2">&quot;var&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span> <span class="ow">and</span> <span class="s2">&quot;_mu&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">encoder_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
                    <span class="n">encoder_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">7</span><span class="p">])</span>
                <span class="k">elif</span> <span class="s2">&quot;_mu&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">encoder_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
                    <span class="n">encoder_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">7</span><span class="p">])</span>
                <span class="k">elif</span> <span class="s2">&quot;decoder&quot;</span> <span class="ow">in</span> <span class="n">name</span> <span class="ow">and</span> <span class="s2">&quot;var&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">decoder_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
                    <span class="n">decoder_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">7</span><span class="p">])</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="s2">&quot;encoder&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span>
                    <span class="ow">and</span> <span class="s2">&quot;decoder&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span>
                    <span class="ow">and</span> <span class="s2">&quot;var&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span>
                <span class="p">):</span>
                    <span class="c1"># fallback for models without explicit encoder/decoder in name</span>
                    <span class="n">all_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
                    <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">7</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">encoder_weights</span> <span class="ow">or</span> <span class="n">decoder_weights</span><span class="p">:</span>
            <span class="n">n_enc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">encoder_weights</span><span class="p">)</span>
            <span class="n">n_dec</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">decoder_weights</span><span class="p">)</span>
            <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">n_enc</span><span class="p">,</span> <span class="n">n_dec</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span> <span class="o">*</span> <span class="n">n_cols</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">n_cols</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Plot encoder weights</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_enc</span><span class="p">):</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
                <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
                    <span class="n">encoder_weights</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;Spectral&quot;</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                    <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">encoder_names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Out Node&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="c1"># Hide unused encoder subplots</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_enc</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">):</span>
                <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
            <span class="c1"># Plot decoder weights</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_dec</span><span class="p">):</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
                <span class="n">heatmap_kwargs</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
                    <span class="n">decoder_weights</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;Spectral&quot;</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                    <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">heatmap_kwargs</span><span class="p">,</span>
                <span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">decoder_names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">ontologies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span>
                        <span class="n">ticks</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_names</span><span class="p">[</span><span class="n">i</span><span class="p">])),</span>  <span class="c1"># type: ignore</span>
                        <span class="n">labels</span><span class="o">=</span><span class="n">node_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>  <span class="c1"># type: ignore</span>
                        <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span>
                        <span class="n">ticks</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_names</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])),</span>  <span class="c1"># type: ignore</span>
                        <span class="n">labels</span><span class="o">=</span><span class="n">node_names</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># type: ignore</span>
                        <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;In Node&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Out Node&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="c1"># Hide unused decoder subplots</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_dec</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">):</span>
                <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># fallback: plot all weights in order, split in half for encoder/decoder</span>
            <span class="n">n_layers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_weights</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
                <span class="mi">2</span><span class="p">,</span> <span class="n">n_layers</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">n_layers</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_layers</span><span class="p">):</span>
                <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
                    <span class="n">all_weights</span><span class="p">[</span><span class="n">layer</span><span class="p">],</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;Spectral&quot;</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                    <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">layer</span><span class="p">],</span>
                <span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="n">layer</span><span class="p">])</span>
                <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
                    <span class="n">all_weights</span><span class="p">[</span><span class="n">n_layers</span> <span class="o">+</span> <span class="n">layer</span><span class="p">],</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;Spectral&quot;</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                    <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">layer</span><span class="p">],</span>
                <span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="n">n_layers</span> <span class="o">+</span> <span class="n">layer</span><span class="p">])</span>
                <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">layer</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;In Node&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
                <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">layer</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Out Node&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
                <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">layer</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Out Node&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Model Weights&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BaseVisualizer.save_plots" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_plots</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Save specified plots to the given path in the specified format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directory path where the plots will be saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>which</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="list">list</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of plot names to save or a string specifying which plots to save.
   If 'all', all plots in the plots dictionary will be saved.
   If a single plot name is provided as a string, only that plot will be saved.</p>
              </div>
            </td>
            <td>
                  <code>&#39;all&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>format</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file format in which to save the plots (e.g., 'png', 'jpg').</p>
              </div>
            </td>
            <td>
                  <code>&#39;png&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the 'which' parameter is not a list or a string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_visualizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_plots</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">which</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;png&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save specified plots to the given path in the specified format.</span>

<span class="sd">    Args:</span>
<span class="sd">        path: The directory path where the plots will be saved.</span>
<span class="sd">        which: A list of plot names to save or a string specifying which plots to save.</span>
<span class="sd">               If &#39;all&#39;, all plots in the plots dictionary will be saved.</span>
<span class="sd">               If a single plot name is provided as a string, only that plot will be saved.</span>
<span class="sd">        format: The file format in which to save the plots (e.g., &#39;png&#39;, &#39;jpg&#39;).</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the &#39;which&#39; parameter is not a list or a string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">which</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="c1">## Case when which is a string</span>
        <span class="k">if</span> <span class="n">which</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="c1">## Case when all plots are to be saved</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No plots found in the plots dictionary&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You need to run  visualize() method first&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">nested_to_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">):</span>
                    <span class="n">fig</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1">## Figure is in last element of the tuple</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fullpath</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">## Case when a single plot is provided as string</span>
            <span class="k">if</span> <span class="n">which</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plot </span><span class="si">{</span><span class="n">which</span><span class="si">}</span><span class="s2"> not found in the plots dictionary&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All available plots are: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">nested_to_tuple</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="n">which</span><span class="p">]</span>
                <span class="p">):</span>  <span class="c1"># Plot all epochs and splits of type which</span>
                    <span class="n">fig</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1">## Figure is in last element of the tuple</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">which</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># type: ignore</span>
                    <span class="n">fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fullpath</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">## Case when which is a list of plot specified as strings</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">which</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plot </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> not found in the plots dictionary&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All available plots are: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">nested_to_tuple</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="p">):</span>  <span class="c1"># Plot all epochs and splits of type key</span>
                    <span class="n">fig</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1">## Figure is in last element of the tuple</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fullpath</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BaseVisualizer.show_evaluation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">show_evaluation</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">ml_alg</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Displays the evaluation plot for a specific clinical parameter, metric, and optionally ML algorithm.
Args:
    param: clinical parameter to visualize.
    metric: metric to visualize.
    ml_alg: ML algorithm to visualize. If None, plots all available algorithms.
Returns:
    None</p>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_visualizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">show_evaluation</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">ml_alg</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays the evaluation plot for a specific clinical parameter, metric, and optionally ML algorithm.</span>
<span class="sd">    Args:</span>
<span class="sd">        param: clinical parameter to visualize.</span>
<span class="sd">        metric: metric to visualize.</span>
<span class="sd">        ml_alg: ML algorithm to visualize. If None, plots all available algorithms.</span>
<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot;ML_Evaluation&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ML Evaluation plots not found in the plots dictionary&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You need to run evaluate() method first&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="s2">&quot;ML_Evaluation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parameter </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> not found in the ML Evaluation plots&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Available parameters: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="s1">&#39;ML_Evaluation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">metric</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="s2">&quot;ML_Evaluation&quot;</span><span class="p">][</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metric </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> not found in the ML Evaluation plots for </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Available metrics: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="s1">&#39;ML_Evaluation&#39;</span><span class="p">][</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">algs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="s2">&quot;ML_Evaluation&quot;</span><span class="p">][</span><span class="n">param</span><span class="p">][</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">ml_alg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ml_alg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">algs</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ML algorithm </span><span class="si">{</span><span class="n">ml_alg</span><span class="si">}</span><span class="s2"> not found for </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Available ML algorithms: </span><span class="si">{</span><span class="n">algs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="s2">&quot;ML_Evaluation&quot;</span><span class="p">][</span><span class="n">param</span><span class="p">][</span><span class="n">metric</span><span class="p">][</span><span class="n">ml_alg</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>
        <span class="n">show_figure</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">alg</span> <span class="ow">in</span> <span class="n">algs</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Showing plot for ML algorithm: </span><span class="si">{</span><span class="n">alg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="s2">&quot;ML_Evaluation&quot;</span><span class="p">][</span><span class="n">param</span><span class="p">][</span><span class="n">metric</span><span class="p">][</span><span class="n">alg</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>
            <span class="n">show_figure</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autoencodix.base.BaseVisualizer.show_loss" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">show_loss</span><span class="p">(</span><span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;absolute&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Display the loss plot.
Args:
    plot_type: Type of loss plot to display. Options are "absolute" or "relative". Options are
        "absolute" for the absolute loss plot and
        "relative" for the relative loss plot.
        Defaults to "absolute".
Returns:
    None</p>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/base/_base_visualizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">show_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;absolute&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display the loss plot.</span>
<span class="sd">    Args:</span>
<span class="sd">        plot_type: Type of loss plot to display. Options are &quot;absolute&quot; or &quot;relative&quot;. Options are</span>
<span class="sd">            &quot;absolute&quot; for the absolute loss plot and</span>
<span class="sd">            &quot;relative&quot; for the relative loss plot.</span>
<span class="sd">            Defaults to &quot;absolute&quot;.</span>
<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;absolute&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;loss_absolute&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Absolute loss plot not found in the plots dictionary&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You need to run visualize() method first&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="s2">&quot;loss_absolute&quot;</span><span class="p">]</span>
            <span class="n">show_figure</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;relative&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;loss_relative&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Relative loss plot not found in the plots dictionary&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You need to run visualize() method first&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="s2">&quot;loss_relative&quot;</span><span class="p">]</span>
            <span class="n">show_figure</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">plot_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;absolute&quot;</span><span class="p">,</span> <span class="s2">&quot;relative&quot;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Type of loss plot not recognized. Please use &#39;absolute&#39; or &#39;relative&#39;&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>