
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../disentanglix/">
      
      
        <link rel="next" href="../imagix/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Evaluate - Autoencodix</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e53b48f4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#evaluate-module" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Autoencodix" class="md-header__button md-logo" aria-label="Autoencodix" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Autoencodix
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Evaluate
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Autoencodix" class="md-nav__button md-logo" aria-label="Autoencodix" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Autoencodix
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Base
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../disentanglix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Disentanglix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Evaluate
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Evaluate
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#autoencodix.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      evaluate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoencodix.evaluate.GeneralEvaluator" class="md-nav__link">
    <span class="md-ellipsis">
      GeneralEvaluator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GeneralEvaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoencodix.evaluate.GeneralEvaluator.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      evaluate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoencodix.evaluate.XModalixEvaluator" class="md-nav__link">
    <span class="md-ellipsis">
      XModalixEvaluator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="XModalixEvaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoencodix.evaluate.XModalixEvaluator.pure_vae_comparison" class="md-nav__link">
    <span class="md-ellipsis">
      pure_vae_comparison
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../imagix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Imagix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modeling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modeling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Notebooks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ontix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ontix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stackix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stackix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../trainers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trainers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vanillix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vanillix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../varix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Varix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualize/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visualize
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#autoencodix.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      evaluate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoencodix.evaluate.GeneralEvaluator" class="md-nav__link">
    <span class="md-ellipsis">
      GeneralEvaluator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GeneralEvaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoencodix.evaluate.GeneralEvaluator.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      evaluate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoencodix.evaluate.XModalixEvaluator" class="md-nav__link">
    <span class="md-ellipsis">
      XModalixEvaluator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="XModalixEvaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoencodix.evaluate.XModalixEvaluator.pure_vae_comparison" class="md-nav__link">
    <span class="md-ellipsis">
      pure_vae_comparison
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="evaluate-module">Evaluate Module</h1>


<div class="doc doc-object doc-module">



<a id="autoencodix.evaluate"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="autoencodix.evaluate.GeneralEvaluator" class="doc doc-heading">
            <code>GeneralEvaluator</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseEvaluator (autoencodix.base._base_evaluator.BaseEvaluator)" href="../base/#autoencodix.base.BaseEvaluator">BaseEvaluator</a></code></p>









              <details class="quote">
                <summary>Source code in <code>src/autoencodix/evaluate/_general_evaluator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GeneralEvaluator</span><span class="p">(</span><span class="n">BaseEvaluator</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># super().__init__()</span>
        <span class="k">pass</span>

    <span class="nd">@no_type_check</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">datasets</span><span class="p">:</span> <span class="n">DatasetContainer</span><span class="p">,</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">Result</span><span class="p">,</span>
        <span class="n">ml_model_class</span><span class="p">:</span> <span class="n">ClassifierMixin</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LogisticRegression</span><span class="p">(),</span>  <span class="c1"># Default is sklearn LogisticRegression</span>
        <span class="n">ml_model_regression</span><span class="p">:</span> <span class="n">RegressorMixin</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">(),</span>  <span class="c1"># Default is sklearn LinearRegression</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="nb">list</span><span class="p">,</span> <span class="nb">str</span>
        <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>  <span class="c1"># No default? ... or all params in annotation?</span>
        <span class="n">metric_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;roc_auc_ovo&quot;</span><span class="p">,</span>  <span class="c1"># Default is &#39;roc_auc_ovo&#39; via https://scikit-learn.org/stable/modules/model_evaluation.html#scoring-string-names</span>
        <span class="n">metric_regression</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;r2&quot;</span><span class="p">,</span>  <span class="c1"># Default is &#39;r2&#39;</span>
        <span class="n">reference_methods</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>  <span class="c1"># Default [], Options are &quot;PCA&quot;, &quot;UMAP&quot;, &quot;TSNE&quot;, &quot;RandomFeature&quot;</span>
        <span class="n">split_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;use-split&quot;</span><span class="p">,</span>  <span class="c1"># Default is &quot;use-split&quot;, other options: &quot;CV-5&quot;, ... &quot;LOOCV&quot;?</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluates the performance of machine learning models on various feature representations and clinical parameters.</span>

<span class="sd">        This method performs classification or regression tasks using specified machine learning models on different feature sets (e.g., latent space, PCA, UMAP, TSNE, RandomFeature) and clinical annotation parameters. It supports multiple evaluation strategies, including pre-defined train/valid/test splits, k-fold cross-validation, and leave-one-out cross-validation. The results are aggregated and stored in the provided `result` object.</span>
<span class="sd">        - Samples with missing annotation values for a given parameter are excluded from the corresponding evaluation.</span>
<span class="sd">        - For &quot;RandomFeature&quot;, five random feature sets are evaluated.</span>
<span class="sd">        - The method appends results to any existing `embedding_evaluation` in the result object.</span>

<span class="sd">        Args:</span>
<span class="sd">            datasets: A DatasetContainer containing train, valid, and test datasets, each with `sample_ids` and `metadata` (either a DataFrame or a dictionary with a &#39;paired&#39; key for clinical annotations).</span>
<span class="sd">            result: An Result object to store the evaluation results. Should have an `embedding_evaluation` attribute which updated (typically a DataFrame).</span>
<span class="sd">            ml_model_class: The scikit-learn classifier to use for classification tasks (default: `sklearn.linear_model.LogisticRegression()`).</span>
<span class="sd">            ml_model_regression: The scikit-learn regressor to use for regression tasks (default: `sklearn.linear_model.LinearRegression()`).</span>
<span class="sd">            params:List of clinical annotation columns to evaluate, or &quot;all&quot; to use all columns (default: &quot;all&quot;).</span>
<span class="sd">            metric_class: Scoring metric for classification tasks (default: &quot;roc_auc_ovo&quot;).</span>
<span class="sd">            metric_regression: Scoring metric for regression tasks (default: &quot;r2&quot;).</span>
<span class="sd">            reference_methods:List of feature representations to evaluate (e.g., &quot;PCA&quot;, &quot;UMAP&quot;, &quot;TSNE&quot;, &quot;RandomFeature&quot;). &quot;Latent&quot; is always included (default: []).</span>
<span class="sd">            split_type: which split to use</span>
<span class="sd">                use-split&quot; for pre-defined splits, &quot;CV-N&quot; for N-fold cross-validation, or &quot;LOOCV&quot; for leave-one-out cross-validation (default: &quot;use-split&quot;).</span>
<span class="sd">        Returns:</span>
<span class="sd">            The updated result object with evaluation results stored in `embedding_evaluation`.</span>
<span class="sd">        Raises</span>
<span class="sd">            ValueError: If required annotation data is missing or improperly formatted, or if an unsupported split type is specified.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">already_warned</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">reference_methods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Latent&quot;</span><span class="p">)</span>

        <span class="c1"># ## TODO when x-modalix is ready, check how to adjust evaluation of both latent spaces</span>
        <span class="c1"># is_modalix = False # TODO Remove and implement individual Evaluators later</span>

        <span class="c1"># if type(result.latentspaces.get(epoch=-1,split=&quot;train&quot;)) == dict:</span>
        <span class="c1">#     # For X-Modalix and others with multiple VAE Latentspaces</span>
        <span class="c1">#     reference_methods = [f&quot;{method}_$_{key}&quot; for method in reference_methods for key in result.latentspaces.get(epoch=-1,split=&quot;train&quot;).keys()]</span>
        <span class="c1">#     is_modalix = True</span>
        <span class="n">reference_methods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_reference_methods</span><span class="p">(</span>
            <span class="n">reference_methods</span><span class="o">=</span><span class="n">reference_methods</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">result</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">reference_methods</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Perform ML task with feature df: </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">clin_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_clin_data</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">split_type</span> <span class="o">==</span> <span class="s2">&quot;use-split&quot;</span><span class="p">:</span>
                <span class="c1"># Pandas dataframe with sample_ids and split information</span>
                <span class="n">sample_split</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;SAMPLE_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;SPLIT&quot;</span><span class="p">])</span>

                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="s2">&quot;paired_sample_ids&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">datasets</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">paired_sample_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">sample_ids</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">paired_sample_ids</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sample_ids</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">sample_ids</span>
                    <span class="n">sample_split_temp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">sample_split</span><span class="p">,</span>
                        <span class="o">**</span><span class="p">{</span>
                            <span class="s2">&quot;SAMPLE_ID&quot;</span><span class="p">:</span> <span class="n">sample_ids</span><span class="p">,</span>
                            <span class="s2">&quot;SPLIT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_ids</span><span class="p">),</span>
                        <span class="p">},</span>
                    <span class="p">)</span>
                    <span class="n">sample_split</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">sample_split</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sample_split_temp</span><span class="p">)],</span>
                        <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;No training data found. Please provide a valid training dataset.&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="s2">&quot;valid&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">valid</span><span class="p">,</span> <span class="s2">&quot;paired_sample_ids&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">datasets</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">paired_sample_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">sample_ids</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">paired_sample_ids</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sample_ids</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">sample_ids</span>
                    <span class="n">sample_split_temp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">sample_split</span><span class="p">,</span>
                        <span class="o">**</span><span class="p">{</span>
                            <span class="s2">&quot;SAMPLE_ID&quot;</span><span class="p">:</span> <span class="n">sample_ids</span><span class="p">,</span>
                            <span class="s2">&quot;SPLIT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;valid&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_ids</span><span class="p">),</span>
                        <span class="p">},</span>
                    <span class="p">)</span>
                    <span class="n">sample_split</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">sample_split</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sample_split_temp</span><span class="p">)],</span>
                        <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="s2">&quot;paired_sample_ids&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">datasets</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">paired_sample_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">sample_ids</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">paired_sample_ids</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sample_ids</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">sample_ids</span>
                    <span class="n">sample_split_temp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">sample_split</span><span class="p">,</span>
                        <span class="o">**</span><span class="p">{</span>
                            <span class="s2">&quot;SAMPLE_ID&quot;</span><span class="p">:</span> <span class="n">sample_ids</span><span class="p">,</span>
                            <span class="s2">&quot;SPLIT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_ids</span><span class="p">),</span>
                        <span class="p">},</span>
                    <span class="p">)</span>
                    <span class="n">sample_split</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">sample_split</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sample_split_temp</span><span class="p">)],</span>
                        <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="n">sample_split</span> <span class="o">=</span> <span class="n">sample_split</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;SAMPLE_ID&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1">## df -&gt; task</span>
            <span class="n">subtask</span> <span class="o">=</span> <span class="p">[</span><span class="n">task</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;RandomFeature&quot;</span> <span class="ow">in</span> <span class="n">task</span><span class="p">:</span>
                <span class="n">subtask</span> <span class="o">=</span> <span class="p">[</span><span class="n">task</span> <span class="o">+</span> <span class="s2">&quot;_R&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">subtask</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
                <span class="c1"># if is_modalix:</span>
                <span class="c1">#     modality = task.split(&quot;_$_&quot;)[1]</span>
                <span class="c1">#     task_xmodal = task.split(&quot;_$_&quot;)[0]</span>

                <span class="c1">#     df = self._load_input_for_ml_xmodal(task_xmodal, datasets, result, modality=modality)</span>
                <span class="c1"># else:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_input_for_ml</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">params</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="n">clin_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">task_param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;Latent&quot;</span> <span class="ow">in</span> <span class="n">task</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Perform ML task for target parameter: </span><span class="si">{</span><span class="n">task_param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="c1">## Check if classification or regression task</span>
                    <span class="n">ml_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ml_type</span><span class="p">(</span><span class="n">clin_data</span><span class="p">,</span> <span class="n">task_param</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">clin_data</span><span class="p">[</span><span class="n">task_param</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">already_warned</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span>
                                <span class="s2">&quot;There are NA values in the annotation file. Samples with missing data will be removed for ML task evaluation.&quot;</span>
                            <span class="p">)</span>
                        <span class="n">already_warned</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="c1"># logger.warning(clin_data.loc[pd.isna(clin_data[task_param]), task_param])</span>

                        <span class="n">samples_nonna</span> <span class="o">=</span> <span class="n">clin_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">clin_data</span><span class="p">[</span><span class="n">task_param</span><span class="p">]),</span> <span class="n">task_param</span>
                        <span class="p">]</span><span class="o">.</span><span class="n">index</span>
                        <span class="c1"># print(df)</span>
                        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">samples_nonna</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="p">:]</span>
                        <span class="k">if</span> <span class="n">split_type</span> <span class="o">==</span> <span class="s2">&quot;use-split&quot;</span><span class="p">:</span>
                            <span class="n">sample_split</span> <span class="o">=</span> <span class="n">sample_split</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                                <span class="n">samples_nonna</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">sample_split</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="p">:</span>
                            <span class="p">]</span>
                        <span class="c1"># print(sample_split)</span>

                    <span class="k">if</span> <span class="n">ml_type</span> <span class="o">==</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span>
                        <span class="n">metric</span> <span class="o">=</span> <span class="n">metric_class</span>
                        <span class="n">sklearn_ml</span> <span class="o">=</span> <span class="n">ml_model_class</span>

                    <span class="k">if</span> <span class="n">ml_type</span> <span class="o">==</span> <span class="s2">&quot;regression&quot;</span><span class="p">:</span>
                        <span class="n">metric</span> <span class="o">=</span> <span class="n">metric_regression</span>
                        <span class="n">sklearn_ml</span> <span class="o">=</span> <span class="n">ml_model_regression</span>

                    <span class="k">if</span> <span class="n">split_type</span> <span class="o">==</span> <span class="s2">&quot;use-split&quot;</span><span class="p">:</span>
                        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_ml_presplit</span><span class="p">(</span>
                            <span class="n">sample_split</span><span class="o">=</span><span class="n">sample_split</span><span class="p">,</span>
                            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
                            <span class="n">clin_data</span><span class="o">=</span><span class="n">clin_data</span><span class="p">,</span>
                            <span class="n">task_param</span><span class="o">=</span><span class="n">task_param</span><span class="p">,</span>
                            <span class="n">sklearn_ml</span><span class="o">=</span><span class="n">sklearn_ml</span><span class="p">,</span>
                            <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
                            <span class="n">ml_type</span><span class="o">=</span><span class="n">ml_type</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">split_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;CV-&quot;</span><span class="p">):</span>
                        <span class="n">cv_folds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

                        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_ml</span><span class="p">(</span>
                            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
                            <span class="n">clin_data</span><span class="o">=</span><span class="n">clin_data</span><span class="p">,</span>
                            <span class="n">task_param</span><span class="o">=</span><span class="n">task_param</span><span class="p">,</span>
                            <span class="n">sklearn_ml</span><span class="o">=</span><span class="n">sklearn_ml</span><span class="p">,</span>
                            <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
                            <span class="n">cv_folds</span><span class="o">=</span><span class="n">cv_folds</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">split_type</span> <span class="o">==</span> <span class="s2">&quot;LOOCV&quot;</span><span class="p">:</span>
                        <span class="c1"># Leave One Out Cross Validation</span>
                        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_ml</span><span class="p">(</span>
                            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
                            <span class="n">clin_data</span><span class="o">=</span><span class="n">clin_data</span><span class="p">,</span>
                            <span class="n">task_param</span><span class="o">=</span><span class="n">task_param</span><span class="p">,</span>
                            <span class="n">sklearn_ml</span><span class="o">=</span><span class="n">sklearn_ml</span><span class="p">,</span>
                            <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
                            <span class="n">cv_folds</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Your split type </span><span class="si">{</span><span class="n">split_type</span><span class="si">}</span><span class="s2"> is not supported. Please use &#39;use-split&#39;, &#39;CV-5&#39;, &#39;LOOCV&#39; or &#39;CV-N&#39;.&quot;</span>
                        <span class="p">)</span>
                    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enrich_results</span><span class="p">(</span>
                        <span class="n">results</span><span class="o">=</span><span class="n">results</span><span class="p">,</span>
                        <span class="n">sklearn_ml</span><span class="o">=</span><span class="n">sklearn_ml</span><span class="p">,</span>
                        <span class="n">ml_type</span><span class="o">=</span><span class="n">ml_type</span><span class="p">,</span>
                        <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
                        <span class="n">sub</span><span class="o">=</span><span class="n">sub</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_results</span><span class="p">,</span> <span class="n">results</span><span class="p">])</span>

        <span class="c1">## Check if embedding_evaluation is empty</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;embedding_evaluation&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">embedding_evaluation</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">embedding_evaluation</span> <span class="o">=</span> <span class="n">df_results</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># merge with existing results</span>
            <span class="n">result</span><span class="o">.</span><span class="n">embedding_evaluation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">embedding_evaluation</span><span class="p">,</span> <span class="n">df_results</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_single_ml</span><span class="p">(</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">clin_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">task_param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">sklearn_ml</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ClassifierMixin</span><span class="p">,</span> <span class="n">RegressorMixin</span><span class="p">],</span>
        <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cv_folds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function learns on the given data frame df and label data the provided sklearn model.</span>

<span class="sd">        Cross validation is performed according to the config and scores are returned as output as specified by metrics</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Dataframe with input data</span>
<span class="sd">            clin_data: Dataframe with label data</span>
<span class="sd">            task_param: Column name with label data</span>
<span class="sd">            sklearn_ml: Sklearn ML module specifying the ML algorithm</span>
<span class="sd">            metric: string specifying the metric to be calculated by cross validation</span>
<span class="sd">            cv_folds:</span>
<span class="sd">        Returns:</span>
<span class="sd">            score_df: data frame containing metrics (scores) for all CV runs (long format)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># X -&gt; df</span>
        <span class="c1"># Y -&gt; task_param</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="n">clin_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">task_param</span><span class="p">]</span>
        <span class="n">score_df</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1">## Cross Validation</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># ty: ignore</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
                <span class="n">sklearn_ml</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv_folds</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

            <span class="c1"># Output</span>

            <span class="c1"># Output Format</span>
            <span class="c1"># CV_RUN | SCORE_SPLIT | TASK_PARAM | METRIC | VALUE</span>

            <span class="n">score_df</span><span class="p">[</span><span class="s2">&quot;cv_run&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">score_df</span><span class="p">[</span><span class="s2">&quot;score_split&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">score_df</span><span class="p">[</span><span class="s2">&quot;CLINIC_PARAM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">score_df</span><span class="p">[</span><span class="s2">&quot;metric&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">score_df</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

            <span class="n">cv_runs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CV_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cv_folds</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">task_param_cv</span> <span class="o">=</span> <span class="p">[</span><span class="n">task_param</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cv_folds</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>

            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;test&quot;</span> <span class="ow">or</span> <span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;train&quot;</span><span class="p">:</span>
                    <span class="n">split_cv</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cv_folds</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
                    <span class="n">metric_cv</span> <span class="o">=</span> <span class="p">[</span><span class="n">metric</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cv_folds</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>

                    <span class="n">score_df</span><span class="p">[</span><span class="s2">&quot;cv_run&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cv_runs</span><span class="p">)</span>
                    <span class="n">score_df</span><span class="p">[</span><span class="s2">&quot;score_split&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">split_cv</span><span class="p">)</span>
                    <span class="n">score_df</span><span class="p">[</span><span class="s2">&quot;CLINIC_PARAM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">task_param_cv</span><span class="p">)</span>
                    <span class="n">score_df</span><span class="p">[</span><span class="s2">&quot;metric&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">metric_cv</span><span class="p">)</span>
                    <span class="n">score_df</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">score_df</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_clin_data</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves the clinical annotation DataFrame (clin_data) from the provided datasets.</span>

<span class="sd">        Handles both standard and XModalix dataset structures.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
            <span class="c1"># Check if metadata is a dictionary and contains &#39;paired&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">if</span> <span class="s2">&quot;paired&quot;</span> <span class="ow">in</span> <span class="n">datasets</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
                    <span class="n">clin_data</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;paired&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">):</span>
                        <span class="n">clin_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">clin_data</span><span class="p">,</span> <span class="n">datasets</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;paired&quot;</span><span class="p">]],</span>
                            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="s2">&quot;valid&quot;</span><span class="p">):</span>
                        <span class="n">clin_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">clin_data</span><span class="p">,</span> <span class="n">datasets</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;paired&quot;</span><span class="p">]],</span>
                            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Iterate over all splits and keys, concatenate if DataFrame</span>
                    <span class="n">clin_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">split_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;valid&quot;</span><span class="p">]:</span>
                        <span class="n">split_temp</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">split_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">split_temp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">split_temp</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">split_temp</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">split_temp</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                                    <span class="n">clin_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                                        <span class="p">[</span>
                                            <span class="n">clin_data</span><span class="p">,</span>
                                            <span class="n">split_temp</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                                        <span class="p">],</span>
                                        <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="p">)</span>
                    <span class="c1"># remove duplicate rows</span>
                    <span class="n">clin_data</span> <span class="o">=</span> <span class="n">clin_data</span><span class="p">[</span><span class="o">~</span><span class="n">clin_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)]</span>
                    <span class="c1"># Raise error no annotation given</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Please provide paired annotation data with key &#39;paired&#39; in metadata dictionary.&quot;</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                <span class="n">clin_data</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">metadata</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">):</span>
                    <span class="n">clin_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">clin_data</span><span class="p">,</span> <span class="n">datasets</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">metadata</span><span class="p">],</span>
                        <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="s2">&quot;valid&quot;</span><span class="p">):</span>
                    <span class="n">clin_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">clin_data</span><span class="p">,</span> <span class="n">datasets</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">metadata</span><span class="p">],</span>
                        <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Raise error no annotation given</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Metadata is not a dictionary or DataFrame. Please provide a valid annotation data type.&quot;</span>
                <span class="p">)</span>
        <span class="c1"># elif hasattr(datasets.train, &quot;datasets&quot;):</span>
        <span class="c1">#     # XModalix-Case</span>
        <span class="c1">#     clin_data = pd.DataFrame()</span>
        <span class="c1">#     splits = [</span>
        <span class="c1">#         datasets.train, datasets.valid, datasets.test</span>
        <span class="c1">#     ]</span>

        <span class="c1">#     for s in splits:</span>
        <span class="c1">#         for k in s.datasets.keys():</span>
        <span class="c1">#             print(f&quot;Processing dataset: {k}&quot;)</span>
        <span class="c1">#             # Merge metadata by overlapping columns</span>
        <span class="c1">#             overlap = clin_data.columns.intersection(s.datasets[k].metadata.columns)</span>
        <span class="c1">#             if overlap.empty:</span>
        <span class="c1">#                 overlap = s.datasets[k].metadata.columns</span>
        <span class="c1">#             clin_data = pd.concat([clin_data, s.datasets[k].metadata[overlap]], axis=0)</span>

        <span class="c1">#     # Remove duplicate rows</span>
        <span class="c1">#     clin_data = clin_data[~clin_data.index.duplicated(keep=&#39;first&#39;)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Iterate over all splits and keys, concatenate if DataFrame</span>
            <span class="n">clin_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">split_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;valid&quot;</span><span class="p">]:</span>
                <span class="n">split_temp</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">split_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">split_temp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">split_temp</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">split_temp</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                            <span class="n">clin_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                                <span class="p">[</span>
                                    <span class="n">clin_data</span><span class="p">,</span>
                                    <span class="n">split_temp</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
                                <span class="p">],</span>
                                <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                            <span class="p">)</span>
            <span class="c1"># remove duplicate rows</span>
            <span class="n">clin_data</span> <span class="o">=</span> <span class="n">clin_data</span><span class="p">[</span><span class="o">~</span><span class="n">clin_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)]</span>
        <span class="c1"># Raise error no annotation given</span>
        <span class="c1"># raise ValueError(</span>
        <span class="c1">#     &quot;No annotation data found. Please provide a valid annotation data type.&quot;</span>
        <span class="c1"># )</span>
        <span class="k">return</span> <span class="n">clin_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_enrich_results</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">results</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">sklearn_ml</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ClassifierMixin</span><span class="p">,</span> <span class="n">RegressorMixin</span><span class="p">],</span>
        <span class="n">ml_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">task</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">sub</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">res_ml_alg</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">sklearn_ml</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">res_ml_type</span> <span class="o">=</span> <span class="p">[</span><span class="n">ml_type</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">res_ml_task</span> <span class="o">=</span> <span class="p">[</span><span class="n">task</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">res_ml_subtask</span> <span class="o">=</span> <span class="p">[</span><span class="n">sub</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>

        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ML_ALG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_ml_alg</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ML_TYPE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_ml_type</span>
        <span class="c1"># if is_modalix:</span>
        <span class="c1">#     results[&quot;MODALITY&quot;] = [modality for x in range(0, results.shape[0])]</span>
        <span class="c1">#     results[&quot;ML_TASK&quot;] = [task_xmodal for x in range(0, results.shape[0])]</span>
        <span class="c1"># else:</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ML_TASK&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_ml_task</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ML_SUBTASK&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_ml_subtask</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_single_ml_presplit</span><span class="p">(</span>
        <span class="n">sample_split</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">clin_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">task_param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">sklearn_ml</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ClassifierMixin</span><span class="p">,</span> <span class="n">RegressorMixin</span><span class="p">],</span>
        <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ml_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Trains the provided sklearn model on the training split and evaluates it on train, valid, and test splits using the specified metric.</span>

<span class="sd">        Args:</span>
<span class="sd">            sample_split: DataFrame with sample IDs and their corresponding split (&quot;train&quot;, &quot;valid&quot;, &quot;test&quot;).</span>
<span class="sd">            df: DataFrame with input features, indexed by sample IDs.</span>
<span class="sd">            clin_data: DataFrame with label/annotation data, indexed by sample IDs.</span>
<span class="sd">            task_param: Column name in clin_data specifying the target variable.</span>
<span class="sd">            sklearn_ml: Instantiated sklearn model to use for training and evaluation.</span>
<span class="sd">            metric: Scoring metric compatible with sklearn&#39;s get_scorer.</span>
<span class="sd">            ml_type: Type of machine learning task (&quot;classification&quot; or &quot;regression&quot;).</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame containing evaluation scores for each split (train, valid, test) and the specified metric.</span>

<span class="sd">        Raises</span>
<span class="sd">            ValueError: If the provided metric is not supported by sklearn.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">split_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="s2">&quot;valid&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">]</span>

        <span class="n">score_df</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">score_df</span><span class="p">[</span><span class="s2">&quot;score_split&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">score_df</span><span class="p">[</span><span class="s2">&quot;CLINIC_PARAM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">score_df</span><span class="p">[</span><span class="s2">&quot;metric&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">score_df</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="n">X_train</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">sample_split</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sample_split</span><span class="o">.</span><span class="n">SPLIT</span> <span class="o">==</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="s2">&quot;SAMPLE_ID&quot;</span><span class="p">],</span> <span class="p">:</span>
        <span class="p">]</span>
        <span class="n">train_samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">X_train</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">Y_train</span> <span class="o">=</span> <span class="n">clin_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train_samples</span><span class="p">,</span> <span class="n">task_param</span><span class="p">]</span>
        <span class="c1"># train model once on training data</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y_train</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># ty: ignore</span>
            <span class="n">sklearn_ml</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>  <span class="c1"># ty: ignore</span>

            <span class="c1"># eval on all splits</span>
            <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">split_list</span><span class="p">:</span>
                <span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="n">sample_split</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sample_split</span><span class="o">.</span><span class="n">SPLIT</span> <span class="o">==</span> <span class="n">split</span><span class="p">,</span> <span class="s2">&quot;SAMPLE_ID&quot;</span><span class="p">],</span> <span class="p">:</span>
                <span class="p">]</span>
                <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                <span class="n">Y</span> <span class="o">=</span> <span class="n">clin_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">samples</span><span class="p">,</span> <span class="n">task_param</span><span class="p">]</span>

                <span class="c1"># Performace on train, valid and test data split</span>

                <span class="n">score_df</span><span class="p">[</span><span class="s2">&quot;score_split&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">split</span><span class="p">)</span>
                <span class="n">score_df</span><span class="p">[</span><span class="s2">&quot;CLINIC_PARAM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_param</span><span class="p">)</span>
                <span class="n">score_df</span><span class="p">[</span><span class="s2">&quot;metric&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span>
                <span class="n">sklearn_scorer</span> <span class="o">=</span> <span class="n">get_scorer</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">sklearn_scorer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Your metric </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> is not supported by sklearn. Please use a valid metric.&quot;</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="n">ml_type</span> <span class="o">==</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span>
                    <span class="c1"># Check that Y has only classes which are present in Y_train</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span>
                            <span class="nb">set</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span>  <span class="c1"># ty: ignore</span>
                                <span class="nb">set</span><span class="p">(</span><span class="n">Y_train</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>  <span class="c1"># ty: ignore</span>
                            <span class="p">)</span>  <span class="c1"># ty: ignore</span>
                        <span class="p">)</span>  <span class="c1"># ty: ignore</span>
                        <span class="o">&gt;</span> <span class="mi">0</span>  <span class="c1"># ty: ignore</span>
                    <span class="p">):</span>  <span class="c1"># ty: ignore</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Classes in split </span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2"> are not present in training data&quot;</span>
                        <span class="p">)</span>
                        <span class="c1"># Adjust Y to only contain classes present in Y_train</span>
                        <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">Y</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">Y_train</span><span class="o">.</span><span class="n">unique</span><span class="p">())]</span>  <span class="c1"># ty: ignore</span>
                        <span class="c1"># Adjust X as well</span>
                        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Y</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span>

                <span class="n">score_temp</span> <span class="o">=</span> <span class="n">sklearn_scorer</span><span class="p">(</span><span class="n">sklearn_ml</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
                <span class="n">score_df</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score_temp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">## Warning that there is only one class in the training data</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Warning: There is only one class in the training data for task parameter </span><span class="si">{</span><span class="n">task_param</span><span class="si">}</span><span class="s2">. Skipping evaluation for this task.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">score_df</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_ml_type</span><span class="p">(</span><span class="n">clin_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">task_param</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determines the machine learning task type (classification or regression) based on the data type of a specified column in clinical data.</span>

<span class="sd">        Args:</span>
<span class="sd">            clin_data: The clinical data as a pandas DataFrame.</span>
<span class="sd">            task_param: The column name in clin_data to inspect for determining the task type.</span>

<span class="sd">        Returns:</span>
<span class="sd">            &quot;classification&quot; if the first value in the specified column is a string, otherwise &quot;regression&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">## Auto-Detection</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">clin_data</span><span class="p">[</span><span class="n">task_param</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">ml_type</span> <span class="o">=</span> <span class="s2">&quot;classification&quot;</span>
        <span class="k">elif</span> <span class="n">clin_data</span><span class="p">[</span><span class="n">task_param</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">ml_type</span> <span class="o">=</span> <span class="s2">&quot;classification&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ml_type</span> <span class="o">=</span> <span class="s2">&quot;regression&quot;</span>

        <span class="k">return</span> <span class="n">ml_type</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_load_input_for_ml</span><span class="p">(</span>
        <span class="n">task</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">DatasetContainer</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">Result</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads and processes input data for various machine learning tasks based on the specified task type.</span>


<span class="sd">        Task Details:</span>
<span class="sd">            - &quot;Latent&quot;: Concatenates latent representations from train, validation, and test splits at the final epoch.</span>
<span class="sd">            - &quot;UMAP&quot;: Applies UMAP dimensionality reduction to the concatenated dataset splits.</span>
<span class="sd">            - &quot;PCA&quot;: Applies PCA dimensionality reduction to the concatenated dataset splits.</span>
<span class="sd">            - &quot;TSNE&quot;: Applies t-SNE dimensionality reduction to the concatenated dataset splits.</span>
<span class="sd">            - &quot;RandomFeature&quot;: Randomly samples columns (features) from the concatenated dataset splits.</span>

<span class="sd">        Args:</span>
<span class="sd">            task: The type of ML task. Supported values are &quot;Latent&quot;, &quot;UMAP&quot;, &quot;PCA&quot;, &quot;TSNE&quot;, and &quot;RandomFeature&quot;.</span>
<span class="sd">            dataset: The dataset container object holding train, validation, and test splits.</span>
<span class="sd">            result: The result object containing model configuration and methods to retrieve latent representations.</span>
<span class="sd">        Returns:</span>
<span class="sd">            A DataFrame containing the processed input data suitable for the specified ML task.</span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the provided task is not supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">final_epoch</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">epochs</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">task</span> <span class="o">==</span> <span class="s2">&quot;Latent&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">get_latent_df</span><span class="p">(</span><span class="n">epoch</span><span class="o">=</span><span class="n">final_epoch</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">),</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">get_latent_df</span><span class="p">(</span><span class="n">epoch</span><span class="o">=</span><span class="n">final_epoch</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">),</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">get_latent_df</span><span class="p">(</span><span class="n">epoch</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">task</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;UMAP&quot;</span><span class="p">,</span> <span class="s2">&quot;PCA&quot;</span><span class="p">,</span> <span class="s2">&quot;TSNE&quot;</span><span class="p">,</span> <span class="s2">&quot;RandomFeature&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">dataset</span><span class="o">.</span><span class="n">train</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;train attribute of dataset cannot be None&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dataset</span><span class="o">.</span><span class="n">valid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;valid attribute of dataset cannot be None&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dataset</span><span class="o">.</span><span class="n">test</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;test attribute of dataset cannot be None&quot;</span><span class="p">)</span>

            <span class="n">df_processed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">dataset</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">_to_df</span><span class="p">(),</span>
                    <span class="n">dataset</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">_to_df</span><span class="p">(),</span>
                    <span class="n">dataset</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">_to_df</span><span class="p">(),</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">task</span> <span class="o">==</span> <span class="s2">&quot;UMAP&quot;</span><span class="p">:</span>
                <span class="n">reducer</span> <span class="o">=</span> <span class="n">UMAP</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">latent_dim</span><span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">reducer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_processed</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">df_processed</span><span class="o">.</span><span class="n">index</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">task</span> <span class="o">==</span> <span class="s2">&quot;PCA&quot;</span><span class="p">:</span>
                <span class="n">reducer</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">latent_dim</span><span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">reducer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_processed</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">df_processed</span><span class="o">.</span><span class="n">index</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">task</span> <span class="o">==</span> <span class="s2">&quot;TSNE&quot;</span><span class="p">:</span>
                <span class="n">reducer</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">latent_dim</span><span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">reducer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_processed</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">df_processed</span><span class="o">.</span><span class="n">index</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">task</span> <span class="o">==</span> <span class="s2">&quot;RandomFeature&quot;</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df_processed</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">latent_dim</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Your ML task </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2"> is not supported. Please use Latent, UMAP, PCA or RandomFeature.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="autoencodix.evaluate.GeneralEvaluator.evaluate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">evaluate</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">ml_model_class</span><span class="o">=</span><span class="n">linear_model</span><span class="o">.</span><span class="n">LogisticRegression</span><span class="p">(),</span> <span class="n">ml_model_regression</span><span class="o">=</span><span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">(),</span> <span class="n">params</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">metric_class</span><span class="o">=</span><span class="s1">&#39;roc_auc_ovo&#39;</span><span class="p">,</span> <span class="n">metric_regression</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">reference_methods</span><span class="o">=</span><span class="p">[],</span> <span class="n">split_type</span><span class="o">=</span><span class="s1">&#39;use-split&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Evaluates the performance of machine learning models on various feature representations and clinical parameters.</p>
<p>This method performs classification or regression tasks using specified machine learning models on different feature sets (e.g., latent space, PCA, UMAP, TSNE, RandomFeature) and clinical annotation parameters. It supports multiple evaluation strategies, including pre-defined train/valid/test splits, k-fold cross-validation, and leave-one-out cross-validation. The results are aggregated and stored in the provided <code>result</code> object.
- Samples with missing annotation values for a given parameter are excluded from the corresponding evaluation.
- For "RandomFeature", five random feature sets are evaluated.
- The method appends results to any existing <code>embedding_evaluation</code> in the result object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>datasets</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatasetContainer


  
      dataclass
   (autoencodix.data._datasetcontainer.DatasetContainer)" href="../data/#autoencodix.data.DatasetContainer">DatasetContainer</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A DatasetContainer containing train, valid, and test datasets, each with <code>sample_ids</code> and <code>metadata</code> (either a DataFrame or a dictionary with a 'paired' key for clinical annotations).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Result


  
      dataclass
   (autoencodix.utils._result.Result)" href="../utils/#autoencodix.utils.Result">Result</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An Result object to store the evaluation results. Should have an <code>embedding_evaluation</code> attribute which updated (typically a DataFrame).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ml_model_class</code>
            </td>
            <td>
                  <code><span title="sklearn.base.ClassifierMixin">ClassifierMixin</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The scikit-learn classifier to use for classification tasks (default: <code>sklearn.linear_model.LogisticRegression()</code>).</p>
              </div>
            </td>
            <td>
                  <code><span title="sklearn.linear_model.LogisticRegression">LogisticRegression</span>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ml_model_regression</code>
            </td>
            <td>
                  <code><span title="sklearn.base.RegressorMixin">RegressorMixin</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The scikit-learn regressor to use for regression tasks (default: <code>sklearn.linear_model.LinearRegression()</code>).</p>
              </div>
            </td>
            <td>
                  <code><span title="sklearn.linear_model.LinearRegression">LinearRegression</span>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="list">list</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of clinical annotation columns to evaluate, or "all" to use all columns (default: "all").</p>
              </div>
            </td>
            <td>
                  <code>&#39;all&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metric_class</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scoring metric for classification tasks (default: "roc_auc_ovo").</p>
              </div>
            </td>
            <td>
                  <code>&#39;roc_auc_ovo&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metric_regression</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scoring metric for regression tasks (default: "r2").</p>
              </div>
            </td>
            <td>
                  <code>&#39;r2&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reference_methods</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of feature representations to evaluate (e.g., "PCA", "UMAP", "TSNE", "RandomFeature"). "Latent" is always included (default: []).</p>
              </div>
            </td>
            <td>
                  <code>[]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>split_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>which split to use
use-split" for pre-defined splits, "CV-N" for N-fold cross-validation, or "LOOCV" for leave-one-out cross-validation (default: "use-split").</p>
              </div>
            </td>
            <td>
                  <code>&#39;use-split&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    The updated result object with evaluation results stored in <code>embedding_evaluation</code>.
Raises
    ValueError: If required annotation data is missing or improperly formatted, or if an unsupported split type is specified.</p>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/evaluate/_general_evaluator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@no_type_check</span>
<span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">datasets</span><span class="p">:</span> <span class="n">DatasetContainer</span><span class="p">,</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">Result</span><span class="p">,</span>
    <span class="n">ml_model_class</span><span class="p">:</span> <span class="n">ClassifierMixin</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LogisticRegression</span><span class="p">(),</span>  <span class="c1"># Default is sklearn LogisticRegression</span>
    <span class="n">ml_model_regression</span><span class="p">:</span> <span class="n">RegressorMixin</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">(),</span>  <span class="c1"># Default is sklearn LinearRegression</span>
    <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="nb">list</span><span class="p">,</span> <span class="nb">str</span>
    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>  <span class="c1"># No default? ... or all params in annotation?</span>
    <span class="n">metric_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;roc_auc_ovo&quot;</span><span class="p">,</span>  <span class="c1"># Default is &#39;roc_auc_ovo&#39; via https://scikit-learn.org/stable/modules/model_evaluation.html#scoring-string-names</span>
    <span class="n">metric_regression</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;r2&quot;</span><span class="p">,</span>  <span class="c1"># Default is &#39;r2&#39;</span>
    <span class="n">reference_methods</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>  <span class="c1"># Default [], Options are &quot;PCA&quot;, &quot;UMAP&quot;, &quot;TSNE&quot;, &quot;RandomFeature&quot;</span>
    <span class="n">split_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;use-split&quot;</span><span class="p">,</span>  <span class="c1"># Default is &quot;use-split&quot;, other options: &quot;CV-5&quot;, ... &quot;LOOCV&quot;?</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluates the performance of machine learning models on various feature representations and clinical parameters.</span>

<span class="sd">    This method performs classification or regression tasks using specified machine learning models on different feature sets (e.g., latent space, PCA, UMAP, TSNE, RandomFeature) and clinical annotation parameters. It supports multiple evaluation strategies, including pre-defined train/valid/test splits, k-fold cross-validation, and leave-one-out cross-validation. The results are aggregated and stored in the provided `result` object.</span>
<span class="sd">    - Samples with missing annotation values for a given parameter are excluded from the corresponding evaluation.</span>
<span class="sd">    - For &quot;RandomFeature&quot;, five random feature sets are evaluated.</span>
<span class="sd">    - The method appends results to any existing `embedding_evaluation` in the result object.</span>

<span class="sd">    Args:</span>
<span class="sd">        datasets: A DatasetContainer containing train, valid, and test datasets, each with `sample_ids` and `metadata` (either a DataFrame or a dictionary with a &#39;paired&#39; key for clinical annotations).</span>
<span class="sd">        result: An Result object to store the evaluation results. Should have an `embedding_evaluation` attribute which updated (typically a DataFrame).</span>
<span class="sd">        ml_model_class: The scikit-learn classifier to use for classification tasks (default: `sklearn.linear_model.LogisticRegression()`).</span>
<span class="sd">        ml_model_regression: The scikit-learn regressor to use for regression tasks (default: `sklearn.linear_model.LinearRegression()`).</span>
<span class="sd">        params:List of clinical annotation columns to evaluate, or &quot;all&quot; to use all columns (default: &quot;all&quot;).</span>
<span class="sd">        metric_class: Scoring metric for classification tasks (default: &quot;roc_auc_ovo&quot;).</span>
<span class="sd">        metric_regression: Scoring metric for regression tasks (default: &quot;r2&quot;).</span>
<span class="sd">        reference_methods:List of feature representations to evaluate (e.g., &quot;PCA&quot;, &quot;UMAP&quot;, &quot;TSNE&quot;, &quot;RandomFeature&quot;). &quot;Latent&quot; is always included (default: []).</span>
<span class="sd">        split_type: which split to use</span>
<span class="sd">            use-split&quot; for pre-defined splits, &quot;CV-N&quot; for N-fold cross-validation, or &quot;LOOCV&quot; for leave-one-out cross-validation (default: &quot;use-split&quot;).</span>
<span class="sd">    Returns:</span>
<span class="sd">        The updated result object with evaluation results stored in `embedding_evaluation`.</span>
<span class="sd">    Raises</span>
<span class="sd">        ValueError: If required annotation data is missing or improperly formatted, or if an unsupported split type is specified.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">already_warned</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="n">reference_methods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Latent&quot;</span><span class="p">)</span>

    <span class="c1"># ## TODO when x-modalix is ready, check how to adjust evaluation of both latent spaces</span>
    <span class="c1"># is_modalix = False # TODO Remove and implement individual Evaluators later</span>

    <span class="c1"># if type(result.latentspaces.get(epoch=-1,split=&quot;train&quot;)) == dict:</span>
    <span class="c1">#     # For X-Modalix and others with multiple VAE Latentspaces</span>
    <span class="c1">#     reference_methods = [f&quot;{method}_$_{key}&quot; for method in reference_methods for key in result.latentspaces.get(epoch=-1,split=&quot;train&quot;).keys()]</span>
    <span class="c1">#     is_modalix = True</span>
    <span class="n">reference_methods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_reference_methods</span><span class="p">(</span>
        <span class="n">reference_methods</span><span class="o">=</span><span class="n">reference_methods</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">result</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">reference_methods</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Perform ML task with feature df: </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">clin_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_clin_data</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">split_type</span> <span class="o">==</span> <span class="s2">&quot;use-split&quot;</span><span class="p">:</span>
            <span class="c1"># Pandas dataframe with sample_ids and split information</span>
            <span class="n">sample_split</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;SAMPLE_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;SPLIT&quot;</span><span class="p">])</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="s2">&quot;paired_sample_ids&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">datasets</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">paired_sample_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">sample_ids</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">paired_sample_ids</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sample_ids</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">sample_ids</span>
                <span class="n">sample_split_temp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">sample_split</span><span class="p">,</span>
                    <span class="o">**</span><span class="p">{</span>
                        <span class="s2">&quot;SAMPLE_ID&quot;</span><span class="p">:</span> <span class="n">sample_ids</span><span class="p">,</span>
                        <span class="s2">&quot;SPLIT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_ids</span><span class="p">),</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="n">sample_split</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">sample_split</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sample_split_temp</span><span class="p">)],</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;No training data found. Please provide a valid training dataset.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="s2">&quot;valid&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">valid</span><span class="p">,</span> <span class="s2">&quot;paired_sample_ids&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">datasets</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">paired_sample_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">sample_ids</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">paired_sample_ids</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sample_ids</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">sample_ids</span>
                <span class="n">sample_split_temp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">sample_split</span><span class="p">,</span>
                    <span class="o">**</span><span class="p">{</span>
                        <span class="s2">&quot;SAMPLE_ID&quot;</span><span class="p">:</span> <span class="n">sample_ids</span><span class="p">,</span>
                        <span class="s2">&quot;SPLIT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;valid&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_ids</span><span class="p">),</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="n">sample_split</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">sample_split</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sample_split_temp</span><span class="p">)],</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="s2">&quot;paired_sample_ids&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">datasets</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">paired_sample_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">sample_ids</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">paired_sample_ids</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sample_ids</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">sample_ids</span>
                <span class="n">sample_split_temp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">sample_split</span><span class="p">,</span>
                    <span class="o">**</span><span class="p">{</span>
                        <span class="s2">&quot;SAMPLE_ID&quot;</span><span class="p">:</span> <span class="n">sample_ids</span><span class="p">,</span>
                        <span class="s2">&quot;SPLIT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_ids</span><span class="p">),</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="n">sample_split</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">sample_split</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sample_split_temp</span><span class="p">)],</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">sample_split</span> <span class="o">=</span> <span class="n">sample_split</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;SAMPLE_ID&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1">## df -&gt; task</span>
        <span class="n">subtask</span> <span class="o">=</span> <span class="p">[</span><span class="n">task</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;RandomFeature&quot;</span> <span class="ow">in</span> <span class="n">task</span><span class="p">:</span>
            <span class="n">subtask</span> <span class="o">=</span> <span class="p">[</span><span class="n">task</span> <span class="o">+</span> <span class="s2">&quot;_R&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">subtask</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
            <span class="c1"># if is_modalix:</span>
            <span class="c1">#     modality = task.split(&quot;_$_&quot;)[1]</span>
            <span class="c1">#     task_xmodal = task.split(&quot;_$_&quot;)[0]</span>

            <span class="c1">#     df = self._load_input_for_ml_xmodal(task_xmodal, datasets, result, modality=modality)</span>
            <span class="c1"># else:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_input_for_ml</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">params</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="n">clin_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">task_param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;Latent&quot;</span> <span class="ow">in</span> <span class="n">task</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Perform ML task for target parameter: </span><span class="si">{</span><span class="n">task_param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1">## Check if classification or regression task</span>
                <span class="n">ml_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ml_type</span><span class="p">(</span><span class="n">clin_data</span><span class="p">,</span> <span class="n">task_param</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">clin_data</span><span class="p">[</span><span class="n">task_param</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">already_warned</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="s2">&quot;There are NA values in the annotation file. Samples with missing data will be removed for ML task evaluation.&quot;</span>
                        <span class="p">)</span>
                    <span class="n">already_warned</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="c1"># logger.warning(clin_data.loc[pd.isna(clin_data[task_param]), task_param])</span>

                    <span class="n">samples_nonna</span> <span class="o">=</span> <span class="n">clin_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">clin_data</span><span class="p">[</span><span class="n">task_param</span><span class="p">]),</span> <span class="n">task_param</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">index</span>
                    <span class="c1"># print(df)</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">samples_nonna</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="p">:]</span>
                    <span class="k">if</span> <span class="n">split_type</span> <span class="o">==</span> <span class="s2">&quot;use-split&quot;</span><span class="p">:</span>
                        <span class="n">sample_split</span> <span class="o">=</span> <span class="n">sample_split</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="n">samples_nonna</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">sample_split</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="p">:</span>
                        <span class="p">]</span>
                    <span class="c1"># print(sample_split)</span>

                <span class="k">if</span> <span class="n">ml_type</span> <span class="o">==</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span>
                    <span class="n">metric</span> <span class="o">=</span> <span class="n">metric_class</span>
                    <span class="n">sklearn_ml</span> <span class="o">=</span> <span class="n">ml_model_class</span>

                <span class="k">if</span> <span class="n">ml_type</span> <span class="o">==</span> <span class="s2">&quot;regression&quot;</span><span class="p">:</span>
                    <span class="n">metric</span> <span class="o">=</span> <span class="n">metric_regression</span>
                    <span class="n">sklearn_ml</span> <span class="o">=</span> <span class="n">ml_model_regression</span>

                <span class="k">if</span> <span class="n">split_type</span> <span class="o">==</span> <span class="s2">&quot;use-split&quot;</span><span class="p">:</span>
                    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_ml_presplit</span><span class="p">(</span>
                        <span class="n">sample_split</span><span class="o">=</span><span class="n">sample_split</span><span class="p">,</span>
                        <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
                        <span class="n">clin_data</span><span class="o">=</span><span class="n">clin_data</span><span class="p">,</span>
                        <span class="n">task_param</span><span class="o">=</span><span class="n">task_param</span><span class="p">,</span>
                        <span class="n">sklearn_ml</span><span class="o">=</span><span class="n">sklearn_ml</span><span class="p">,</span>
                        <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
                        <span class="n">ml_type</span><span class="o">=</span><span class="n">ml_type</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">split_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;CV-&quot;</span><span class="p">):</span>
                    <span class="n">cv_folds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

                    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_ml</span><span class="p">(</span>
                        <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
                        <span class="n">clin_data</span><span class="o">=</span><span class="n">clin_data</span><span class="p">,</span>
                        <span class="n">task_param</span><span class="o">=</span><span class="n">task_param</span><span class="p">,</span>
                        <span class="n">sklearn_ml</span><span class="o">=</span><span class="n">sklearn_ml</span><span class="p">,</span>
                        <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
                        <span class="n">cv_folds</span><span class="o">=</span><span class="n">cv_folds</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">split_type</span> <span class="o">==</span> <span class="s2">&quot;LOOCV&quot;</span><span class="p">:</span>
                    <span class="c1"># Leave One Out Cross Validation</span>
                    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_ml</span><span class="p">(</span>
                        <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
                        <span class="n">clin_data</span><span class="o">=</span><span class="n">clin_data</span><span class="p">,</span>
                        <span class="n">task_param</span><span class="o">=</span><span class="n">task_param</span><span class="p">,</span>
                        <span class="n">sklearn_ml</span><span class="o">=</span><span class="n">sklearn_ml</span><span class="p">,</span>
                        <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
                        <span class="n">cv_folds</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Your split type </span><span class="si">{</span><span class="n">split_type</span><span class="si">}</span><span class="s2"> is not supported. Please use &#39;use-split&#39;, &#39;CV-5&#39;, &#39;LOOCV&#39; or &#39;CV-N&#39;.&quot;</span>
                    <span class="p">)</span>
                <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enrich_results</span><span class="p">(</span>
                    <span class="n">results</span><span class="o">=</span><span class="n">results</span><span class="p">,</span>
                    <span class="n">sklearn_ml</span><span class="o">=</span><span class="n">sklearn_ml</span><span class="p">,</span>
                    <span class="n">ml_type</span><span class="o">=</span><span class="n">ml_type</span><span class="p">,</span>
                    <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
                    <span class="n">sub</span><span class="o">=</span><span class="n">sub</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_results</span><span class="p">,</span> <span class="n">results</span><span class="p">])</span>

    <span class="c1">## Check if embedding_evaluation is empty</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="nb">hasattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;embedding_evaluation&quot;</span><span class="p">)</span>
        <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">embedding_evaluation</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="p">):</span>
        <span class="n">result</span><span class="o">.</span><span class="n">embedding_evaluation</span> <span class="o">=</span> <span class="n">df_results</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># merge with existing results</span>
        <span class="n">result</span><span class="o">.</span><span class="n">embedding_evaluation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">embedding_evaluation</span><span class="p">,</span> <span class="n">df_results</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="autoencodix.evaluate.XModalixEvaluator" class="doc doc-heading">
            <code>XModalixEvaluator</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GeneralEvaluator (autoencodix.evaluate._general_evaluator.GeneralEvaluator)" href="#autoencodix.evaluate.GeneralEvaluator">GeneralEvaluator</a></code></p>









              <details class="quote">
                <summary>Source code in <code>src/autoencodix/evaluate/_xmodalix_evaluator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">XModalixEvaluator</span><span class="p">(</span><span class="n">GeneralEvaluator</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># super().__init__()</span>
        <span class="k">pass</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@no_type_check</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pure_vae_comparison</span><span class="p">(</span>
        <span class="n">xmodalix_result</span><span class="p">:</span> <span class="n">Result</span><span class="p">,</span>
        <span class="n">pure_vae_result</span><span class="p">:</span> <span class="n">Result</span><span class="p">,</span>
        <span class="n">to_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">param</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Figure</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compares the reconstruction performance of a pure VAE model and a cross-modal VAE (xmodalix) model using Mean Squared Error (MSE) on test samples.</span>

<span class="sd">        For each sample in the test set, computes the MSE between the original and reconstructed images for:</span>
<span class="sd">            - Pure VAE reconstructions (&quot;imagix&quot;)</span>
<span class="sd">            - xmodalix reference reconstructions (&quot;xmodalix_reference&quot;)</span>
<span class="sd">            - xmodalix translated reconstructions (&quot;xmodalix_translated&quot;)</span>
<span class="sd">        The results are merged with sample metadata and returned in a long-format DataFrame suitable for plotting. Optionally, boxplots are generated grouped by a specified metadata parameter.</span>

<span class="sd">        Args:</span>
<span class="sd">            xmodalix_result: The result object containing xmodalix model outputs and test datasets.</span>
<span class="sd">            pure_vae_result: The result object containing pure VAE model outputs and test datasets.</span>
<span class="sd">            to_key: The key specifying the target modality in the xmodalix dataset.</span>
<span class="sd">            param: Metadata column name to group boxplots by. If None, plots are grouped by model only.</span>

<span class="sd">        Returns:</span>
<span class="sd">                - The matplotlib/seaborn boxplot figure comparing MSE distributions.</span>
<span class="sd">                - DataFrame: Long-format DataFrame containing MSE values and associated metadata for each sample and model.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;IMG&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">to_key</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;Comparison is currently only implemented for the image case.&quot;</span>
            <span class="p">)</span>

        <span class="c1">## Pure VAE MSE calculation</span>
        <span class="n">meta_imagix</span> <span class="o">=</span> <span class="n">pure_vae_result</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">metadata</span>
        <span class="k">if</span> <span class="n">meta_imagix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;metadata cannot be None&quot;</span><span class="p">)</span>
        <span class="n">sample_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">meta_imagix</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="n">all_sample_order</span> <span class="o">=</span> <span class="n">sample_ids</span>  <span class="c1">## TODO check code, seems unnecessary</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">all_sample_order</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span> <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">sample_ids</span> <span class="k">if</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">all_sample_order</span>
        <span class="p">]</span>

        <span class="n">mse_records</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)):</span>
            <span class="c1"># print(f&quot;Sample {c+1}/{len(indices)}: {sample_ids[c]}&quot;)</span>

            <span class="c1"># Original image</span>
            <span class="n">orig</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span>
                <span class="n">pure_vae_result</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">raw_data</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="c1"># Reconstructed image</span>
            <span class="n">recon</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span>
                <span class="n">pure_vae_result</span><span class="o">.</span><span class="n">reconstructions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span>
                    <span class="n">indices</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                <span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="c1"># Calculate MSE via torch</span>
            <span class="n">mse_sample</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">recon</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
            <span class="c1"># print(f&quot;Mean Squared Error (MSE) for sample {c+1}: {mse_sample.item()}&quot;)</span>

            <span class="c1"># Collect results</span>
            <span class="n">mse_records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;sample_id&quot;</span><span class="p">:</span> <span class="n">sample_ids</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="s2">&quot;mse_imagix&quot;</span><span class="p">:</span> <span class="n">mse_sample</span><span class="o">.</span><span class="n">item</span><span class="p">()}</span>
            <span class="p">)</span>

        <span class="n">df_imagix_mse</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mse_records</span><span class="p">)</span>
        <span class="n">df_imagix_mse</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;sample_id&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Merge with meta_imagix</span>
        <span class="n">df_imagix_mse</span> <span class="o">=</span> <span class="n">df_imagix_mse</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meta_imagix</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;sample_id&quot;</span><span class="p">)</span>

        <span class="n">meta_xmodalix</span> <span class="o">=</span> <span class="n">xmodalix_result</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">to_key</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">sample_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">meta_xmodalix</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="n">all_sample_order</span> <span class="o">=</span> <span class="n">sample_ids</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">all_sample_order</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span> <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">sample_ids</span> <span class="k">if</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">all_sample_order</span>
        <span class="p">]</span>

        <span class="n">mse_records</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)):</span>
            <span class="c1"># print(f&quot;Sample {c+1}/{len(indices)}: {sample_ids[c]}&quot;)</span>

            <span class="c1"># Original image</span>
            <span class="n">orig</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span>
                <span class="n">xmodalix_result</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">to_key</span><span class="p">][</span><span class="n">indices</span><span class="p">[</span><span class="n">c</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="c1"># print(orig.shape)</span>

            <span class="c1"># Reference Reconstructed image</span>
            <span class="n">reference</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span>
                <span class="n">xmodalix_result</span><span class="o">.</span><span class="n">reconstructions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">epoch</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)[</span>
                    <span class="sa">f</span><span class="s2">&quot;reference_</span><span class="si">{</span><span class="n">to_key</span><span class="si">}</span><span class="s2">_to_</span><span class="si">{</span><span class="n">to_key</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">][</span><span class="n">indices</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="c1"># print(reference.shape)</span>

            <span class="c1"># Translated Reconstructed image</span>
            <span class="n">translation</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span>
                <span class="n">xmodalix_result</span><span class="o">.</span><span class="n">reconstructions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">epoch</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)[</span>
                    <span class="s2">&quot;translation&quot;</span>
                <span class="p">][</span><span class="n">indices</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="c1"># print(translation.shape)</span>

            <span class="c1"># Calculate MSE via torch</span>
            <span class="n">mse_sample_translated</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">translation</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
            <span class="c1"># print(f&quot;Mean Squared Error (MSE) for sample {c+1}: {mse_sample_translated.item()}&quot;)</span>
            <span class="n">mse_sample_reference</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
            <span class="c1"># print(f&quot;Mean Squared Error (MSE) for sample {c+1}: {mse_sample_reference.item()}&quot;)</span>

            <span class="c1"># Collect results</span>
            <span class="n">mse_records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;sample_id&quot;</span><span class="p">:</span> <span class="n">sample_ids</span><span class="p">[</span><span class="n">c</span><span class="p">],</span>
                    <span class="s2">&quot;mse_xmodalix_translated&quot;</span><span class="p">:</span> <span class="n">mse_sample_translated</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span>
                    <span class="s2">&quot;mse_xmodalix_reference&quot;</span><span class="p">:</span> <span class="n">mse_sample_reference</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="n">df_xmodalix_mse</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mse_records</span><span class="p">)</span>
        <span class="n">df_xmodalix_mse</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;sample_id&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Merge with meta_xmodalix</span>
        <span class="n">df_xmodalix_mse</span> <span class="o">=</span> <span class="n">df_xmodalix_mse</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meta_xmodalix</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;sample_id&quot;</span><span class="p">)</span>

        <span class="c1"># Merge via sample_id and keep non overlapping entries</span>
        <span class="n">df_both_mse</span> <span class="o">=</span> <span class="n">df_imagix_mse</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">df_xmodalix_mse</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">meta_imagix</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Make long format for plotting</span>
        <span class="n">df_long</span> <span class="o">=</span> <span class="n">df_both_mse</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
            <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span>
                <span class="n">col</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_both_mse</span><span class="o">.</span><span class="n">columns</span>
                <span class="k">if</span> <span class="n">col</span>
                <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s2">&quot;mse_imagix&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;mse_xmodalix_translated&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;mse_xmodalix_reference&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">],</span>
            <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span>
                <span class="s2">&quot;mse_imagix&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mse_xmodalix_translated&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mse_xmodalix_reference&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span>
            <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;mse_value&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">df_long</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_long</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;mse_imagix&quot;</span><span class="p">:</span> <span class="s2">&quot;imagix&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mse_xmodalix_translated&quot;</span><span class="p">:</span> <span class="s2">&quot;xmodalix_translated&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mse_xmodalix_reference&quot;</span><span class="p">:</span> <span class="s2">&quot;xmodalix_reference&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">param</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_long</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span> <span class="mi">8</span><span class="p">))</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_long</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;mse_value&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">move_legend</span><span class="p">(</span>
                <span class="n">fig</span><span class="p">,</span>
                <span class="s2">&quot;lower center&quot;</span><span class="p">,</span>
                <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_long</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;mse_value&quot;</span><span class="p">)</span>
            <span class="c1"># Rotate tick labels</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">45</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">df_long</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_clin_data</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves the clinical annotation DataFrame (clin_data) from the provided datasets.</span>

<span class="sd">        Handles both standard and XModalix dataset structures.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># XModalix-Case</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="s2">&quot;datasets&quot;</span><span class="p">):</span>
            <span class="n">clin_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="n">splits</span> <span class="o">=</span> <span class="p">[</span><span class="n">datasets</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">datasets</span><span class="o">.</span><span class="n">valid</span><span class="p">,</span> <span class="n">datasets</span><span class="o">.</span><span class="n">test</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">splits</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing dataset: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="c1"># Merge metadata by overlapping columns</span>
                    <span class="n">overlap</span> <span class="o">=</span> <span class="n">clin_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
                        <span class="n">s</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">columns</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">overlap</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                        <span class="n">overlap</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">columns</span>
                    <span class="n">clin_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">clin_data</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">overlap</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
                    <span class="p">)</span>

            <span class="c1"># Remove duplicate rows</span>
            <span class="n">clin_data</span> <span class="o">=</span> <span class="n">clin_data</span><span class="p">[</span><span class="o">~</span><span class="n">clin_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Raise error no annotation given</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;No annotation data found. Please provide a valid annotation data type.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">clin_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_enrich_results</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">results</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">sklearn_ml</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ClassifierMixin</span><span class="p">,</span> <span class="n">RegressorMixin</span><span class="p">],</span>
        <span class="n">ml_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">task</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">sub</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">res_ml_alg</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">sklearn_ml</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">res_ml_type</span> <span class="o">=</span> <span class="p">[</span><span class="n">ml_type</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">res_ml_subtask</span> <span class="o">=</span> <span class="p">[</span><span class="n">sub</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>

        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ML_ALG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_ml_alg</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ML_TYPE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_ml_type</span>

        <span class="n">modality</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_$_&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">task_xmodal</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_$_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;MODALITY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">modality</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ML_TASK&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">task_xmodal</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>

        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ML_SUBTASK&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_ml_subtask</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_expand_reference_methods</span><span class="p">(</span><span class="n">reference_methods</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">Result</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Expands each reference method by appending a suffix for every key of used data modalities.</span>
<span class="sd">        For each method in `reference_methods`, this function generates new method names by concatenating</span>
<span class="sd">        the method name with each key for the data modalities of the xmodalix.</span>
<span class="sd">        Args:</span>
<span class="sd">            reference_methods (list): A list of reference method names to be expanded.</span>
<span class="sd">            result (Result): An object containing latent space information.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: A list of expanded reference method names, each suffixed with a key from the latent space.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">reference_methods</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">_$_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">reference_methods</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">latentspaces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">epoch</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>  <span class="c1"># ty: ignore[possibly-unbound-attribute]</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">reference_methods</span>

    <span class="c1">## New for x-modalix</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_load_input_for_ml</span><span class="p">(</span>
        <span class="n">task</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">DatasetContainer</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">Result</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads and processes input data for various machine learning tasks based on the specified task type.</span>

<span class="sd">        Task Details:</span>
<span class="sd">            - &quot;Latent&quot;: Concatenates latent representations from train, validation, and test splits at the final epoch.</span>
<span class="sd">            - &quot;UMAP&quot;: Applies UMAP dimensionality reduction to the concatenated dataset splits.</span>
<span class="sd">            - &quot;PCA&quot;: Applies PCA dimensionality reduction to the concatenated dataset splits.</span>
<span class="sd">            - &quot;TSNE&quot;: Applies t-SNE dimensionality reduction to the concatenated dataset splits.</span>
<span class="sd">            - &quot;RandomFeature&quot;: Randomly samples columns (features) from the concatenated dataset splits.</span>


<span class="sd">        Args:</span>
<span class="sd">            task: The type of ML task. Supported values are &quot;Latent&quot;, &quot;UMAP&quot;, &quot;PCA&quot;, &quot;TSNE&quot;, and &quot;RandomFeature&quot;.</span>
<span class="sd">            dataset: The dataset container object holding train, validation, and test splits.</span>
<span class="sd">            result: The result object containing model configuration and methods to retrieve latent representations.</span>
<span class="sd">        Returns:</span>
<span class="sd">            A DataFrame containing the processed input data suitable for the specified ML task.</span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the provided task is not supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># final_epoch = result.model.config.epochs - 1</span>
        <span class="n">modality</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_$_&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_$_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">task</span> <span class="o">==</span> <span class="s2">&quot;Latent&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">get_latent_df</span><span class="p">(</span><span class="n">epoch</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">modality</span><span class="o">=</span><span class="n">modality</span><span class="p">),</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">get_latent_df</span><span class="p">(</span><span class="n">epoch</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span> <span class="n">modality</span><span class="o">=</span><span class="n">modality</span><span class="p">),</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">get_latent_df</span><span class="p">(</span><span class="n">epoch</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">modality</span><span class="o">=</span><span class="n">modality</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">task</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;UMAP&quot;</span><span class="p">,</span> <span class="s2">&quot;PCA&quot;</span><span class="p">,</span> <span class="s2">&quot;TSNE&quot;</span><span class="p">,</span> <span class="s2">&quot;RandomFeature&quot;</span><span class="p">]:</span>
            <span class="n">latent_dim</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_latent_df</span><span class="p">(</span>
                <span class="n">epoch</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">modality</span><span class="o">=</span><span class="n">modality</span>
            <span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dataset</span><span class="o">.</span><span class="n">train</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;train attribute of dataset cannot be None&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dataset</span><span class="o">.</span><span class="n">valid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;valid attribute of dataset cannot be None&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dataset</span><span class="o">.</span><span class="n">test</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;test attribute of dataset cannot be None&quot;</span><span class="p">)</span>

            <span class="n">df_processed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">dataset</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">_to_df</span><span class="p">(</span><span class="n">modality</span><span class="o">=</span><span class="n">modality</span><span class="p">),</span>
                    <span class="n">dataset</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">_to_df</span><span class="p">(</span><span class="n">modality</span><span class="o">=</span><span class="n">modality</span><span class="p">),</span>
                    <span class="n">dataset</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">_to_df</span><span class="p">(</span><span class="n">modality</span><span class="o">=</span><span class="n">modality</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">task</span> <span class="o">==</span> <span class="s2">&quot;UMAP&quot;</span><span class="p">:</span>
                <span class="n">reducer</span> <span class="o">=</span> <span class="n">UMAP</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">latent_dim</span><span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">reducer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_processed</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">df_processed</span><span class="o">.</span><span class="n">index</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">task</span> <span class="o">==</span> <span class="s2">&quot;PCA&quot;</span><span class="p">:</span>
                <span class="n">reducer</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">latent_dim</span><span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">reducer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_processed</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">df_processed</span><span class="o">.</span><span class="n">index</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">task</span> <span class="o">==</span> <span class="s2">&quot;TSNE&quot;</span><span class="p">:</span>
                <span class="n">reducer</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">latent_dim</span><span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">reducer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_processed</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">df_processed</span><span class="o">.</span><span class="n">index</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">task</span> <span class="o">==</span> <span class="s2">&quot;RandomFeature&quot;</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df_processed</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">latent_dim</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Your ML task </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2"> is not supported. Please use Latent, UMAP, PCA or RandomFeature.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="autoencodix.evaluate.XModalixEvaluator.pure_vae_comparison" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pure_vae_comparison</span><span class="p">(</span><span class="n">xmodalix_result</span><span class="p">,</span> <span class="n">pure_vae_result</span><span class="p">,</span> <span class="n">to_key</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Compares the reconstruction performance of a pure VAE model and a cross-modal VAE (xmodalix) model using Mean Squared Error (MSE) on test samples.</p>
<p>For each sample in the test set, computes the MSE between the original and reconstructed images for:
    - Pure VAE reconstructions ("imagix")
    - xmodalix reference reconstructions ("xmodalix_reference")
    - xmodalix translated reconstructions ("xmodalix_translated")
The results are merged with sample metadata and returned in a long-format DataFrame suitable for plotting. Optionally, boxplots are generated grouped by a specified metadata parameter.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>xmodalix_result</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Result


  
      dataclass
   (autoencodix.utils._result.Result)" href="../utils/#autoencodix.utils.Result">Result</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The result object containing xmodalix model outputs and test datasets.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pure_vae_result</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Result


  
      dataclass
   (autoencodix.utils._result.Result)" href="../utils/#autoencodix.utils.Result">Result</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The result object containing pure VAE model outputs and test datasets.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The key specifying the target modality in the xmodalix dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>param</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Metadata column name to group boxplots by. If None, plots are grouped by model only.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="matplotlib.figure.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>The matplotlib/seaborn boxplot figure comparing MSE distributions.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>DataFrame: Long-format DataFrame containing MSE values and associated metadata for each sample and model.</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/autoencodix/evaluate/_xmodalix_evaluator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="nd">@no_type_check</span>
<span class="k">def</span><span class="w"> </span><span class="nf">pure_vae_comparison</span><span class="p">(</span>
    <span class="n">xmodalix_result</span><span class="p">:</span> <span class="n">Result</span><span class="p">,</span>
    <span class="n">pure_vae_result</span><span class="p">:</span> <span class="n">Result</span><span class="p">,</span>
    <span class="n">to_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">param</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Figure</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compares the reconstruction performance of a pure VAE model and a cross-modal VAE (xmodalix) model using Mean Squared Error (MSE) on test samples.</span>

<span class="sd">    For each sample in the test set, computes the MSE between the original and reconstructed images for:</span>
<span class="sd">        - Pure VAE reconstructions (&quot;imagix&quot;)</span>
<span class="sd">        - xmodalix reference reconstructions (&quot;xmodalix_reference&quot;)</span>
<span class="sd">        - xmodalix translated reconstructions (&quot;xmodalix_translated&quot;)</span>
<span class="sd">    The results are merged with sample metadata and returned in a long-format DataFrame suitable for plotting. Optionally, boxplots are generated grouped by a specified metadata parameter.</span>

<span class="sd">    Args:</span>
<span class="sd">        xmodalix_result: The result object containing xmodalix model outputs and test datasets.</span>
<span class="sd">        pure_vae_result: The result object containing pure VAE model outputs and test datasets.</span>
<span class="sd">        to_key: The key specifying the target modality in the xmodalix dataset.</span>
<span class="sd">        param: Metadata column name to group boxplots by. If None, plots are grouped by model only.</span>

<span class="sd">    Returns:</span>
<span class="sd">            - The matplotlib/seaborn boxplot figure comparing MSE distributions.</span>
<span class="sd">            - DataFrame: Long-format DataFrame containing MSE values and associated metadata for each sample and model.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s2">&quot;IMG&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">to_key</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;Comparison is currently only implemented for the image case.&quot;</span>
        <span class="p">)</span>

    <span class="c1">## Pure VAE MSE calculation</span>
    <span class="n">meta_imagix</span> <span class="o">=</span> <span class="n">pure_vae_result</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">metadata</span>
    <span class="k">if</span> <span class="n">meta_imagix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;metadata cannot be None&quot;</span><span class="p">)</span>
    <span class="n">sample_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">meta_imagix</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="n">all_sample_order</span> <span class="o">=</span> <span class="n">sample_ids</span>  <span class="c1">## TODO check code, seems unnecessary</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">all_sample_order</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span> <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">sample_ids</span> <span class="k">if</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">all_sample_order</span>
    <span class="p">]</span>

    <span class="n">mse_records</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)):</span>
        <span class="c1"># print(f&quot;Sample {c+1}/{len(indices)}: {sample_ids[c]}&quot;)</span>

        <span class="c1"># Original image</span>
        <span class="n">orig</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span>
            <span class="n">pure_vae_result</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">raw_data</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># Reconstructed image</span>
        <span class="n">recon</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span>
            <span class="n">pure_vae_result</span><span class="o">.</span><span class="n">reconstructions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span>
                <span class="n">indices</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># Calculate MSE via torch</span>
        <span class="n">mse_sample</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">recon</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
        <span class="c1"># print(f&quot;Mean Squared Error (MSE) for sample {c+1}: {mse_sample.item()}&quot;)</span>

        <span class="c1"># Collect results</span>
        <span class="n">mse_records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;sample_id&quot;</span><span class="p">:</span> <span class="n">sample_ids</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="s2">&quot;mse_imagix&quot;</span><span class="p">:</span> <span class="n">mse_sample</span><span class="o">.</span><span class="n">item</span><span class="p">()}</span>
        <span class="p">)</span>

    <span class="n">df_imagix_mse</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mse_records</span><span class="p">)</span>
    <span class="n">df_imagix_mse</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;sample_id&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Merge with meta_imagix</span>
    <span class="n">df_imagix_mse</span> <span class="o">=</span> <span class="n">df_imagix_mse</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meta_imagix</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;sample_id&quot;</span><span class="p">)</span>

    <span class="n">meta_xmodalix</span> <span class="o">=</span> <span class="n">xmodalix_result</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">to_key</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span>
    <span class="n">sample_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">meta_xmodalix</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="n">all_sample_order</span> <span class="o">=</span> <span class="n">sample_ids</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">all_sample_order</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span> <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">sample_ids</span> <span class="k">if</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">all_sample_order</span>
    <span class="p">]</span>

    <span class="n">mse_records</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)):</span>
        <span class="c1"># print(f&quot;Sample {c+1}/{len(indices)}: {sample_ids[c]}&quot;)</span>

        <span class="c1"># Original image</span>
        <span class="n">orig</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span>
            <span class="n">xmodalix_result</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">to_key</span><span class="p">][</span><span class="n">indices</span><span class="p">[</span><span class="n">c</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># print(orig.shape)</span>

        <span class="c1"># Reference Reconstructed image</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span>
            <span class="n">xmodalix_result</span><span class="o">.</span><span class="n">reconstructions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">epoch</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)[</span>
                <span class="sa">f</span><span class="s2">&quot;reference_</span><span class="si">{</span><span class="n">to_key</span><span class="si">}</span><span class="s2">_to_</span><span class="si">{</span><span class="n">to_key</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">][</span><span class="n">indices</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># print(reference.shape)</span>

        <span class="c1"># Translated Reconstructed image</span>
        <span class="n">translation</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span>
            <span class="n">xmodalix_result</span><span class="o">.</span><span class="n">reconstructions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">epoch</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)[</span>
                <span class="s2">&quot;translation&quot;</span>
            <span class="p">][</span><span class="n">indices</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># print(translation.shape)</span>

        <span class="c1"># Calculate MSE via torch</span>
        <span class="n">mse_sample_translated</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">translation</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
        <span class="c1"># print(f&quot;Mean Squared Error (MSE) for sample {c+1}: {mse_sample_translated.item()}&quot;)</span>
        <span class="n">mse_sample_reference</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
        <span class="c1"># print(f&quot;Mean Squared Error (MSE) for sample {c+1}: {mse_sample_reference.item()}&quot;)</span>

        <span class="c1"># Collect results</span>
        <span class="n">mse_records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;sample_id&quot;</span><span class="p">:</span> <span class="n">sample_ids</span><span class="p">[</span><span class="n">c</span><span class="p">],</span>
                <span class="s2">&quot;mse_xmodalix_translated&quot;</span><span class="p">:</span> <span class="n">mse_sample_translated</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span>
                <span class="s2">&quot;mse_xmodalix_reference&quot;</span><span class="p">:</span> <span class="n">mse_sample_reference</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="n">df_xmodalix_mse</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mse_records</span><span class="p">)</span>
    <span class="n">df_xmodalix_mse</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;sample_id&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Merge with meta_xmodalix</span>
    <span class="n">df_xmodalix_mse</span> <span class="o">=</span> <span class="n">df_xmodalix_mse</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meta_xmodalix</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;sample_id&quot;</span><span class="p">)</span>

    <span class="c1"># Merge via sample_id and keep non overlapping entries</span>
    <span class="n">df_both_mse</span> <span class="o">=</span> <span class="n">df_imagix_mse</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">df_xmodalix_mse</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">meta_imagix</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Make long format for plotting</span>
    <span class="n">df_long</span> <span class="o">=</span> <span class="n">df_both_mse</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
        <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span>
            <span class="n">col</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_both_mse</span><span class="o">.</span><span class="n">columns</span>
            <span class="k">if</span> <span class="n">col</span>
            <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;mse_imagix&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mse_xmodalix_translated&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mse_xmodalix_reference&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">],</span>
        <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;mse_imagix&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mse_xmodalix_translated&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mse_xmodalix_reference&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span>
        <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;mse_value&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">df_long</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_long</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;mse_imagix&quot;</span><span class="p">:</span> <span class="s2">&quot;imagix&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mse_xmodalix_translated&quot;</span><span class="p">:</span> <span class="s2">&quot;xmodalix_translated&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mse_xmodalix_reference&quot;</span><span class="p">:</span> <span class="s2">&quot;xmodalix_reference&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">param</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_long</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span> <span class="mi">8</span><span class="p">))</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_long</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;mse_value&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">move_legend</span><span class="p">(</span>
            <span class="n">fig</span><span class="p">,</span>
            <span class="s2">&quot;lower center&quot;</span><span class="p">,</span>
            <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_long</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;mse_value&quot;</span><span class="p">)</span>
        <span class="c1"># Rotate tick labels</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">45</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">df_long</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>